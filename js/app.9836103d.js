(function(){var e={4469:function(e,t,s){"use strict";var i=s(5130),o=s(6768);const a={id:"app"};function n(e,t,s,i,n,l){const r=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",a,[(0,o.bF)(r)])}var l={name:"App"},r=s(1241);const c=(0,r.A)(l,[["render",n],["__scopeId","data-v-0805d65c"]]);var d=c,u=s(1387),m=s(4232);const h={class:"watchlist-panel"},p={class:"header-container"},g={class:"nav-links"},S={class:"controls-container"},k={class:"chime-controls"},b={class:"view-filter"},f={class:"sort-filter"},v={class:"table-container"},w={class:"col-symbol"},y=["onClick"],L={class:"symbol-text"},C={key:0,class:"symbol-new-badge"},T={class:"col-patterns"},A={key:0,class:"pattern-cell"},E={class:"pattern-text"},M={class:"pattern-time"},_={key:1,class:"pattern-cell"},$={class:"col-windows"},I={class:"window-buttons"},F={class:"button-pair"},P=["onClick"],R=["onClick"],D={class:"button-pair"},W=["onClick"],x=["onClick"],N={class:"button-pair"},O=["onClick"],B=["onClick"],V={class:"col-price"},U={class:"col-macd-bar"},X={class:"macd-horizontal-bar"},H={class:"col-ema-bar"},z={class:"ema-horizontal-bar"},Q={class:"col-ema-bar"},q={class:"ema-horizontal-bar"},j={class:"col-squeeze-bar"},K={class:"squeeze-horizontal-bar"},G={class:"col-volume"},Y={key:0,class:"section-divider"},J={class:"col-symbol"},Z=["onClick"],ee={class:"symbol-text"},te={key:0,class:"symbol-new-badge"},se={class:"col-patterns"},ie={key:0,class:"pattern-cell"},oe={class:"pattern-text"},ae={class:"pattern-time"},ne={key:1,class:"pattern-cell"},le={class:"col-windows"},re={class:"window-buttons"},ce={class:"button-pair"},de=["onClick"],ue=["onClick"],me={class:"button-pair"},he=["onClick"],pe=["onClick"],ge={class:"button-pair"},Se=["onClick"],ke=["onClick"],be={class:"col-price"},fe={class:"col-macd-bar"},ve={class:"macd-horizontal-bar"},we={class:"col-ema-bar"},ye={class:"ema-horizontal-bar"},Le={class:"col-ema-bar"},Ce={class:"ema-horizontal-bar"},Te={class:"col-squeeze-bar"},Ae={class:"squeeze-horizontal-bar"},Ee={class:"col-volume"};function Me(e,t,s,a,n,l){const r=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",h,[(0,o.Lk)("div",p,[t[17]||(t[17]=(0,o.Lk)("h1",null,"Trading Watchlist",-1)),(0,o.Lk)("div",g,[(0,o.bF)(r,{to:"/watchlist",class:"nav-link"},{default:(0,o.k6)((()=>t[15]||(t[15]=[(0,o.eW)("Old Watchlist")]))),_:1}),(0,o.bF)(r,{to:"/signals",class:"nav-link"},{default:(0,o.k6)((()=>t[16]||(t[16]=[(0,o.eW)("📊 Signals")]))),_:1})])]),(0,o.Lk)("div",S,[(0,o.Lk)("form",{class:"add-symbol-form",onSubmit:t[1]||(t[1]=(0,i.D$)(((...e)=>l.addSymbol&&l.addSymbol(...e)),["prevent"]))},[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.newSymbol=e),type:"text",placeholder:"Enter symbol (e.g., AAPL)",class:"symbol-input"},null,512),[[i.Jo,n.newSymbol]]),t[18]||(t[18]=(0,o.Lk)("button",{type:"submit",class:"add-btn"},"+",-1))],32),(0,o.Lk)("div",k,[t[20]||(t[20]=(0,o.Lk)("label",{for:"signal-date"},"Date:",-1)),(0,o.bo)((0,o.Lk)("input",{type:"date",id:"signal-date","onUpdate:modelValue":t[2]||(t[2]=e=>n.signalDate=e),onChange:t[3]||(t[3]=(...e)=>l.fetchSignals&&l.fetchSignals(...e)),class:"date-input"},null,544),[[i.Jo,n.signalDate]]),(0,o.bo)((0,o.Lk)("input",{type:"checkbox",id:"alert-sound","onUpdate:modelValue":t[4]||(t[4]=e=>n.alertSoundEnabled=e),onChange:t[5]||(t[5]=(...e)=>l.saveAlertSoundPreference&&l.saveAlertSoundPreference(...e))},null,544),[[i.lH,n.alertSoundEnabled]]),t[21]||(t[21]=(0,o.Lk)("label",{for:"alert-sound"},"Alert sound",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>n.selectedChime=e),onChange:t[7]||(t[7]=(...e)=>l.saveChimePreference&&l.saveChimePreference(...e)),class:"chime-select"},t[19]||(t[19]=[(0,o.Fv)('<option value="beep" data-v-42c7d208>Beep</option><option value="ding" data-v-42c7d208>Ding</option><option value="chime" data-v-42c7d208>Chime</option><option value="bell" data-v-42c7d208>Bell</option><option value="notification" data-v-42c7d208>Notification</option><option value="sonar" data-v-42c7d208>Sonar</option><option value="ascending" data-v-42c7d208>Ascending</option><option value="descending" data-v-42c7d208>Descending</option><option value="double-beep" data-v-42c7d208>Double Beep</option><option value="triple-tone" data-v-42c7d208>Triple Tone</option><option value="urgent" data-v-42c7d208>Urgent</option><option value="subtle" data-v-42c7d208>Subtle</option>',12)]),544),[[i.u1,n.selectedChime]]),(0,o.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>l.playAlertSound&&l.playAlertSound(...e)),class:"test-sound-btn",title:"Test alert sound"},"🔊")]),(0,o.Lk)("div",b,[t[26]||(t[26]=(0,o.Lk)("label",null,"Show:",-1)),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"radio",name:"view-mode",value:"both","onUpdate:modelValue":t[9]||(t[9]=e=>n.viewMode=e)},null,512),[[i.XL,n.viewMode]]),t[22]||(t[22]=(0,o.eW)(" Both "))]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"radio",name:"view-mode",value:"watchlist","onUpdate:modelValue":t[10]||(t[10]=e=>n.viewMode=e)},null,512),[[i.XL,n.viewMode]]),t[23]||(t[23]=(0,o.eW)(" Only Watchlist "))]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"radio",name:"view-mode",value:"smb","onUpdate:modelValue":t[11]||(t[11]=e=>n.viewMode=e)},null,512),[[i.XL,n.viewMode]]),t[24]||(t[24]=(0,o.eW)(" Only SMB "))]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"radio",name:"view-mode",value:"active-signals","onUpdate:modelValue":t[12]||(t[12]=e=>n.viewMode=e)},null,512),[[i.XL,n.viewMode]]),t[25]||(t[25]=(0,o.eW)(" Active Signals Only "))])]),(0,o.Lk)("div",f,[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=e=>n.sortByTime=e)},null,512),[[i.lH,n.sortByTime]]),t[27]||(t[27]=(0,o.eW)(" Sort by Time "))])]),(0,o.Lk)("button",{type:"button",class:"bring-forward-btn",title:"Bring all windows to front",onClick:t[14]||(t[14]=(...e)=>l.bringAllWindowsForward&&l.bringAllWindowsForward(...e))}," 🪟 Bring All Forward ")]),(0,o.Lk)("div",v,[(0,o.Lk)("table",null,[t[31]||(t[31]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",{class:"group-header"},[(0,o.Lk)("th",{rowspan:"2",class:"col-symbol"},"Symbol"),(0,o.Lk)("th",{rowspan:"2",class:"col-patterns"},"Pattern Signals"),(0,o.Lk)("th",{rowspan:"2",class:"col-windows"},"Send To"),(0,o.Lk)("th",{rowspan:"2",class:"col-price"},"Price"),(0,o.Lk)("th",{rowspan:"2",class:"col-percent"},"%"),(0,o.Lk)("th",{rowspan:"2",class:"col-macd-bar"},"MACD"),(0,o.Lk)("th",{colspan:"5",class:"group-label"},"RSI"),(0,o.Lk)("th",{rowspan:"2",class:"col-ema-bar"},"9/21"),(0,o.Lk)("th",{rowspan:"2",class:"col-ema-bar"},"21/50"),(0,o.Lk)("th",{rowspan:"2",class:"col-squeeze-bar"},"Squeeze"),(0,o.Lk)("th",{rowspan:"2",class:"col-volume"},"RVOL"),(0,o.Lk)("th",{colspan:"5",class:"group-label"},"BB%")]),(0,o.Lk)("tr",null,[(0,o.Lk)("th",{class:"col-compact"},"1m"),(0,o.Lk)("th",{class:"col-compact"},"2m"),(0,o.Lk)("th",{class:"col-compact"},"3m"),(0,o.Lk)("th",{class:"col-compact"},"5m"),(0,o.Lk)("th",{class:"col-compact"},"15m"),(0,o.Lk)("th",{class:"col-compact"},"1m"),(0,o.Lk)("th",{class:"col-compact"},"2m"),(0,o.Lk)("th",{class:"col-compact"},"3m"),(0,o.Lk)("th",{class:"col-compact"},"5m"),(0,o.Lk)("th",{class:"col-compact"},"15m")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.sortedWatchlist,(e=>(0,o.bo)(((0,o.uX)(),(0,o.CE)("tr",{key:e},[(0,o.Lk)("td",w,[(0,o.Lk)("button",{class:"remove-btn",title:"Remove",onClick:t=>l.removeSymbol(e)},"✕",8,y),(0,o.Lk)("span",L,(0,m.v_)(e),1),l.hasNewSignal(e)?((0,o.uX)(),(0,o.CE)("span",C,"🆕")):(0,o.Q3)("",!0)]),(0,o.Lk)("td",T,[l.getSignalsForTicker(e).length>0?((0,o.uX)(),(0,o.CE)("div",A,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.getSignalsForTicker(e),((e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"pattern-row",key:t},[(0,o.Lk)("div",{class:(0,m.C4)(l.getSignalClass(e))},[(0,o.Lk)("span",E,(0,m.v_)(l.formatSignalText(e)),1)],2),(0,o.Lk)("span",M,"("+(0,m.v_)(l.calculateAge(e))+")",1)])))),128))])):((0,o.uX)(),(0,o.CE)("div",_,t[28]||(t[28]=[(0,o.Lk)("span",{class:"no-patterns"},"—",-1)])))]),(0,o.Lk)("td",$,[(0,o.Lk)("div",I,[(0,o.Lk)("span",F,[(0,o.Lk)("button",{onClick:t=>l.sendToWindow(1,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,1)}]),title:"Send to Window 1"},"1",10,P),(0,o.Lk)("button",{onClick:t=>l.sendToWindow(2,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,2)}]),title:"Send to Window 2"},"2",10,R)]),(0,o.Lk)("span",D,[(0,o.Lk)("button",{onClick:t=>l.sendToWindow(3,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,3)}]),title:"Send to Window 3"},"3",10,W),(0,o.Lk)("button",{onClick:t=>l.sendToWindow(4,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,4)}]),title:"Send to Window 4"},"4",10,x)]),(0,o.Lk)("span",N,[(0,o.Lk)("button",{onClick:t=>l.sendToWindow(5,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,5)}]),title:"Send to Window 5"},"5",10,O),(0,o.Lk)("button",{onClick:t=>l.sendToWindow(6,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,6)}]),title:"Send to Window 6"},"6",10,B)])])]),(0,o.Lk)("td",V,(0,m.v_)(l.getPrice(e)),1),(0,o.Lk)("td",{class:(0,m.C4)(["col-percent",l.getPriceClass(e)])},(0,m.v_)(l.getPercent(e)),3),(0,o.Lk)("td",U,[(0,o.Lk)("div",X,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"macd-segment-"+t,class:(0,m.C4)(["macd-segment",l.getMacdDotClass(e,t)]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"1min")])},(0,m.v_)(l.getRSI(e,"1min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"2min")])},(0,m.v_)(l.getRSI(e,"2min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"3min")])},(0,m.v_)(l.getRSI(e,"3min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"5min")])},(0,m.v_)(l.getRSI(e,"5min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"15min")])},(0,m.v_)(l.getRSI(e,"15min")),3),(0,o.Lk)("td",H,[(0,o.Lk)("div",z,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"ema921-segment-"+t,class:(0,m.C4)(["ema-segment",l.getEmaDotClass(e,t,"9","21")]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),(0,o.Lk)("td",Q,[(0,o.Lk)("div",q,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"ema2150-segment-"+t,class:(0,m.C4)(["ema-segment",l.getEmaDotClass(e,t,"21","50")]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),(0,o.Lk)("td",j,[(0,o.Lk)("div",K,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"squeeze-segment-"+t,class:"squeeze-segment",style:(0,m.Tr)(l.getSqueezeSegmentStyle(e,t,s))},null,4)))),128))])]),(0,o.Lk)("td",G,(0,m.v_)(l.getRVOL(e)),1),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"1min")])},(0,m.v_)(l.getBB(e,"1min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"2min")])},(0,m.v_)(l.getBB(e,"2min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"3min")])},(0,m.v_)(l.getBB(e,"3min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"5min")])},(0,m.v_)(l.getBB(e,"5min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"15min")])},(0,m.v_)(l.getBB(e,"15min")),3)])),[[i.aG,"both"===n.viewMode||"watchlist"===n.viewMode||"active-signals"===n.viewMode&&l.watchlistWithActiveSignals.includes(e)]]))),128)),l.smbOnlyTickers.length>0&&("both"===n.viewMode||"active-signals"===n.viewMode)?((0,o.uX)(),(0,o.CE)("tr",Y,t[29]||(t[29]=[(0,o.Lk)("td",{colspan:"20",class:"divider-text"},"Other Signals (not in watchlist)",-1)]))):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.smbOnlyTickers,(e=>(0,o.bo)(((0,o.uX)(),(0,o.CE)("tr",{key:"smb-"+e,class:"smb-only-row"},[(0,o.Lk)("td",J,[(0,o.Lk)("button",{class:"add-btn-small",title:"Add to watchlist",onClick:t=>l.addSymbol(e)},"+",8,Z),(0,o.Lk)("span",ee,(0,m.v_)(e),1),l.hasNewSignal(e)?((0,o.uX)(),(0,o.CE)("span",te,"🆕")):(0,o.Q3)("",!0)]),(0,o.Lk)("td",se,[l.getSignalsForTicker(e).length>0?((0,o.uX)(),(0,o.CE)("div",ie,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.getSignalsForTicker(e),((e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:"pattern-row",key:t},[(0,o.Lk)("div",{class:(0,m.C4)(l.getSignalClass(e))},[(0,o.Lk)("span",oe,(0,m.v_)(l.formatSignalText(e)),1)],2),(0,o.Lk)("span",ae,"("+(0,m.v_)(l.calculateAge(e))+")",1)])))),128))])):((0,o.uX)(),(0,o.CE)("div",ne,t[30]||(t[30]=[(0,o.Lk)("span",{class:"no-patterns"},"—",-1)])))]),(0,o.Lk)("td",le,[(0,o.Lk)("div",re,[(0,o.Lk)("span",ce,[(0,o.Lk)("button",{onClick:t=>l.sendToWindow(1,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,1)}]),title:"Send to Window 1"},"1",10,de),(0,o.Lk)("button",{onClick:t=>l.sendToWindow(2,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,2)}]),title:"Send to Window 2"},"2",10,ue)]),(0,o.Lk)("span",me,[(0,o.Lk)("button",{onClick:t=>l.sendToWindow(3,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,3)}]),title:"Send to Window 3"},"3",10,he),(0,o.Lk)("button",{onClick:t=>l.sendToWindow(4,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,4)}]),title:"Send to Window 4"},"4",10,pe)]),(0,o.Lk)("span",ge,[(0,o.Lk)("button",{onClick:t=>l.sendToWindow(5,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,5)}]),title:"Send to Window 5"},"5",10,Se),(0,o.Lk)("button",{onClick:t=>l.sendToWindow(6,e),class:(0,m.C4)(["window-btn",{active:l.isTickerInWindow(e,6)}]),title:"Send to Window 6"},"6",10,ke)])])]),(0,o.Lk)("td",be,(0,m.v_)(l.getPrice(e)),1),(0,o.Lk)("td",{class:(0,m.C4)(["col-percent",l.getPriceClass(e)])},(0,m.v_)(l.getPercent(e)),3),(0,o.Lk)("td",fe,[(0,o.Lk)("div",ve,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"macd-segment-"+t,class:(0,m.C4)(["macd-segment",l.getMacdDotClass(e,t)]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"1min")])},(0,m.v_)(l.getRSI(e,"1min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"2min")])},(0,m.v_)(l.getRSI(e,"2min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"3min")])},(0,m.v_)(l.getRSI(e,"3min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"5min")])},(0,m.v_)(l.getRSI(e,"5min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getRSIClass(e,"15min")])},(0,m.v_)(l.getRSI(e,"15min")),3),(0,o.Lk)("td",we,[(0,o.Lk)("div",ye,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"ema921-segment-"+t,class:(0,m.C4)(["ema-segment",l.getEmaDotClass(e,t,"9","21")]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),(0,o.Lk)("td",Le,[(0,o.Lk)("div",Ce,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"ema2150-segment-"+t,class:(0,m.C4)(["ema-segment",l.getEmaDotClass(e,t,"21","50")]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),(0,o.Lk)("td",Te,[(0,o.Lk)("div",Ae,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"squeeze-segment-"+t,class:"squeeze-segment",style:(0,m.Tr)(l.getSqueezeSegmentStyle(e,t,s))},null,4)))),128))])]),(0,o.Lk)("td",Ee,(0,m.v_)(l.getRVOL(e)),1),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"1min")])},(0,m.v_)(l.getBB(e,"1min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"2min")])},(0,m.v_)(l.getBB(e,"2min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"3min")])},(0,m.v_)(l.getBB(e,"3min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"5min")])},(0,m.v_)(l.getBB(e,"5min")),3),(0,o.Lk)("td",{class:(0,m.C4)(["col-compact",l.getBBClass(e,"15min")])},(0,m.v_)(l.getBB(e,"15min")),3)])),[[i.aG,"both"===n.viewMode||"smb"===n.viewMode||"active-signals"===n.viewMode]]))),128))])])])])}s(4114),s(8992),s(4520),s(3949),s(1454),s(7550);var _e=s(4373),$e=s(3169),Ie=s.n($e),Fe={name:"WatchList",data(){return{watchlist:[],signals:{},indicators:{},indicatorsWs:null,apiBaseUrl:`http://${window.location.hostname}:8000/api`,newSymbol:"",indicatorPeriods:["1min","2min","3min","5min","15min"],alertSoundEnabled:!0,selectedChime:"double-beep",audioContext:null,lastSignalCount:{},newlyDetectedSignals:{},windowTickerMap:{},signalDate:(new Date).toISOString().split("T")[0],viewMode:"active-signals",sortByTime:!0,currentTime:Date.now(),encryptionSalt:"trading_watchlist_salt_2025",decryptionPassword:null,isPasswordPromptShown:!1}},computed:{sortedWatchlist(){if(!this.sortByTime)return this.watchlist;const e=[...this.watchlist].sort(((e,t)=>{const s=this.signals[e]||[],i=this.signals[t]||[],o=e=>{if(0===e.length)return-1/0;const t=e.map((e=>e.signalTime)).filter((e=>null!=e&&!isNaN(e)));return 0===t.length?-1/0:Math.max(...t)},a=o(s),n=o(i);return n-a})),t=e.map((e=>{const t=this.signals[e]||[],s=t.map((e=>e.signalTime)).filter((e=>null!=e&&!isNaN(e))),i=s.length>0?Math.max(...s):-1/0;return`${e}: ${i===-1/0?"No Signal":new Date(i).toLocaleTimeString()}`}));return console.log("Final sorted order (newest first):",t),e},watchlistWithActiveSignals(){return this.sortedWatchlist.filter((e=>{const t=this.signals[e]||[];return t.some((e=>e.is_active))}))},smbOnlyTickers(){const e=Object.keys(this.signals),t=e.filter((e=>{if(this.watchlist.includes(e))return!1;const t=this.signals[e]||[],s=t.some((e=>"Back$ide"===e.pattern||"Second Chance"===e.pattern||"Rubberband"===e.pattern||"Fashionably Late"===e.pattern||"VWAP Cons"===e.pattern));return!!s&&("active-signals"!==this.viewMode||t.some((e=>e.is_active)))}));return t.sort(((e,t)=>{const s=this.signals[e]||[],i=this.signals[t]||[],o=e=>0===e.length?0:Math.max(...e.map((e=>e.signalTime||0))),a=o(s),n=o(i);return n-a}))}},mounted(){console.log("WatchList mounted, sortByTime:",this.sortByTime);const e=window.location.hostname,t="localhost"===e||"127.0.0.1"===e||e.startsWith("192.")||e.startsWith("10.");t?(console.log("Running in LOCAL mode (hostname:",e+")"),this.initIndicatorsWebSocket(),this.fetchWatchlist(),this.fetchSignals(),setInterval((()=>{this.fetchSignals()}),5e3)):(console.log("Running in REMOTE mode - polling data.json (hostname:",e+")"),this.pollDataJson(),setInterval((()=>{this.pollDataJson()}),1e4)),setInterval((()=>{this.currentTime=Date.now()}),1e3);const s=localStorage.getItem("alertSoundEnabled");null!==s&&(this.alertSoundEnabled="true"===s);const i=localStorage.getItem("selectedChime");i&&(this.selectedChime=i),document.addEventListener("click",(()=>{this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext))}),{once:!0})},beforeUnmount(){this.indicatorsWs&&this.indicatorsWs.close()},watch:{sortByTime(e){console.log("sortByTime changed to:",e)},watchlist(e){console.log("watchlist changed, length:",e.length)},signals(e){console.log("signals changed, tickers:",Object.keys(e))}},methods:{decryptData(e,t){try{const s=Ie().enc.Base64.parse(e),i=Ie().lib.WordArray.create(s.words.slice(0,4)),o=Ie().lib.WordArray.create(s.words.slice(4)),a=Ie().PBKDF2(t,this.encryptionSalt,{keySize:8,iterations:1e5,hasher:Ie().algo.SHA256}),n=Ie().AES.decrypt({ciphertext:o},a,{iv:i,mode:Ie().mode.CBC,padding:Ie().pad.Pkcs7}),l=n.toString(Ie().enc.Utf8);if(!l)throw new Error("Decryption failed - wrong password?");return JSON.parse(l)}catch(s){throw console.error("Decryption error:",s),s}},async fetchWatchlist(){try{const e=await _e.A.get(`${this.apiBaseUrl}/watchlist/daily`);this.watchlist=e.data||[]}catch(e){console.error("Error fetching watchlist:",e)}},async fetchSignals(){try{const e=await _e.A.get(`${this.apiBaseUrl}/signals?date=${this.signalDate}`),t=e.data||[],s={};t.forEach((e=>{let t,i,o;if(e.ticker)t=e.ticker;else{if(!e.symbol)return void console.warn("Skipping signal without ticker/symbol:",e);t=e.symbol}if(e.direction)i=e.direction;else if(e.manipulation_direction)i=e.manipulation_direction;else{if(!e.signal)return void console.warn("Skipping signal without direction:",e);i=e.signal}if(!e.timestamp&&!e.time)return void console.warn("Skipping signal without timestamp:",e);o=e.strategy?"VWAP"===e.strategy?"VWAP Cons":e.strategy:e.scalp?e.scalp:e.signal_type?e.signal_type.includes("MANIPULATION_REVERSAL_WATCH")?"MR Watch":e.signal_type.includes("MANIPULATION_REVERSAL")?"ManipulationReversal":e.signal_type.includes("VWAP")?"VWAP Cons":e.signal_type:"Unknown",s[t]||(s[t]=[]);const a=e.timestamp||e.time;let n;if(a.includes("T")&&a.endsWith("Z"))n=new Date(a);else if(a.includes("T")){const[e,t]=a.split("T"),[s,i,o]=t.split(":").map(Number),l=`${e}T${String(s).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(o||0).padStart(2,"0")}`,r=new Date(l+"Z"),c=(new Date).toLocaleString("en-US",{timeZone:"America/New_York",timeZoneName:"short"}).includes("EDT")?-4:-5;n=new Date(r.getTime()-60*c*60*1e3)}else if(a.includes(":")){const[e,t,s]=a.split(":").map(Number),i=`${this.signalDate}T${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(s||0).padStart(2,"0")}`,o=new Date(i+"Z"),l=(new Date).toLocaleString("en-US",{timeZone:"America/New_York",timeZoneName:"short"}).includes("EDT")?-4:-5;n=new Date(o.getTime()-60*l*60*1e3)}else console.warn("Unknown timestamp format:",a),n=new Date;const l=new Date,r=Math.abs((l-n)/1e3);let c,d,u;isFinite(r)?r<120?(c=`${Math.floor(r)}s`,d=!0):r<3600?(c=`${Math.floor(r/60)}m`,d=r<300):(c=`${Math.floor(r/3600)}h`,d=!1):(c="—",d=!1),u=n.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"America/New_York"}),s[t].push({pattern:o,timeframe:"1m",time:u,direction:i,entry_price:e.entry_price||"—",stop_loss:e.stop_loss||e.stop_loss_price||"—",risk_per_share:e.risk_per_share||"—",targets:e.targets||{},age:c,is_new:d,is_active:r<1800,timestamp:a,signalTime:n.getTime(),raw_signal:e})}));for(const i in s){const e=s[i].length,t=this.lastSignalCount[i]||0;if(e>t){const e=this.watchlist.includes(i),t=s[i]||[],o=t.some((e=>"Back$ide"===e.pattern||"Second Chance"===e.pattern||"Rubberband"===e.pattern||"Fashionably Late"===e.pattern||"VWAP Cons"===e.pattern));if(e||o){this.playAlertSound(),this.newlyDetectedSignals[i]=Date.now();break}}}for(const i in s)this.lastSignalCount[i]=s[i].length;this.signals=s}catch(e){console.error("Error fetching signals:",e)}},async pollDataJson(){try{if(this.decryptionPassword||(this.decryptionPassword=localStorage.getItem("watchlist_password")),!this.decryptionPassword&&!this.isPasswordPromptShown){this.isPasswordPromptShown=!0;const e=prompt("Enter password to view watchlist data:");if(!e)return void console.log("No password provided");this.decryptionPassword=e,localStorage.setItem("watchlist_password",e)}const t=await fetch(`/data.json.enc?t=${Date.now()}`);if(!t.ok)return void console.error("Failed to fetch data.json.enc:",t.status);const s=await t.text();let i;try{i=this.decryptData(s,this.decryptionPassword)}catch(e){return console.error("Decryption failed:",e),localStorage.removeItem("watchlist_password"),this.decryptionPassword=null,this.isPasswordPromptShown=!1,void alert("Decryption failed. Wrong password?")}if(i.watchlist&&(this.watchlist=i.watchlist),i.indicators&&(this.indicators={...i.indicators}),i.signals){const e={};for(const t of i.signals){const s=t.ticker||t.symbol;if(!s)continue;e[s]||(e[s]=[]);const o=t.strategy||t.signal_type||"Signal",a=(t.direction||"").toUpperCase();let n,l=t.timestamp||t.time||"";if("string"===typeof l&&l){const e=new Date,t=e.toLocaleString("en-US",{timeZone:"America/New_York",timeZoneName:"short"}).includes("EDT")?"-04:00":"-05:00";let s;if(l.includes("T"))s=l;else if(l.match(/^\d{2}:\d{2}(:\d{2})?$/)){const e=i.date||(new Date).toISOString().split("T")[0];s=`${e}T${l}`}else n=new Date,s=null;if(s){const e=s.match(/T\d{2}:\d{2}$/)?s+":00":s,i=e+(e.includes("Z")||e.includes("-0")||e.includes("+0")?"":t);n=new Date(i)}}else n=new Date;const r=new Date,c=Math.abs((r-n)/1e3);let d,u,m;isFinite(c)?c<120?(d=`${Math.floor(c)}s`,u=!0):c<3600?(d=`${Math.floor(c/60)}m`,u=c<300):(d=`${Math.floor(c/3600)}h`,u=!1):(d="—",u=!1),m=n.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"America/New_York"}),e[s].push({pattern:o,timeframe:"1m",time:m,direction:a,entry_price:t.entry_price||"—",stop_loss:t.stop_loss||t.stop_loss_price||"—",risk_per_share:t.risk_per_share||"—",targets:t.targets||{},age:d,is_new:u,is_active:c<1800,timestamp:l,signalTime:n.getTime(),raw_signal:t})}for(const t in e){const s=e[t].length,i=this.lastSignalCount[t]||0;s>i&&(console.log(`New signal detected for ${t}`),this.newlyDetectedSignals[t]=Date.now(),this.playAlertSound())}for(const t in e)this.lastSignalCount[t]=e[t].length;this.signals=e}console.log("Data updated from data.json")}catch(t){console.error("Error polling data.json:",t)}},initIndicatorsWebSocket(){const e=`ws://${window.location.hostname}:8000/ws/indicators`;this.indicatorsWs=new WebSocket(e),this.indicatorsWs.onmessage=e=>{try{const t=JSON.parse(e.data);if("INDICATORS_UPDATE"===t.type){const e=t.data||{};this.indicators={...e}}}catch(t){console.error("Error processing WebSocket message:",t)}},this.indicatorsWs.onerror=e=>{console.error("WebSocket error:",e)},this.indicatorsWs.onclose=()=>{setTimeout((()=>{this.initIndicatorsWebSocket()}),5e3)}},calculateAge(e){if(!e.signalTime)return e.age||"—";const t=this.currentTime,s=Math.abs((t-e.signalTime)/1e3);return isFinite(s)?s<120?`${Math.floor(s)}s`:s<3600?`${Math.floor(s/60)}m`:`${Math.floor(s/3600)}h`:"—"},getSignalsForTicker(e){const t=this.signals[e]||[];return"active-signals"===this.viewMode?t.filter((e=>e.is_active)):t},hasNewSignal(e){const t=this.newlyDetectedSignals[e];if(!t)return!1;const s=Date.now()-t,i=6e5;return s<i},formatSignalText(e){const t=e.direction||"N/A",s=e.entry_price||"—";return`${e.pattern} ${e.timeframe} ${e.time} ${t} @${s}`},getSignalClass(e){const t=e.direction?e.direction.toLowerCase():"unknown",s=`pattern-signal ${t}`,i=e.is_active?"active":"inactive",o=e.is_new?"new-pattern":"";return`${s} ${i} ${o}`.trim()},async addSymbol(e=null){let t=null;if(e&&"string"===typeof e?t=e.toUpperCase():this.newSymbol&&this.newSymbol.trim()&&(t=this.newSymbol.trim().toUpperCase()),t)try{await _e.A.post(`${this.apiBaseUrl}/watchlist/daily`,{symbols:t}),await this.fetchWatchlist(),e&&"string"===typeof e||(this.newSymbol="")}catch(s){console.error("Error adding symbol:",s)}},async removeSymbol(e){try{await _e.A.delete(`${this.apiBaseUrl}/watchlist/daily/${e}`),await this.fetchWatchlist()}catch(t){console.error("Error removing symbol:",t)}},getPrice(e){const t=this.indicators[e]?.periods?.["1min"]?.indicators?.bar?.close;return t?`$${parseFloat(t).toFixed(2)}`:"—"},getPercent(e){const t=this.indicators[e]?.periods?.["1min"]?.indicators?.bar?.close,s=this.indicators[e]?.periods?.["1min"]?.indicators?.bar?.open;if(!t||!s)return"—";const i=(t-s)/s*100;return`${i>0?"+":""}${i.toFixed(1)}%`},getPriceClass(e){const t=this.indicators[e]?.periods?.["1min"]?.indicators?.bar?.close,s=this.indicators[e]?.periods?.["1min"]?.indicators?.bar?.open;return t&&s?t>s?"price-up":"price-down":""},getRSI(e,t){const s=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.oscillators?.rsi14?.value;return s?parseFloat(s).toFixed(1):"—"},getRSIClass(e,t){const s=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.oscillators?.rsi14?.value;if(!s)return"rsi-neutral";const i=parseFloat(s);return i<30?"rsi-oversold":i>70?"rsi-overbought":"rsi-neutral"},getBB(e,t){const s=this.indicators[e]?.periods?.[t]?.indicators?.bar?.close,i=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.bands?.bollinger20_2?.upper,o=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.bands?.bollinger20_2?.lower;if(!s||!i||!o)return"—";const a=(parseFloat(s)-parseFloat(o))/(parseFloat(i)-parseFloat(o))*100;return a.toFixed(0)},getBBClass(e,t){const s=this.indicators[e]?.periods?.[t]?.indicators?.bar?.close,i=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.bands?.bollinger20_2?.upper,o=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.bands?.bollinger20_2?.lower;if(!s||!i||!o)return"bb-mid";const a=(parseFloat(s)-parseFloat(o))/(parseFloat(i)-parseFloat(o))*100;return a<20?"bb-low":a>80?"bb-high":"bb-mid"},getRVOL(e){const t=this.indicators[e]?.periods?.["1min"]?.indicators?.bar?.volume;return!t||isNaN(t)?"—":parseFloat(t).toFixed(1)},getMacdDotClass(e,t){const s=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.oscillators?.macd12_26_9_calc?.macd,i=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.oscillators?.macd12_26_9_calc?.signal;return void 0!==s&&void 0!==i?parseFloat(s)>parseFloat(i)?"dot-green":"dot-red":"dot-black"},getEmaDotClass(e,t,s,i){const o=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.emas?.[`ema${s}`],a=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.emas?.[`ema${i}`];return void 0!==o&&void 0!==a?parseFloat(o)>parseFloat(a)?"dot-green":"dot-red":"dot-black"},getSqueezeSegmentStyle(e,t,s){const i=this.indicators[e]?.periods?.[t]?.indicators?.indicator?.ttmSqueeze;let o;return o=i?i.doubleSqueezeOn?"#ff3860":i.squeezeOn?"#ffdd57":"#adb5bd":"#6c757d",{backgroundColor:o,width:"20%",left:20*s+"%"}},saveAlertSoundPreference(){localStorage.setItem("alertSoundEnabled",this.alertSoundEnabled)},saveChimePreference(){localStorage.setItem("selectedChime",this.selectedChime)},playAlertSound(){if(this.alertSoundEnabled)try{switch(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.selectedChime){case"beep":this.playBeep(this.audioContext);break;case"ding":this.playDing(this.audioContext);break;case"chime":this.playChime(this.audioContext);break;case"bell":this.playBell(this.audioContext);break;case"notification":this.playNotification(this.audioContext);break;case"sonar":this.playSonar(this.audioContext);break;case"ascending":this.playAscending(this.audioContext);break;case"descending":this.playDescending(this.audioContext);break;case"double-beep":this.playDoubleBeep(this.audioContext);break;case"triple-tone":this.playTripleTone(this.audioContext);break;case"urgent":this.playUrgent(this.audioContext);break;case"subtle":this.playSubtle(this.audioContext);break}}catch(e){console.error("Error playing alert sound:",e)}},playBeep(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=800,t.type="sine",s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.3,e.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2),t.start(e.currentTime),t.stop(e.currentTime+.2)},playDing(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=1200,t.type="sine",s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.4,e.currentTime+.005),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)},playChime(e){[1e3,800].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.15*s;i.frequency.value=t,i.type="sine",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.3,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+.25),i.start(a),i.stop(a+.25)}))},playBell(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=1500,t.type="sine",s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.5,e.currentTime+.002),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),t.start(e.currentTime),t.stop(e.currentTime+.5)},playNotification(e){[0,.15,.3].forEach((t=>{const s=e.createOscillator(),i=e.createGain();s.connect(i),i.connect(e.destination);const o=e.currentTime+t;s.frequency.value=900,s.type="sine",i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.25,o+.01),i.gain.exponentialRampToValueAtTime(.01,o+.1),s.start(o),s.stop(o+.1)}))},playSonar(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=600,t.type="sine",t.frequency.setValueAtTime(600,e.currentTime),t.frequency.exponentialRampToValueAtTime(300,e.currentTime+.3),s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.4,e.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)},playAscending(e){[600,800,1e3].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.1*s;i.frequency.value=t,i.type="sine",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.25,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+.12),i.start(a),i.stop(a+.12)}))},playDescending(e){[1200,900,700].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.1*s;i.frequency.value=t,i.type="sine",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.25,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+.12),i.start(a),i.stop(a+.12)}))},playDoubleBeep(e){[0,.2].forEach((t=>{const s=e.createOscillator(),i=e.createGain();s.connect(i),i.connect(e.destination);const o=e.currentTime+t;s.frequency.value=850,s.type="sine",i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.3,o+.01),i.gain.exponentialRampToValueAtTime(.01,o+.15),s.start(o),s.stop(o+.15)}))},playTripleTone(e){[523,659,784].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.15*s;i.frequency.value=t,i.type="sine",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.25,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+.2),i.start(a),i.stop(a+.2)}))},playUrgent(e){[1400,1600,1400,1600].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.08*s;i.frequency.value=t,i.type="square",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.2,a+.005),o.gain.exponentialRampToValueAtTime(.01,a+.07),i.start(a),i.stop(a+.07)}))},playSubtle(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=700,t.type="sine",s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.15,e.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.15),t.start(e.currentTime),t.stop(e.currentTime+.15)},async sendToWindow(e,t){const s=1e4+e,i={ticker:t,timestamp:(new Date).toISOString()};try{const a=await fetch(`http://localhost:${s}/signal`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();console.log(`Ticker ${t} sent to window ${e}:`,n),this.windowTickerMap[e]=t;try{await fetch(`http://localhost:${s}/focus`,{method:"POST"})}catch(o){console.warn(`Could not focus window ${e}:`,o)}}catch(a){console.error(`Failed to send ticker to window ${e}:`,a),alert(`Failed to send to window ${e}: ${a.message}`)}},isTickerInWindow(e,t){return this.windowTickerMap[t]===e},async bringAllWindowsForward(){for(let t=1;t<=6;t++){const s=1e4+t;try{await fetch(`http://localhost:${s}/focus`,{method:"POST"})}catch(e){console.warn(`Could not focus window ${t}:`,e)}}},parseSignalTimestamp(e){const t=e.timestamp||e.time;if(!t)return 0;let s;if(t.includes("T")){const e=t.endsWith("Z")?t:t+"Z";s=new Date(e)}else{if(!t.includes(":"))return 0;s=new Date(`${this.signalDate}T${t}`)}return s.getTime()}}};const Pe=(0,r.A)(Fe,[["render",Me],["__scopeId","data-v-42c7d208"]]);var Re=Pe;const De={class:"watchlist-panel"},We={class:"header-container"},xe={class:"nav-links"},Ne={key:0,class:"alert-triangle"},Oe={class:"timestamp-text"},Be={key:0,class:"alerts-panel"},Ve={class:"alerts-container"},Ue={key:0,class:"alerts-section"},Xe={class:"alert-items-container"},He=["title"],ze={class:"alert-source"},Qe={class:"alert-time"},qe={class:"alert-symbol"},je={class:"alert-action"},Ke={class:"alert-price"},Ge={key:0,class:"alert-raw-action"},Ye={key:1,class:"alert-level"},Je={key:2,class:"alert-instrument"},Ze={key:3,class:"alert-position"},et={key:1,class:"alerts-section"},tt={class:"alert-items-container"},st={class:"scalp-source"},it={class:"scalp-time"},ot={class:"scalp-symbol"},at={class:"scalp-signal"},nt={class:"scalp-data"},lt={class:"controls-container"},rt=["disabled"],ct={key:1,class:"time-machine-controls"},dt={class:"time-controls"},ut=["max"],mt={class:"playback-controls"},ht=["disabled"],pt=["disabled"],gt={class:"table-container"},St={class:"col-symbol"},kt=["onClick"],bt={class:"symbol-with-badge"},ft={class:"col-price"},vt={class:"col-macd-bar"},wt={class:"macd-horizontal-bar"},yt=["innerHTML"],Lt={class:"col-ema-bar"},Ct={class:"ema-horizontal-bar"},Tt={class:"col-ema-bar"},At={class:"ema-horizontal-bar"},Et={class:"col-cmf-bar"},Mt={class:"cmf-horizontal-bar"},_t={class:"cmf-value"},$t={class:"col-vwap-bar"},It={class:"vwap-horizontal-bar"},Ft={class:"vwap-value"},Pt={class:"col-squeeze-bar"},Rt={class:"squeeze-horizontal-bar"},Dt=["innerHTML"],Wt={class:"connection-status"};function xt(e,t,s,a,n,l){const r=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",De,[(0,o.Lk)("div",We,[t[14]||(t[14]=(0,o.Lk)("h1",null,"Real-Time Stock Tracker",-1)),(0,o.Lk)("div",xe,[(0,o.bF)(r,{to:"/signals",class:"nav-link"},{default:(0,o.k6)((()=>t[13]||(t[13]=[(0,o.eW)("📊 Signals")]))),_:1})]),(0,o.Lk)("div",{class:(0,m.C4)(["timestamp-display",l.timestampStatusClass])},[l.isTimestampStale?((0,o.uX)(),(0,o.CE)("span",Ne,"⚠️")):(0,o.Q3)("",!0),(0,o.Lk)("span",Oe,(0,m.v_)(l.displayTimestamp),1)],2)]),l.todayAlerts.length>0||l.todayScalpData.length>0?((0,o.uX)(),(0,o.CE)("div",Be,[(0,o.Lk)("div",Ve,[l.todayAlerts.length>0?((0,o.uX)(),(0,o.CE)("div",Ue,[(0,o.Lk)("div",Xe,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.todayAlerts.slice(-10),(e=>((0,o.uX)(),(0,o.CE)("div",{class:(0,m.C4)(["alert-item",l.getAlertAgeClass(e.timestamp)]),key:e.message_id,title:e.data?.original_message||"No original message"},[(0,o.Lk)("span",ze,(0,m.v_)(e.source||"Unknown"),1),(0,o.Lk)("span",Qe,(0,m.v_)(l.formatAlertTimeShort(e.timestamp)),1),(0,o.Lk)("span",qe,(0,m.v_)(e.data?.symbol||"N/A"),1),(0,o.Lk)("span",je,(0,m.v_)(e.data?.action||"N/A"),1),(0,o.Lk)("span",Ke,"$"+(0,m.v_)(e.data?.price||"N/A"),1),e.data?.raw_action?((0,o.uX)(),(0,o.CE)("span",Ge,"raw: "+(0,m.v_)(e.data.raw_action),1)):(0,o.Q3)("",!0),e.data?.level?((0,o.uX)(),(0,o.CE)("span",Ye,"level: "+(0,m.v_)(e.data.level),1)):(0,o.Q3)("",!0),e.data?.data?.instrument_type?((0,o.uX)(),(0,o.CE)("span",Je,(0,m.v_)(e.data.data.instrument_type),1)):(0,o.Q3)("",!0),l.getPositionSizePercent(e)?((0,o.uX)(),(0,o.CE)("span",Ze,(0,m.v_)(l.getPositionSizePercent(e))+"%",1)):(0,o.Q3)("",!0)],10,He)))),128))])])):(0,o.Q3)("",!0),l.todayScalpData.length>0?((0,o.uX)(),(0,o.CE)("div",et,[(0,o.Lk)("div",tt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.todayScalpData.slice(-10),(e=>((0,o.uX)(),(0,o.CE)("div",{class:(0,m.C4)(["scalp-item",l.getAlertAgeClass(e.timestamp)]),key:e.message_id},[(0,o.Lk)("span",st,(0,m.v_)(e.source||"Unknown"),1),(0,o.Lk)("span",it,(0,m.v_)(l.formatAlertTimeShort(e.timestamp)),1),(0,o.Lk)("span",ot,(0,m.v_)(e.data?.symbol||"N/A"),1),(0,o.Lk)("span",at,(0,m.v_)(e.data?.signal||"N/A"),1),(0,o.Lk)("span",nt,(0,m.v_)(e.data?.scalp||"N/A"),1)],2)))),128))])])):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",lt,[(0,o.Lk)("button",{type:"button",onClick:t[0]||(t[0]=(...e)=>l.bringAllWindowsForward&&l.bringAllWindowsForward(...e)),class:"bring-forward-btn",title:"Bring all windows to front"}," 🪟 Bring All Forward "),(0,o.Lk)("form",{onSubmit:t[5]||(t[5]=(0,i.D$)(((...e)=>l.addSymbol&&l.addSymbol(...e)),["prevent"])),class:"add-symbol-form"},[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>n.newSymbol=e),placeholder:"Enter symbol (e.g., AAPL)",onKeyup:t[2]||(t[2]=(0,i.jR)((0,i.D$)(((...e)=>l.addSymbol&&l.addSymbol(...e)),["prevent"]),["enter"])),onDblclick:t[3]||(t[3]=(0,i.D$)(((...e)=>l.selectAllText&&l.selectAllText(...e)),["prevent"])),class:"symbol-input",ref:"symbolInput"},null,544),[[i.Jo,n.newSymbol]]),(0,o.Lk)("button",{type:"submit",disabled:!n.newSymbol.trim(),class:"add-btn"},"+",8,rt),(0,o.Lk)("button",{type:"button",onClick:t[4]||(t[4]=(...e)=>l.toggleMode&&l.toggleMode(...e)),class:(0,m.C4)([{active:n.timeMachineMode},"mode-btn-compact"])},(0,m.v_)(n.timeMachineMode?"📊":"⏰"),3),n.addSymbolMessage?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,m.C4)(["message-inline",n.addSymbolStatus])},(0,m.v_)(n.addSymbolMessage),3)):(0,o.Q3)("",!0)],32)]),n.timeMachineMode?((0,o.uX)(),(0,o.CE)("div",ct,[(0,o.Lk)("div",dt,[(0,o.bo)((0,o.Lk)("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=e=>n.selectedDate=e),onChange:t[7]||(t[7]=(...e)=>l.loadAvailableTimestamps&&l.loadAvailableTimestamps(...e))},null,544),[[i.Jo,n.selectedDate]]),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":t[8]||(t[8]=e=>n.currentTimestampIndex=e),max:n.availableTimestamps.length-1,onInput:t[9]||(t[9]=(...e)=>l.seekToTimestamp&&l.seekToTimestamp(...e)),class:"time-slider"},null,40,ut),[[i.Jo,n.currentTimestampIndex]]),(0,o.Lk)("div",mt,[(0,o.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>l.play&&l.play(...e)),disabled:n.isPlaying,class:"play-btn"},"▶️",8,ht),(0,o.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>l.pause&&l.pause(...e)),disabled:!n.isPlaying,class:"pause-btn"},"⏸️",8,pt),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>n.playbackSpeed=e),class:"speed-select"},t[15]||(t[15]=[(0,o.Lk)("option",{value:"1"},"1x",-1),(0,o.Lk)("option",{value:"5"},"5x",-1),(0,o.Lk)("option",{value:"10"},"10x",-1),(0,o.Lk)("option",{value:"60"},"60x",-1)]),512),[[i.u1,n.playbackSpeed]])])])])):(0,o.Q3)("",!0),t[17]||(t[17]=(0,o.Lk)("div",{class:"info"}," Divergences: BD = Bullish Divergence, BR = Bearish Divergence | BB% = Position within Bollinger Bands | CMF = Chaikin Money Flow | VWAP± = Distance from VWAP ",-1)),(0,o.Lk)("div",gt,[(0,o.Lk)("table",null,[t[16]||(t[16]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",{class:"group-header"},[(0,o.Lk)("th",{rowspan:"2",class:"col-symbol"},"Symbol"),(0,o.Lk)("th",{rowspan:"2",class:"col-price"},"Price"),(0,o.Lk)("th",{rowspan:"2",class:"col-percent"},"%"),(0,o.Lk)("th",{rowspan:"2",class:"col-macd-bar"},"MACD"),(0,o.Lk)("th",{colspan:"5"},"Relative Strength Index (RSI)"),(0,o.Lk)("th",{rowspan:"2",class:"col-ema-bar"},"9/21"),(0,o.Lk)("th",{rowspan:"2",class:"col-ema-bar"},"21/50"),(0,o.Lk)("th",{rowspan:"2",class:"col-cmf-bar"},"Chakin Money Flow (CMF)"),(0,o.Lk)("th",{rowspan:"2",class:"col-vwap-bar"},"VWAP±"),(0,o.Lk)("th",{rowspan:"2",class:"col-squeeze-bar"},"Squeeze"),(0,o.Lk)("th",{rowspan:"2",class:"col-volume"},"Vol%"),(0,o.Lk)("th",{colspan:"5"},"Signal"),(0,o.Lk)("th",{colspan:"5"},"Stochastics"),(0,o.Lk)("th",{colspan:"5"},"BB%")]),(0,o.Lk)("tr",null,[(0,o.Lk)("th",{class:"col-compact"},"1m"),(0,o.Lk)("th",{class:"col-compact"},"2m"),(0,o.Lk)("th",{class:"col-compact"},"3m"),(0,o.Lk)("th",{class:"col-compact"},"5m"),(0,o.Lk)("th",{class:"col-compact"},"15m"),(0,o.Lk)("th",{class:"col-compact"},"1m"),(0,o.Lk)("th",{class:"col-compact"},"2m"),(0,o.Lk)("th",{class:"col-compact"},"3m"),(0,o.Lk)("th",{class:"col-compact"},"5m"),(0,o.Lk)("th",{class:"col-compact"},"15m"),(0,o.Lk)("th",{class:"col-compact"},"1m"),(0,o.Lk)("th",{class:"col-compact"},"2m"),(0,o.Lk)("th",{class:"col-compact"},"3m"),(0,o.Lk)("th",{class:"col-compact"},"5m"),(0,o.Lk)("th",{class:"col-compact"},"15m"),(0,o.Lk)("th",{class:"col-compact"},"1m"),(0,o.Lk)("th",{class:"col-compact"},"2m"),(0,o.Lk)("th",{class:"col-compact"},"3m"),(0,o.Lk)("th",{class:"col-compact"},"5m"),(0,o.Lk)("th",{class:"col-compact"},"15m")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.sortedSymbols,(e=>((0,o.uX)(),(0,o.CE)("tr",{key:e},[(0,o.Lk)("td",St,[(0,o.Lk)("button",{onClick:t=>l.removeSymbol(e),class:"remove-btn",title:"Remove from watchlist"}," ✕ ",8,kt),(0,o.Lk)("span",bt,[(0,o.eW)((0,m.v_)(e)+" ",1),"smb"===l.getSymbolSource(e)||"ttg"===l.getSymbolSource(e)?((0,o.uX)(),(0,o.CE)("span",{key:0,class:(0,m.C4)(["alert-badge",l.getSymbolSource(e)])},(0,m.v_)(l.getSymbolSource(e).toUpperCase()),3)):(0,o.Q3)("",!0)])]),(0,o.Lk)("td",ft,[(0,o.Lk)("span",{class:(0,m.C4)(l.getPriceChangeClass(e))},(0,m.v_)(l.getPriceDirection(e)),3),(0,o.eW)(" "+(0,m.v_)(l.getPrice(e)),1)]),(0,o.Lk)("td",{class:(0,m.C4)(["col-percent",l.getPriceChangeClass(e)])},(0,m.v_)(l.getPricePercent(e)),3),(0,o.Lk)("td",vt,[(0,o.Lk)("div",wt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"macd-segment-"+t,class:(0,m.C4)(["macd-segment",l.getMacdDotClass(e,t)]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,(t=>((0,o.uX)(),(0,o.CE)("td",{class:(0,m.C4)(["col-compact",l.getRsiClass(e,t)]),key:"rsi-"+t,innerHTML:l.getRsiValue(e,t)},null,10,yt)))),128)),(0,o.Lk)("td",Lt,[(0,o.Lk)("div",Ct,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"ema921-segment-"+t,class:(0,m.C4)(["ema-segment",l.getEmaDotClass(e,t,"9","21")]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),(0,o.Lk)("td",Tt,[(0,o.Lk)("div",At,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"ema2150-segment-"+t,class:(0,m.C4)(["ema-segment",l.getEmaDotClass(e,t,"21","50")]),style:(0,m.Tr)({width:"20%",left:20*s+"%"})},null,6)))),128))])]),(0,o.Lk)("td",Et,[(0,o.Lk)("div",Mt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"cmf-segment-"+t,class:"cmf-segment",style:(0,m.Tr)(l.getCMFSegmentStyle(e,t,s))},[(0,o.Lk)("span",_t,(0,m.v_)(l.getCMFShort(e,t)),1)],4)))),128))])]),(0,o.Lk)("td",$t,[(0,o.Lk)("div",It,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"vwap-segment-"+t,class:"vwap-segment",style:(0,m.Tr)(l.getVWAPSegmentStyle(e,t,s))},[(0,o.Lk)("span",Ft,(0,m.v_)(l.getVWAPShort(e,t)),1)],4)))),128))])]),(0,o.Lk)("td",Pt,[(0,o.Lk)("div",Rt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,((t,s)=>((0,o.uX)(),(0,o.CE)("div",{key:"squeeze-segment-"+t,class:"squeeze-segment",style:(0,m.Tr)(l.getSqueezeSegmentStyle(e,t,s))},null,4)))),128))])]),(0,o.Lk)("td",{class:(0,m.C4)(["col-volume",l.getVolumeClass(e)])},(0,m.v_)(l.getVolumePercent(e)),3),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,(t=>((0,o.uX)(),(0,o.CE)("td",{class:"col-compact",key:"signal-"+t},(0,m.v_)(l.getSignal(e,t)),1)))),128)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,(t=>((0,o.uX)(),(0,o.CE)("td",{class:(0,m.C4)(["col-compact",l.getStochasticClass(e,t)]),key:"stoch-"+t,innerHTML:l.getStochasticValue(e,t)},null,10,Dt)))),128)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.indicatorPeriods,(t=>((0,o.uX)(),(0,o.CE)("td",{class:"col-compact",key:"bb-"+t},(0,m.v_)(l.getBollingerBands(e,t)),1)))),128))])))),128))])])]),t[18]||(t[18]=(0,o.Lk)("div",{class:"info",style:{"margin-top":"15px"}},[(0,o.Lk)("strong",null,"Key:"),(0,o.eW)(" BD = Bullish Divergence (price makes lower low, indicator makes higher low) | BR = Bearish Divergence (price makes higher high, indicator makes lower high) | BB% < 20% = Oversold, > 80% = Overbought | CMF > 0 = Accumulation, < 0 = Distribution | VWAP± shows distance from VWAP (mean reversion opportunities) ")],-1)),(0,o.Lk)("div",Wt,[(0,o.Lk)("span",{class:(0,m.C4)(l.connectionStatusClass)},(0,m.v_)(n.connectionStatus),3)])])}s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698);const Nt=["1min","2min","3min","5min","15min"];var Ot={name:"WatchList",data(){return{indicatorsMap:{},watchlist:[],indicatorsWs:null,connectionStatus:"Disconnected",reconnectDelay:3e3,isReconnecting:!1,debugCounter:0,wsConnectionId:null,lastSymbolCount:null,pendingAdds:new Set,pendingRemoves:new Set,timeMachineMode:!1,selectedDate:"",availableTimestamps:[],currentTimestampIndex:0,isPlaying:!1,playbackSpeed:1,playbackInterval:null,sliderDebounceTimeout:null,latestDataTimestamp:null,currentDisplayTimestamp:null,newSymbol:"",addSymbolMessage:"",addSymbolStatus:"",alertsWs:null,alertsData:{alerts:[],scalp_data:[],last_updated:null}}},computed:{sortedSymbols(){const e=Object.keys(this.indicatorsMap).filter((e=>e&&""!==e.trim()));return e.sort(((e,t)=>{const s=this.getSymbolSource(e),i=this.getSymbolSource(t),o="smb"===s||"ttg"===s,a="smb"===i||"ttg"===i;return o&&!a?-1:!o&&a?1:e.localeCompare(t)}))},connectionStatusClass(){return{"status-connected":"Connected"===this.connectionStatus,"status-connecting":"Connecting..."===this.connectionStatus,"status-disconnected":"Disconnected"===this.connectionStatus}},currentTimestamp(){return this.availableTimestamps[this.currentTimestampIndex]||0},displayTimestamp(){const e=this.timeMachineMode?this.currentDisplayTimestamp:this.latestDataTimestamp;if(!e)return"No data";const t=new Date(1e3*e),s=new Date,i=(s.getTime()-t.getTime())/1e3;if(!this.timeMachineMode&&i<5)return"Live";const o=t.toLocaleString("en-US",{timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),a=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return`${o} EDT (${a} local)`},isTimestampStale(){if(!this.latestDataTimestamp||this.timeMachineMode)return!1;const e=Date.now()/1e3,t=e-this.latestDataTimestamp;return t>10},timestampStatusClass(){return{"timestamp-fresh":!this.isTimestampStale,"timestamp-stale":this.isTimestampStale}},indicatorPeriods(){return Nt},todayAlerts(){const e=new Date;e.setHours(0,0,0,0);const t=e.getTime()/1e3;return this.alertsData.alerts.filter((e=>{if(!e.timestamp)return!1;const s=new Date(1e3*e.timestamp);s.setHours(0,0,0,0);const i=s.getTime()/1e3;return i===t}))},todayScalpData(){const e=new Date;e.setHours(0,0,0,0);const t=e.getTime()/1e3;return this.alertsData.scalp_data.filter((e=>{if(!e.timestamp)return!1;const s=new Date(1e3*e.timestamp);s.setHours(0,0,0,0);const i=s.getTime()/1e3;return i===t}))}},mounted(){this.selectedDate=this.getTodaysDate(),this.fetchWatchlist(),this.initIndicatorsWebSocket(),this.initAlertsWebSocket()},beforeUnmount(){this.indicatorsWs&&this.indicatorsWs.close(),this.alertsWs&&this.alertsWs.close(),this.sliderDebounceTimeout&&clearTimeout(this.sliderDebounceTimeout),this.pause()},methods:{toggleMode(){this.sliderDebounceTimeout&&(clearTimeout(this.sliderDebounceTimeout),this.sliderDebounceTimeout=null),this.timeMachineMode=!this.timeMachineMode,this.timeMachineMode?(this.pause(),this.indicatorsWs&&this.indicatorsWs.close(),this.connectionStatus="Time Machine Mode",this.loadAvailableTimestamps()):(this.pause(),this.connectionStatus="Disconnected",this.initIndicatorsWebSocket())},async loadAvailableTimestamps(){try{const e=await fetch(`http://${window.location.hostname}:8000/api/timemachine/timestamps?date=${this.selectedDate}`);if(e.ok){const t=await e.json();this.availableTimestamps=t.timestamps,this.currentTimestampIndex=0,this.availableTimestamps.length>0&&await this.updateWatchlistData()}}catch(e){console.error("Failed to load timestamps:",e)}},seekToTimestamp(){this.sliderDebounceTimeout&&clearTimeout(this.sliderDebounceTimeout),this.sliderDebounceTimeout=setTimeout((async()=>{this.timeMachineMode&&this.availableTimestamps.length>0&&await this.updateWatchlistData()}),300)},play(){this.timeMachineMode&&0!==this.availableTimestamps.length&&(this.isPlaying=!0,this.playbackInterval=setInterval((()=>{this.currentTimestampIndex<this.availableTimestamps.length-1?(this.currentTimestampIndex++,this.updateWatchlistData()):this.pause()}),1e3/this.playbackSpeed))},pause(){this.isPlaying=!1,this.playbackInterval&&(clearInterval(this.playbackInterval),this.playbackInterval=null)},async updateWatchlistData(){if(this.timeMachineMode&&this.currentTimestamp)try{const e=await fetch(`http://${window.location.hostname}:8000/api/timemachine/bulk?timestamp=${this.currentTimestamp}`);if(e.ok){const t=await e.json();this.updateSymbolsWithHistoricalData(t.symbols),t.timestamp&&(this.currentDisplayTimestamp=t.timestamp/1e3)}}catch(e){console.error("Failed to update watchlist data:",e)}},updateSymbolsWithHistoricalData(e){if(!e)return;const t={};for(const[s,i]of Object.entries(e))if(s&&""!==s.trim()){t[s]={};for(const[e,o]of Object.entries(i))o&&(t[s][e]={timestamp:o.timestamp,last_updated:(new Date).toISOString(),indicators:{bar:o.ohlc,indicator:o.indicators}})}this.indicatorsMap=t,this.debugCounter++},formatTime(e){if(!e)return"--:--";const t=new Date(1e3*e);return t.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})},async addSymbol(){if(!this.newSymbol.trim())return;const e=this.newSymbol.trim().toUpperCase();try{const t=await fetch(`http://${window.location.hostname}:8000/api/indicators/symbol`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e})});if(t.ok)await t.json(),this.newSymbol="",this.pendingAdds.add(e),this.indicatorsMap[e]={source:"daily_watchlist",periods:{}};else{const s=await t.json();this.addSymbolMessage=s.detail||`Failed to add ${e}`,this.addSymbolStatus="error",setTimeout((()=>{this.addSymbolMessage="",this.addSymbolStatus=""}),5e3)}}catch(t){console.error("Error adding symbol:",t),this.addSymbolMessage="Network error. Please try again.",this.addSymbolStatus="error",setTimeout((()=>{this.addSymbolMessage="",this.addSymbolStatus=""}),5e3)}},async removeSymbol(e){if(!confirm(`Are you sure you want to remove ${e} from the watchlist?`))return;const t=(new Date).toISOString(),s=Object.keys(this.indicatorsMap).length;console.log(`🗑️ REMOVE CLICKED: Symbol=${e}, Time=${t}, CurrentSymbolCount=${s}`);try{const t=await fetch(`http://${window.location.hostname}:8000/api/indicators/symbol/${e}`,{method:"DELETE"});if(t.ok)await t.json(),this.pendingRemoves.add(e),delete this.indicatorsMap[e];else{const s=await t.json();this.addSymbolMessage=s.detail||`Failed to remove ${e}`,this.addSymbolStatus="error",setTimeout((()=>{this.addSymbolMessage="",this.addSymbolStatus=""}),5e3)}}catch(i){console.error("Error removing symbol:",i),this.addSymbolMessage="Network error. Please try again.",this.addSymbolStatus="error",setTimeout((()=>{this.addSymbolMessage="",this.addSymbolStatus=""}),5e3)}},getTodaysDate(){const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${i}`},selectAllText(e){e.preventDefault(),e.stopPropagation(),e.target.select()},initAlertsWebSocket(){this.alertsWs&&this.alertsWs.close(),console.log("Initializing alerts WebSocket connection"),this.alertsWs=new WebSocket(`ws://${window.location.hostname}:8000/ws/alerts`),this.alertsWs.onopen=()=>{console.log("Alerts WebSocket connected")},this.alertsWs.onmessage=e=>{try{const t=JSON.parse(e.data);"ALERTS_UPDATE"===t.type&&(this.alertsData=t.data)}catch(t){console.error("Error parsing alerts message:",t)}},this.alertsWs.onerror=e=>{console.error("Alerts WebSocket error:",e)},this.alertsWs.onclose=()=>{console.log("Alerts WebSocket disconnected"),setTimeout((()=>{this.timeMachineMode||this.initAlertsWebSocket()}),5e3)}},formatAlertTime(e){if(!e)return"--:--";const t=new Date(1e3*e),s=t.toLocaleTimeString("en-US",{timeZone:"America/New_York",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),i=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return`${s} EDT (${i} local)`},formatAlertTimeShort(e){if(!e)return"--:--";const t=new Date(1e3*e),s=t.toLocaleTimeString("en-US",{timeZone:"America/New_York",hour:"2-digit",minute:"2-digit",hour12:!1}),i=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1});return`${s} (${i})`},formatAlertData(e){if(!e)return"No data";const t=Object.entries(e);return 0===t.length?"Empty":t.map((([e,t])=>`${e}: ${t}`)).join(", ")},getPositionSizePercent(e){return e.data?.position_size_percent?e.data.position_size_percent:e.data?.position_size?e.data.position_size:e.data?.data?.position_size_percent?e.data.data.position_size_percent:null},getAlertAgeClass(e){if(!e)return"alert-old";const t=Date.now()/1e3,s=t-e,i=600;return s<=i?"alert-recent":"alert-old"},mapPeriodKey(e){return e},async fetchWatchlist(){try{const e=await fetch(`http://${window.location.hostname}:8000/api/watchlist`);e.ok&&(this.watchlist=await e.json())}catch(e){console.error("Failed to fetch watchlist:",e)}},isInWatchlist(e){return this.watchlist.includes(e)},async addToWatchlist(e){if(!this.isInWatchlist(e))try{const t=await fetch(`http://${window.location.hostname}:8000/api/watchlist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbols:e})});if(!t.ok)throw new Error(`Add to watchlist failed: HTTP ${t.status}`);{const s=await t.json();this.watchlist=s.watchlist,console.log(`Added ${e} to watchlist`)}}catch(t){console.error("Failed to add symbol to watchlist:",t)}},initIndicatorsWebSocket(){if(this.isReconnecting)return;this.indicatorsWs&&this.indicatorsWs.readyState!==WebSocket.CLOSED&&(console.log("⚠️ Closing existing WebSocket before creating new one"),this.indicatorsWs.close()),this.connectionStatus="Connecting...";const e=`ws://${window.location.hostname}:8000/ws/indicators`;this.wsConnectionId=Math.random().toString(36).substring(7),console.log(`🔌 Creating new WebSocket connection to ${e} with ID: ${this.wsConnectionId}`),this.indicatorsWs=new WebSocket(e),this.indicatorsWs.onopen=()=>{console.log(`Indicators WebSocket connected (ID: ${this.wsConnectionId})`),this.connectionStatus="Connected",this.isReconnecting=!1},this.indicatorsWs.onmessage=e=>{try{const t=JSON.parse(e.data);if("INDICATORS_UPDATE"===t.type){const e=Object.keys(t.data||{});this.lastSymbolCount&&this.lastSymbolCount===e.length||(console.log(`📨 WS: Count ${this.lastSymbolCount||0} → ${e.length} symbols`),this.lastSymbolCount=e.length);const s=t.data||{},i=Object.keys(this.indicatorsMap||{}),o={...s};for(const t of this.pendingAdds)o[t]?this.pendingAdds.delete(t):o[t]={source:"daily_watchlist",periods:{}};for(const t of this.pendingRemoves)o[t]?delete o[t]:this.pendingRemoves.delete(t);const a=Object.keys(o),n=i.filter((e=>!a.includes(e))),l=a.filter((e=>!i.includes(e)));n.length>0&&console.log(`🗑️ Removed: ${n.join(", ")}`),l.length>0&&console.log(`➕ Added: ${l.join(", ")}`),this.indicatorsMap=o,this.debugCounter++,t.latest_pubsub_timestamp?this.latestDataTimestamp=t.latest_pubsub_timestamp:console.log("No latest_pubsub_timestamp in message")}}catch(t){console.error("Error parsing indicators message:",t),console.error("Raw message data:",e.data),console.error("Message length:",e.data.length),console.log("Closing WebSocket due to parse error and reconnecting..."),this.indicatorsWs.close()}},this.indicatorsWs.onerror=e=>{console.error("Indicators WebSocket error:",e),console.error("WebSocket error details:",{type:e.type,target:e.target,timeStamp:e.timeStamp}),this.connectionStatus="Disconnected"},this.indicatorsWs.onclose=e=>{console.log("Indicators WebSocket closed:",e.code,e.reason),console.log("WebSocket close details:",{code:e.code,reason:e.reason,wasClean:e.wasClean,timeStamp:e.timeStamp}),this.connectionStatus="Disconnected",this.isReconnecting||this.timeMachineMode||(this.isReconnecting=!0,console.log(`Reconnecting indicators WebSocket in ${this.reconnectDelay}ms...`),setTimeout((()=>{console.log("Attempting to reconnect indicators WebSocket..."),this.isReconnecting=!1,this.initIndicatorsWebSocket()}),this.reconnectDelay))}},getSymbolSource(e){const t=this.indicatorsMap[e];return t?.source||"unknown"},getPrice(e){const t=this.indicatorsMap[e];if(!t||!t.periods||!t.periods["1min"])return"-";const s=t.periods["1min"].indicators?.bar;return s&&s.close?parseFloat(s.close).toFixed(2):"-"},getPriceDirection(){return"↓"},getPricePercent(){return"-"},getPriceChangeClass(){return"red"},getMacdDotClass(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.indicator?.oscillators?.macd12_26_9_calc?.macd,a=s?.periods?.[i]?.indicators?.indicator?.oscillators?.macd12_26_9_calc?.signal;if(void 0!==o&&void 0!==a){const e=parseFloat(o)>parseFloat(a)?"dot-green":"dot-red";return e}return"dot-black"},getRsiValue(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.indicator?.oscillators?.rsi14?.value;if(void 0!==o&&null!==o){const e=parseFloat(o).toFixed(1),t=s?.periods?.[i]?.indicators?.indicator?.oscillators?.rsi14?.slope;let a="→",n="gray";return t>0?(a="↑",n="green"):t<0&&(a="↓",n="red"),`${e}<span class="${n}">${a}</span>`}return"-"},getRsiClass(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.indicator?.oscillators?.rsi14?.value;if(void 0!==o&&null!==o){const e=parseFloat(o);if(e>70)return"green";if(e<20)return"red"}return""},getStochasticValue(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.indicator?.oscillators?.stochastic14_3?.k;if(void 0!==o&&null!==o){const e=parseFloat(o).toFixed(0),t=s?.periods?.[i]?.indicators?.indicator?.oscillators?.stochastic14_3?.kSlope;let a="→",n="gray";return t>0?(a="↑",n="green"):t<0&&(a="↓",n="red"),`${e}<span class="${n}">${a}</span>`}return"-"},getStochasticClass(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.indicator?.oscillators?.stochastic14_3?.k;if(void 0!==o&&null!==o){const e=parseFloat(o);if(e>70)return"green";if(e<20)return"red"}return""},getEmaDotClass(e,t,s,i){const o=this.indicatorsMap[e],a=this.mapPeriodKey(t),n=o?.periods?.[a]?.indicators?.indicator?.emas?.[`ema${s}`],l=o?.periods?.[a]?.indicators?.indicator?.emas?.[`ema${i}`];return void 0!==n&&void 0!==l?parseFloat(n)>parseFloat(l)?"dot-green":"dot-red":"dot-black"},getDivergence(){return"-"},getBollingerBands(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.bar?.close,a=s?.periods?.[i]?.indicators?.indicator?.bands?.bollinger20_2?.upper,n=s?.periods?.[i]?.indicators?.indicator?.bands?.bollinger20_2?.lower;if(void 0!==o&&void 0!==a&&void 0!==n){const e=parseFloat(o),t=parseFloat(a),s=parseFloat(n),i=(e-s)/(t-s)*100,l=`${i.toFixed(0)}%`;return l}return"-"},getCMF(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.[i]?.indicators?.indicator?.volumeIndicators?.cmf10;if(void 0!==o&&null!==o){const e=parseFloat(o).toFixed(2),t=parseFloat(o)>=0?`+${e}`:e;return t}return"-"},getCMFShort(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.indicator?.volumeIndicators?.cmf10;if(void 0!==o&&null!==o){const e=parseFloat(o);return Math.abs(e)<.01?"0":e.toFixed(1)}return"-"},getVWAPDistance(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.bar?.close,a=s?.periods?.[i]?.indicators?.indicator?.volumeIndicators?.vwapRetail;if(void 0!==o&&void 0!==a){const e=(parseFloat(o)-parseFloat(a))/parseFloat(a)*100,t=e>=0?"+":"";return`${t}${e.toFixed(1)}%`}return"-"},getVWAPShort(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.periods?.[i]?.indicators?.bar?.close,a=s?.periods?.[i]?.indicators?.indicator?.volumeIndicators?.vwapRetail;if(void 0!==o&&void 0!==a){const e=(parseFloat(o)-parseFloat(a))/parseFloat(a)*100;return Math.abs(e)<.05?"0":e.toFixed(1)}return"-"},getVWAPSegmentStyle(e,t,s){const i=this.indicatorsMap[e],o=this.mapPeriodKey(t),a=i?.[o]?.indicators?.bar?.close,n=i?.[o]?.indicators?.indicator?.volumeIndicators?.vwapRetail;if(void 0!==a&&void 0!==n){const e=(parseFloat(a)-parseFloat(n))/parseFloat(n)*100;let t;if(Math.abs(e)<.05)t="#f8f9fa";else if(e>.05){const s=Math.min(Math.abs(e)/2,1),i=Math.floor(220-220*s),o=Math.floor(255-47*s),a=Math.floor(220-88*s);t=`rgb(${i}, ${o}, ${a})`}else if(e<-.05){const s=Math.min(Math.abs(e)/2,1),i=Math.floor(255-47*s),o=Math.floor(220-164*s),a=Math.floor(220-124*s);t=`rgb(${i}, ${o}, ${a})`}else t="#f8f9fa";return{backgroundColor:t,width:"20%",left:20*s+"%"}}return{backgroundColor:"#f8f9fa",width:"20%",left:20*s+"%"}},getSqueezeDotClass(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.[i]?.indicators?.indicator?.ttmSqueeze;return o?o.doubleSqueezeOn?"dot-red":o.squeezeOn?"dot-yellow":"dot-neutral":"dot-black"},getSqueezeSegmentStyle(e,t,s){const i=this.indicatorsMap[e],o=this.mapPeriodKey(t),a=i?.periods?.[o]?.indicators?.indicator?.ttmSqueeze;let n;return n=a?a.doubleSqueezeOn?"#ff3860":a.squeezeOn?"#ffdd57":"#adb5bd":"#6c757d",{backgroundColor:n,width:"20%",left:20*s+"%"}},getVolumePercent(){return"-"},getVolumeClass(){return""},getSignal(){return"-"},getCMFClass(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.[i]?.indicators?.indicator?.volumeIndicators?.cmf10;return void 0!==o&&null!==o?parseFloat(o)>=0?"cmf-pos":"cmf-neg":""},getCMFSegmentStyle(e,t,s){const i=this.indicatorsMap[e],o=this.mapPeriodKey(t),a=i?.periods?.[o]?.indicators?.indicator?.volumeIndicators?.cmf10;if(void 0!==a&&null!==a){const e=parseFloat(a);let t;if(Math.abs(e)<.01)t="#f8f9fa";else if(e>.01){const s=Math.min(Math.abs(e)/.4,1),i=Math.floor(220-220*s),o=Math.floor(255-47*s),a=Math.floor(220-88*s);t=`rgb(${i}, ${o}, ${a})`}else if(e<-.01){const s=Math.min(Math.abs(e)/.4,1),i=Math.floor(255-47*s),o=Math.floor(220-164*s),a=Math.floor(220-124*s);t=`rgb(${i}, ${o}, ${a})`}else t="#f8f9fa";return{backgroundColor:t,width:"20%",left:20*s+"%"}}return{backgroundColor:"#6c757d",width:"20%",left:20*s+"%"}},getVWAPClass(e,t){const s=this.indicatorsMap[e],i=this.mapPeriodKey(t),o=s?.[i]?.indicators?.bar?.close,a=s?.[i]?.indicators?.indicator?.volumeIndicators?.vwapRetail;if(void 0!==o&&void 0!==a){const e=Math.abs((parseFloat(o)-parseFloat(a))/parseFloat(a)*100);return e>.5?parseFloat(o)>parseFloat(a)?"green vwap-far":"red vwap-far":parseFloat(o)>parseFloat(a)?"green":"red"}return""},async bringAllWindowsForward(){const e=[];for(let t=1;t<=6;t++){const s=1e4+t,i=fetch(`http://localhost:${s}/focus`,{method:"POST"}).catch((e=>{console.error(`Failed to focus window ${t}:`,e)}));e.push(i)}await Promise.all(e),console.log("Brought all windows to front")}}};const Bt=(0,r.A)(Ot,[["render",xt],["__scopeId","data-v-5d65f67e"]]);var Vt=Bt;const Ut={class:"single-ticker-page",ref:"root"},Xt={class:"right-pane"},Ht={class:"ticker-info-row"},zt={class:"signal-table"},Qt={class:"signal-ticker"},qt={class:"signal-direction"},jt=["title"],Kt={class:"signal-value"},Gt={class:"signal-value"},Yt={class:"signal-value"},Jt={class:"signal-value"},Zt={class:"signal-value"},es={class:"signal-value"},ts={class:"signal-value"},ss={class:"signal-value"},is={class:"top-row"},os={class:"middle-row"},as={class:"left-column"},ns={class:"level2-container"},ls={class:"news-container"},rs={class:"tape-container"},cs={class:"bottom-row"};function ds(e,t,s,a,n,l){const r=(0,o.g2)("TickerInfo"),c=(0,o.g2)("QuoteDisplay"),d=(0,o.g2)("Level2"),u=(0,o.g2)("NewsPanel"),h=(0,o.g2)("Tape"),p=(0,o.g2)("OrderEntryPanel"),g=(0,o.g2)("IndicatorsPanel"),S=(0,o.g2)("PositionsPanel"),k=(0,o.g2)("OrdersPanel");return(0,o.uX)(),(0,o.CE)("div",Ut,[(0,o.bo)((0,o.Lk)("div",{class:"left-pane",style:(0,m.Tr)({width:n.leftWidth+"px",flex:"0 0 auto"})},null,4),[[i.aG,n.showLeftPane]]),(0,o.bo)((0,o.Lk)("div",{class:"divider",onMousedown:t[0]||(t[0]=(0,i.D$)(((...e)=>l.startDrag&&l.startDrag(...e)),["prevent"]))},null,544),[[i.aG,n.showLeftPane]]),(0,o.Lk)("div",Xt,[(0,o.Lk)("div",Ht,[(0,o.bF)(r,{info:n.tickerInfo},null,8,["info"]),n.persistentSignal&&n.signalHidden?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"show-signal-btn",onClick:t[1]||(t[1]=(...e)=>l.showSignal&&l.showSignal(...e)),title:"Show signal"}," Show Signal ")):(0,o.Q3)("",!0),n.persistentSignal&&!n.signalHidden?((0,o.uX)(),(0,o.CE)("div",{key:1,class:(0,m.C4)(["persistent-signal-top",l.getSignalBoxClass(n.persistentSignal.direction)])},[(0,o.Lk)("button",{class:"hide-btn",onClick:t[2]||(t[2]=(...e)=>l.hideSignal&&l.hideSignal(...e)),title:"Hide signal"},"−"),(0,o.Lk)("button",{class:"dismiss-btn",onClick:t[3]||(t[3]=(...e)=>l.dismissSignal&&l.dismissSignal(...e)),title:"Dismiss signal"},"×"),(0,o.Lk)("table",zt,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",Qt,(0,m.v_)(n.persistentSignal.ticker),1),(0,o.Lk)("td",qt,[(0,o.Lk)("button",{class:"direction-btn",style:(0,m.Tr)({color:l.getDirectionColor(n.persistentSignal.direction)}),onClick:t[4]||(t[4]=(...e)=>l.fillOrderEntry&&l.fillOrderEntry(...e)),title:"Click to fill order entry with "+n.persistentSignal.direction+" values"},(0,m.v_)(n.persistentSignal.direction),13,jt)]),t[5]||(t[5]=(0,o.Lk)("td",{colspan:"4"},null,-1)),(0,o.Lk)("td",{class:"signal-time-text",colspan:"2",style:(0,m.Tr)({backgroundColor:l.getTimeBackgroundColor(n.persistentSignal.receivedAt)})},(0,m.v_)(l.formatSignalTime(n.persistentSignal.receivedAt))+" ("+(0,m.v_)(l.getMinutesElapsed(n.persistentSignal.receivedAt))+"m ago)",5)]),(0,o.Lk)("tr",null,[t[6]||(t[6]=(0,o.Lk)("td",{class:"signal-label"},"Entry:",-1)),(0,o.Lk)("td",Kt,"$"+(0,m.v_)(l.formatPrice(n.persistentSignal.entry_price)),1),t[7]||(t[7]=(0,o.Lk)("td",{class:"signal-label"},"Stop:",-1)),(0,o.Lk)("td",Gt,"$"+(0,m.v_)(l.formatPrice(n.persistentSignal.stop_loss)),1),t[8]||(t[8]=(0,o.Lk)("td",{class:"signal-label"},"Risk:",-1)),(0,o.Lk)("td",Yt,"$"+(0,m.v_)(l.formatPrice(n.persistentSignal.risk_per_share)),1),t[9]||(t[9]=(0,o.Lk)("td",{class:"signal-label"},"Range:",-1)),(0,o.Lk)("td",Jt,"$"+(0,m.v_)(l.formatPrice(n.persistentSignal.opening_range_size)),1)]),(0,o.Lk)("tr",null,[t[10]||(t[10]=(0,o.Lk)("td",{class:"signal-label"},"T1:",-1)),(0,o.Lk)("td",Zt,"$"+(0,m.v_)(l.formatPrice(n.persistentSignal.targets?.target_75pct)),1),t[11]||(t[11]=(0,o.Lk)("td",{class:"signal-label"},"T2:",-1)),(0,o.Lk)("td",es,"$"+(0,m.v_)(l.formatPrice(n.persistentSignal.targets?.target_100pct)),1),t[12]||(t[12]=(0,o.Lk)("td",{class:"signal-label"},"Watch:",-1)),(0,o.Lk)("td",ts,(0,m.v_)(n.persistentSignal.minutes_since_watch)+"m",1),t[13]||(t[13]=(0,o.Lk)("td",{class:"signal-label"},"Vol:",-1)),(0,o.Lk)("td",ss,(0,m.v_)(l.formatVolume(n.persistentSignal.raw_details?.volume))+" "+(0,m.v_)(n.persistentSignal.range_coverage_percent),1)])])],2)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",is,[(0,o.bF)(c,{quote:n.latestQuote},null,8,["quote"])]),(0,o.Lk)("div",os,[(0,o.Lk)("div",as,[(0,o.Lk)("div",ns,[(0,o.bF)(d,{ref:"level2",symbol:n.symbol,latestQuote:n.latestQuote,onPriceSelected:l.handlePriceSelected},null,8,["symbol","latestQuote","onPriceSelected"])]),(0,o.Lk)("div",ls,[(0,o.bF)(u,{ticker:n.symbol},null,8,["ticker"])])]),(0,o.Lk)("div",rs,[(0,o.bF)(h,{trades:n.trades},null,8,["trades"])])]),(0,o.Lk)("div",cs,[(0,o.bF)(p,{ref:"orderEntryPanel",currentSymbol:n.symbol,selectedPrice:n.selectedPrice,selectedSide:n.selectedSide,"is-quote-live":n.isQuoteLive,currentQuote:n.latestQuote,level2Ref:e.$refs.level2,onViewModeChanged:l.handleViewModeChanged},null,8,["currentSymbol","selectedPrice","selectedSide","is-quote-live","currentQuote","level2Ref","onViewModeChanged"]),(0,o.bF)(g,{symbol:n.symbol,position:n.currentPosition},null,8,["symbol","position"]),(0,o.bF)(S,{currentSymbol:n.symbol},null,8,["currentSymbol"]),(0,o.bF)(k,{currentSymbol:n.symbol},null,8,["currentSymbol"])])])],512)}s(4603),s(7566),s(8721);const us={class:"ticker-info"},ms={class:"line1"},hs={class:"line2"},ps={class:"sub-line"},gs={class:"item"},Ss={class:"sub-line"},ks={class:"item"};function bs(e,t,s,i,a,n){return(0,o.uX)(),(0,o.CE)("div",us,[(0,o.Lk)("div",ms,(0,m.v_)(s.info.ticker||"-")+" – "+(0,m.v_)(s.info.name||"-"),1),(0,o.Lk)("div",hs,[(0,o.Lk)("div",ps,[(0,o.Lk)("span",gs,"Float: "+(0,m.v_)(n.formatHumanReadable(s.info.float)),1),t[0]||(t[0]=(0,o.Lk)("span",{class:"separator"},"|",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["item",n.shortInterestClass])}," Sh Int: "+(0,m.v_)(n.formatHumanReadable(s.info.shortInterest))+" ("+(0,m.v_)(n.safeShortInterestRatio)+") ",3)]),(0,o.Lk)("div",Ss,[(0,o.Lk)("span",{class:(0,m.C4)(["item",n.daysToCoverClass])}," Days to Cover: "+(0,m.v_)(n.safeDaysToCover),3),t[1]||(t[1]=(0,o.Lk)("span",{class:"separator"},"|",-1)),(0,o.Lk)("span",ks," Market Cap: "+(0,m.v_)(n.formatHumanReadable(s.info.market_cap)),1)])])])}var fs={name:"TickerInfo",props:{info:{type:Object,default:()=>({})}},computed:{shortInterestRatio(){const e=Number(this.info.float)||0,t=Number(this.info.shortInterest)||0;return e?t/e*100:0},safeShortInterestRatio(){const e=this.shortInterestRatio;return isNaN(e)?"0.00%":e.toFixed(2)+"%"},safeDaysToCover(){const e=Number(this.info.daysToCover)||0;return e.toFixed(1)},daysToCoverClass(){const e=Number(this.info.daysToCover)||0;return e<2?"green":e<3?"yellow":"red"},shortInterestClass(){const e=this.shortInterestRatio;return e<2?"green":e<5?"yellow":"red"}},methods:{formatHumanReadable(e){const t=Number(e);return!t||isNaN(t)?"-":t>=1e9?(t/1e9).toFixed(1)+"B":t>=1e6?Math.round(t/1e6).toLocaleString()+"M":t>=1e3?Math.round(t/1e3).toLocaleString()+"K":Math.round(t).toLocaleString()}}};const vs=(0,r.A)(fs,[["render",bs],["__scopeId","data-v-20434b74"]]);var ws=vs;const ys={key:0},Ls={class:"elapsed-timer"};function Cs(e,t,s,i,a,n){return(0,o.uX)(),(0,o.CE)("div",{class:"quote-display",style:(0,m.Tr)({backgroundColor:n.freshnessColor})},[t[2]||(t[2]=(0,o.Lk)("strong",null,"Bid/Ask:",-1)),(0,o.eW)(" "+(0,m.v_)(n.formatPrice(s.quote?.bidPrice))+" / "+(0,m.v_)(n.formatPrice(s.quote?.askPrice))+" ",1),(0,o.Lk)("span",{class:"spread",style:(0,m.Tr)({backgroundColor:n.spreadColor})}," ("+(0,m.v_)(n.spread)+") ",5),s.quote?.quoteET?((0,o.uX)(),(0,o.CE)("span",ys,[t[0]||(t[0]=(0,o.eW)(" | ")),t[1]||(t[1]=(0,o.Lk)("strong",null,"Time:",-1)),(0,o.eW)(" "+(0,m.v_)(s.quote.quoteET),1)])):(0,o.Q3)("",!0),(0,o.Lk)("span",Ls," | Elapsed: "+(0,m.v_)(n.elapsedTime)+"s ",1)],4)}var Ts={name:"QuoteDisplay",props:{quote:{type:Object,default:null}},data(){return{quoteReceivedTime:0,currentTime:Date.now(),timer:null}},computed:{spread(){const e=parseFloat(this.quote?.bidPrice),t=parseFloat(this.quote?.askPrice);return isNaN(e)||isNaN(t)?"-":Math.abs(t-e).toFixed(2)},spreadColor(){const e=parseFloat(this.spread);return isNaN(e)?"transparent":e<.1?"#d0f0d0":e<.2?"#ffff99":"#ffcccc"},elapsedTime(){if(this.quoteReceivedTime>0){let e=Math.max((this.currentTime-this.quoteReceivedTime)/1e3,0);return e=Math.floor(2*e)/2,e.toFixed(1)}return"0.0"},freshnessColor(){if(0===this.quoteReceivedTime)return"#eef";const e=(this.currentTime-this.quoteReceivedTime)/1e3;return e>10?"#ffcccc":e>5?"#ffff99":"#eef"}},watch:{quote:{immediate:!0,handler(e){if(e)if(e.receivedTimestamp)this.quoteReceivedTime=e.receivedTimestamp;else if(e.quoteET){const t=new Date(e.quoteET).getTime();this.quoteReceivedTime=isNaN(t)?Date.now():t}}}},mounted(){this.timer=setInterval((()=>{this.currentTime=Date.now()}),500)},beforeUnmount(){this.timer&&clearInterval(this.timer)},methods:{formatPrice(e){if(!e)return"-";const t=parseFloat(e);return isNaN(t)?"-":t.toFixed(2)}}};const As=(0,r.A)(Ts,[["render",Cs],["__scopeId","data-v-687aae56"]]);var Es=As;const Ms={class:"header"},_s={class:"elapsed"},$s={class:"tape-header"},Is={key:0,class:"header-time"},Fs={class:"tape-list",ref:"tapeList"},Ps={key:0,class:"trade-time"},Rs={class:"trade-price"},Ds={class:"trade-size"};function Ws(e,t,s,i,a,n){return(0,o.uX)(),(0,o.CE)("div",{class:"tape-container",style:(0,m.Tr)({backgroundColor:n.freshnessColor})},[(0,o.Lk)("h3",Ms,[t[0]||(t[0]=(0,o.eW)(" Time & Sales (Tape) ")),(0,o.Lk)("span",_s,"| "+(0,m.v_)(n.elapsedTime)+"s old",1)]),(0,o.Lk)("div",$s,[a.SHOW_TIME_COLUMN?((0,o.uX)(),(0,o.CE)("span",Is,"Time")):(0,o.Q3)("",!0),t[1]||(t[1]=(0,o.Lk)("span",{class:"header-price"},"Price",-1)),t[2]||(t[2]=(0,o.Lk)("span",{class:"header-size"},"Size",-1))]),(0,o.Lk)("div",Fs,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.trades,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:(e.tradeET||e.timestamp)+"-"+e.price+"-"+e.tradeSize+"-"+t,class:"trade-row",style:(0,m.Tr)(n.getTradeStyle(e))},[a.SHOW_TIME_COLUMN?((0,o.uX)(),(0,o.CE)("span",Ps,(0,m.v_)(n.formatTime(e.tradeET)),1)):(0,o.Q3)("",!0),(0,o.Lk)("span",Rs,(0,m.v_)(n.formatPrice(e.price)),1),(0,o.Lk)("span",Ds,(0,m.v_)(n.formatTradeSize(e.tradeSize)),1)],4)))),128))],512)],4)}const xs=!1;var Ns={name:"TimeSalesTape",props:{trades:{type:Array,required:!0}},data(){return{SHOW_TIME_COLUMN:xs,tradeReceivedTime:0,currentTime:Date.now(),timer:null}},computed:{elapsedTime(){if(this.tradeReceivedTime>0){let e=Math.max((this.currentTime-this.tradeReceivedTime)/1e3,0);return e=Math.floor(2*e)/2,e.toFixed(1)}return"0.0"},freshnessColor(){if(0===this.tradeReceivedTime)return"#f9f9f9";const e=(this.currentTime-this.tradeReceivedTime)/1e3;return e>10?"#ffcccc":e>5?"#ffff99":"#f9f9f9"}},watch:{trades:{handler(e){e&&e.length>0&&(this.tradeReceivedTime=Date.now(),this.$nextTick((()=>{const e=this.$refs.tapeList;e&&(e.scrollTop=e.scrollHeight)})))},deep:!0}},mounted(){this.timer=setInterval((()=>{this.currentTime=Date.now()}),500)},beforeUnmount(){this.timer&&clearInterval(this.timer)},methods:{formatTime(e){return e},formatPrice(e){return parseFloat(e).toFixed(2)},formatTradeSize(e){const t=Math.max(parseInt(e,10),1);return t.toFixed(0)},getTradeStyle(e){let t="#000";1===e.tradeSign||"Buyer"===e.aggressor?t="#00aa00":-1!==e.tradeSign&&"Seller"!==e.aggressor||(t="#cc0000");const s=parseInt(e.tradeSize,10)>=1e3?"bold":"normal";return{color:t,fontWeight:s,padding:"0.2rem",marginBottom:"0.1rem"}}}};const Os=(0,r.A)(Ns,[["render",Ws],["__scopeId","data-v-13d7c348"]]);var Bs=Os;const Vs={class:"header-row"},Us={class:"heartbeat"},Xs={class:"watchlist-inline-controls"},Hs={key:2,class:"warning"},zs={class:"order-book"},Qs={class:"bids"},qs={class:"order-maker"},js={class:"order-size"},Ks=["onClick"],Gs={class:"asks"},Ys=["onClick"],Js={class:"order-size"},Zs={class:"order-maker",style:{"text-align":"right"}};function ei(e,t,s,i,a,n){return(0,o.uX)(),(0,o.CE)("div",{class:(0,m.C4)(["level2-container",{dimmed:!a.isInWatchlist}]),style:(0,m.Tr)({backgroundColor:n.freshnessColor})},[(0,o.Lk)("div",null,[(0,o.Lk)("h4",Vs,[(0,o.eW)(" Level 2: "+(0,m.v_)(s.symbol)+" ",1),(0,o.Lk)("span",Us," Time: "+(0,m.v_)(n.lastHeartbeatFormatted)+" ("+(0,m.v_)(n.heartbeatElapsed)+"s old) ",1),(0,o.Lk)("span",Xs,[a.isInWatchlist?((0,o.uX)(),(0,o.CE)("button",{key:1,onClick:t[1]||(t[1]=(...e)=>n.removeFromWatchlist&&n.removeFromWatchlist(...e))}," Remove from Level 2 watchlist ")):((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>n.addToWatchlist&&n.addToWatchlist(...e))}," Add to Level 2 watchlist ")),a.watchlistCount>10?((0,o.uX)(),(0,o.CE)("span",Hs," Too many symbols for Level 2 data ("+(0,m.v_)(a.watchlistCount)+" vs. 10 allowed) ",1)):(0,o.Q3)("",!0)])])]),(0,o.Lk)("div",zs,[(0,o.Lk)("div",Qs,[t[2]||(t[2]=(0,o.Lk)("div",{class:"order-row",style:{"font-weight":"bold"}},[(0,o.Lk)("span",{class:"order-maker"},"Bid"),(0,o.Lk)("span",{class:"order-size"}),(0,o.Lk)("span",{class:"order-price"})],-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.groupedBids,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:"bid-"+t,class:"order-row",style:(0,m.Tr)(n.getRowStyle(e.groupIndex,e.Size))},[(0,o.Lk)("span",qs,(0,m.v_)(e.Name),1),(0,o.Lk)("span",js,(0,m.v_)(n.formatSize(e.Size)),1),(0,o.Lk)("span",{class:"order-price",onClick:t=>n.selectPrice(e.Price,t)},(0,m.v_)(n.formatPrice(e.Price)),9,Ks)],4)))),128))]),(0,o.Lk)("div",Gs,[t[3]||(t[3]=(0,o.Lk)("div",{class:"order-row",style:{"font-weight":"bold"}},[(0,o.Lk)("span",{class:"order-maker"},"Ask"),(0,o.Lk)("span",{class:"order-size"}),(0,o.Lk)("span",{class:"order-price"})],-1)),t[4]||(t[4]=(0,o.eW)()),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.groupedAsks,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:"ask-"+t,class:"order-row",style:(0,m.Tr)(n.getRowStyle(e.groupIndex,e.Size))},[(0,o.Lk)("span",{class:"order-price",onClick:t=>n.selectPrice(e.Price,t),style:{"text-align":"left"}},(0,m.v_)(n.formatPrice(e.Price)),9,Ys),(0,o.Lk)("span",Js,(0,m.v_)(n.formatSize(e.Size)),1),(0,o.Lk)("span",Zs,(0,m.v_)(e.Name),1)],4)))),128))])])],6)}var ti={name:"OrderBookLevel2",props:{symbol:{type:String,default:"TSLA"},latestQuote:{type:Object,default:null}},data(){return{ws:null,depthData:null,lastHeartbeat:0,currentTime:Date.now(),timer:null,reconnectThreshold:1e8,levelColors:["#d0f0d0","#ff9999","#ffff99","#72bcd4"],isInWatchlist:!1,watchlistCount:0,isMounted:!1,autoSubscribeEnabled:!0}},computed:{groupedBids(){if(this.depthData&&this.depthData.Bids){const e=parseFloat(this.latestQuote?.bidPrice),t=[...this.depthData.Bids].sort(((e,t)=>parseFloat(t.Price)-parseFloat(e.Price))),s=e?t.filter((t=>parseFloat(t.Price)<=1.01*e)):t;let i=[],o=null,a=-1;return s.forEach((e=>{const t=parseFloat(e.Price).toFixed(2);t!==o&&(a++,o=t),i.push({...e,groupIndex:a})})),i}return[]},groupedAsks(){if(this.depthData&&this.depthData.Asks){const e=this.latestQuote?.askPrice,t=[...this.depthData.Asks].sort(((e,t)=>parseFloat(e.Price)-parseFloat(t.Price))),s=e?t.filter((t=>parseFloat(t.Price)>=.99*e)):t;let i=[],o=null,a=-1;return s.forEach((e=>{const t=parseFloat(e.Price).toFixed(2);t!==o&&(a++,o=t),i.push({...e,groupIndex:a})})),i}return[]},heartbeatElapsed(){if(this.lastHeartbeat>0){let e=Math.max(0,(this.currentTime-this.lastHeartbeat)/1e3);return e=Math.floor(2*e)/2,e.toFixed(1)}return"0.0"},lastHeartbeatFormatted(){return this.lastHeartbeat>0?new Date(this.lastHeartbeat).toLocaleTimeString():"No heartbeat yet"},freshnessColor(){if(0===this.lastHeartbeat)return"#f0f0f0";const e=(this.currentTime-this.lastHeartbeat)/1e3;return e>10?"#ffcccc":e>5?"#ffff99":"#f0f0f0"}},mounted(){this.isMounted=!0,this.initWebSocket(),this.timer=setInterval((()=>{this.currentTime=Date.now()}),500),this.checkWatchlist().then((()=>{this.isInWatchlist||this.addToWatchlist()})),window.addEventListener("beforeunload",this._cleanup),window.addEventListener("pagehide",this._cleanup)},beforeUnmount(){this.isMounted=!1,this.ws&&this.ws.close(),this.timeInterval&&clearInterval(this.timeInterval),this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),window.removeEventListener("beforeunload",this._cleanup),window.removeEventListener("pagehide",this._cleanup)},methods:{initWebSocket(){const e=`ws://${window.location.hostname}:8000/ws/market_depth?symbol=${this.symbol}`;this.ws=new WebSocket(e),this.ws.onopen=()=>{console.log("WebSocket connected for market_depth:",this.symbol),this.lastHeartbeat=Date.now(),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)},this.ws.onmessage=e=>{try{this.lastHeartbeat=Date.now();const t=JSON.parse(e.data);void 0===t.Heartbeat&&(this.depthData=t)}catch(t){console.error("Error processing market depth message",e.data,t)}},this.ws.onerror=e=>{console.error("Market depth WebSocket error:",e)},this.ws.onclose=e=>{console.log("WebSocket closed: market_depth: ",e.code,e.reason),this.isMounted&&(this.timer=setTimeout((()=>{this.reconnectWebSocket()}),5e3))}},reconnectWebSocket(){this.ws&&(console.log(`reconnectWebSocket(${this.symbol}): Closing websocket.`),this.ws.close()),this.initWebSocket()},getRowStyle(e,t){let s={};return e<this.levelColors.length?s.backgroundColor=this.levelColors[e]:s.backgroundColor="#ffffff",parseInt(t,10)>=1e3&&(s.fontWeight="bold"),0===e&&(s.backgroundColor="#00ff00"),s},formatPrice(e){return parseFloat(e).toFixed(2)},formatSize(e){const t=Math.max(parseInt(e,10)/100,1);return t.toFixed(2)},async checkWatchlist(){try{const e=await fetch(`http://${window.location.hostname}:8000/api/marketdepth_watchlist/${this.symbol}`);if(e.ok){const t=await e.json();this.isInWatchlist=t.inWatchlist,this.watchlistCount=t.count}}catch(e){console.error("Error checking market depth watchlist:",e)}},async addToWatchlist(){try{const e=await fetch(`http://${window.location.hostname}:8000/api/marketdepth_watchlist/${this.symbol}`,{method:"POST"});if(e.ok){const t=await e.json();this.isInWatchlist=t.inWatchlist,this.watchlistCount=t.count}}catch(e){console.error("Error adding to market depth watchlist:",e)}},_cleanup(){this.isInWatchlist&&fetch(`http://${window.location.hostname}:8000/api/marketdepth_watchlist/${this.symbol}`,{method:"DELETE",keepalive:!0}).catch((()=>{}))},async removeFromWatchlist(){try{const e=await fetch(`http://${window.location.hostname}:8000/api/marketdepth_watchlist/${this.symbol}`,{method:"DELETE"});if(e.ok){const t=await e.json();this.isInWatchlist=t.inWatchlist,this.watchlistCount=t.count}}catch(e){console.error("Error removing from market depth watchlist:",e)}},selectPrice(e,t){const s=t.altKey?"SellShort":"Buy";this.$emit("priceSelected",{price:Number(e),side:s})}}};const si=(0,r.A)(ti,[["render",ei],["__scopeId","data-v-00f4a3e3"]]);var ii=si;const oi={class:"news-panel"},ai={class:"news-list"},ni=["href"];function li(e,t,s,i,a,n){return(0,o.uX)(),(0,o.CE)("div",oi,[(0,o.Lk)("div",ai,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.sortedNews,((e,t)=>((0,o.uX)(),(0,o.CE)("span",{key:t,class:"news-item"},[(0,o.Lk)("span",{class:(0,m.C4)({"news-date":!0,recent:n.isRecent(e)})},(0,m.v_)(n.formatPublishedTime(e.published_utc)),3),(0,o.Lk)("a",{href:e.article_url,target:"_blank",rel:"noopener",class:"news-link"},(0,m.v_)(n.clipTitle(e.title)),9,ni)])))),128))])])}const ri=80;var ci={name:"NewsPanel",props:{ticker:{type:String,default:"PLTR"}},data(){return{newsItems:[]}},computed:{sortedNews(){return[...this.newsItems].sort(((e,t)=>new Date(t.published_utc)-new Date(e.published_utc)))}},mounted(){this.fetchNews()},methods:{async fetchNews(){const e="p78rx6L5WW0JQ37zj4Y8J2BypjbLdd0r",t=`https://api.polygon.io/v2/reference/news?ticker=${this.ticker}&order=desc&limit=9&sort=published_utc&apiKey=${e}`;try{const e=await fetch(t);if(!e.ok)throw new Error("News fetch failed");const s=await e.json();s.results&&(this.newsItems=s.results)}catch(s){console.error("Error fetching news:",s)}},clipTitle(e){return e?e.length<=ri?e:e.substring(0,ri)+"...":""},formatPublishedTime(e){if(!e)return"";const t={timeZone:"America/New_York",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat("en-US",t).format(new Date(e))},isRecent(e){if(!e||!e.published_utc)return!1;const t=new Date(e.published_utc).getTime(),s=6048e5;return Date.now()-t<s}}};const di=(0,r.A)(ci,[["render",li],["__scopeId","data-v-42680c04"]]);var ui=di;const mi={class:"positions-panel"},hi={key:0,class:"action-grid"},pi={class:"action-column"},gi=["onClick","disabled"],Si=["onClick","disabled"],ki=["onClick","disabled"],bi=["onClick","disabled"],fi=["onClick","disabled"],vi=["onClick","disabled"],wi=["onClick","disabled"],yi={class:"action-column"},Li=["onClick","disabled"],Ci=["onClick","disabled"],Ti=["onClick","disabled"],Ai=["onClick","disabled"],Ei=["onClick","disabled"],Mi=["onUpdate:modelValue","placeholder"],_i=["onUpdate:modelValue","placeholder"],$i={class:"action-column"},Ii=["onClick","disabled"],Fi=["onClick","disabled"],Pi=["onClick","disabled"],Ri=["onClick","disabled"],Di=["onClick","disabled"],Wi=["onClick","disabled"],xi=["onClick","disabled"];function Ni(e,t,s,a,n,l){return(0,o.uX)(),(0,o.CE)("div",mi,[t[1]||(t[1]=(0,o.Lk)("h3",null,"Positions",-1)),(0,o.Lk)("table",null,[t[0]||(t[0]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Symbol"),(0,o.Lk)("th",null,"Qty"),(0,o.Lk)("th",null,"Avg Cost Basis"),(0,o.Lk)("th",null,"Market Value"),(0,o.Lk)("th",null,"P/L"),(0,o.Lk)("th",null,"Actions")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.sortedPositions,((e,t)=>((0,o.uX)(),(0,o.CE)("tr",{key:t,class:(0,m.C4)({"closed-position":0===Number(e.Quantity)})},[(0,o.Lk)("td",null,[(0,o.Lk)("span",{class:(0,m.C4)({"current-symbol":e.Symbol===s.currentSymbol})},(0,m.v_)(e.Symbol),3)]),(0,o.Lk)("td",null,(0,m.v_)(e.Quantity),1),(0,o.Lk)("td",null,(0,m.v_)(l.formatPrice(e.AveragePrice)),1),(0,o.Lk)("td",null,(0,m.v_)(l.formatPrice(e.MarketValue)),1),(0,o.Lk)("td",{class:(0,m.C4)({"current-symbol":e.Symbol===s.currentSymbol})},[(0,o.Lk)("span",{class:(0,m.C4)(Number(e.UnrealizedProfitLoss)>=0?"pnl-green":"pnl-red")},(0,m.v_)(l.formatPrice(e.UnrealizedProfitLoss)),3)],2),(0,o.Lk)("td",null,[e.Symbol===s.currentSymbol?((0,o.uX)(),(0,o.CE)("div",hi,[(0,o.Lk)("div",pi,[(0,o.Lk)("button",{class:"button btn-exit",onClick:t=>l.closePosition(e.Symbol,.1),disabled:0===Number(e.Quantity)}," Exit 10% ",8,gi),(0,o.Lk)("button",{class:"button btn-exit",onClick:t=>l.closePosition(e.Symbol,.15),disabled:0===Number(e.Quantity)}," Exit 15% ",8,Si),(0,o.Lk)("button",{class:"button btn-exit",onClick:t=>l.closePosition(e.Symbol,.2),disabled:0===Number(e.Quantity)}," Exit 20% ",8,ki),(0,o.Lk)("button",{class:"button btn-exit",onClick:t=>l.closePosition(e.Symbol,.25),disabled:0===Number(e.Quantity)}," Exit 25% ",8,bi),(0,o.Lk)("button",{class:"button btn-exit",onClick:t=>l.closePosition(e.Symbol,.33),disabled:0===Number(e.Quantity)}," Exit 33% ",8,fi),(0,o.Lk)("button",{class:"button btn-exit",onClick:t=>l.closePosition(e.Symbol,.5),disabled:0===Number(e.Quantity)}," Exit 50% ",8,vi),(0,o.Lk)("button",{class:"button btn-flatten",onClick:t=>l.closePosition(e.Symbol,1),disabled:0===Number(e.Quantity)}," Flatten ",8,wi)]),(0,o.Lk)("div",yi,[(0,o.Lk)("button",{class:"button btn-breakeven",onClick:t=>l.setEmaTrail(e.Symbol,"breakeven"),disabled:0===Number(e.Quantity)}," Breakeven ",8,Li),(0,o.Lk)("button",{class:"button btn-save-25",onClick:t=>l.saveProfit(e.Symbol,.25),disabled:0===Number(e.Quantity)||Number(e.UnrealizedProfitLoss)<=0}," Save 25% ",8,Ci),(0,o.Lk)("button",{class:"button btn-save-50",onClick:t=>l.saveProfit(e.Symbol,.5),disabled:0===Number(e.Quantity)||Number(e.UnrealizedProfitLoss)<=0}," Save 50% ",8,Ti),(0,o.Lk)("button",{class:"button btn-save-75",onClick:t=>l.saveProfit(e.Symbol,.75),disabled:0===Number(e.Quantity)||Number(e.UnrealizedProfitLoss)<=0}," Save 75% ",8,Ai),(0,o.Lk)("button",{class:"button btn-save-90",onClick:t=>l.saveProfit(e.Symbol,.9),disabled:0===Number(e.Quantity)||Number(e.UnrealizedProfitLoss)<=0}," Save 90% ",8,Ei),(0,o.bo)((0,o.Lk)("input",{type:"number","onUpdate:modelValue":t=>n.manualStopLoss[e.Symbol]=t,placeholder:`SL for ${e.Symbol}`,class:"manual-input-field"},null,8,Mi),[[i.Jo,n.manualStopLoss[e.Symbol],void 0,{number:!0}]]),(0,o.bo)((0,o.Lk)("input",{type:"number","onUpdate:modelValue":t=>n.trailingStopLoss[e.Symbol]=t,placeholder:`Trail $ for ${e.Symbol}`,class:"manual-input-field"},null,8,_i),[[i.Jo,n.trailingStopLoss[e.Symbol],void 0,{number:!0}]])]),(0,o.Lk)("div",$i,[(0,o.Lk)("button",{class:"button btn-stop-ema-6",onClick:t=>l.setEmaTrail(e.Symbol,"ema6"),disabled:0===Number(e.Quantity)}," SL: 6ema ",8,Ii),(0,o.Lk)("button",{class:"button btn-stop-ema-9",onClick:t=>l.setEmaTrail(e.Symbol,"ema9"),disabled:0===Number(e.Quantity)}," SL: 9ema ",8,Fi),(0,o.Lk)("button",{class:"button btn-stop-ema-21",onClick:t=>l.setEmaTrail(e.Symbol,"ema21"),disabled:0===Number(e.Quantity)}," SL: 21ema ",8,Pi),(0,o.Lk)("button",{class:"button btn-split",onClick:t=>l.splitStopLoss(e.Symbol,2),disabled:0===Number(e.Quantity)}," Split SL ×2 ",8,Ri),(0,o.Lk)("button",{class:"button btn-split",onClick:t=>l.splitStopLoss(e.Symbol,3),disabled:0===Number(e.Quantity)}," Split SL ×3 ",8,Di),(0,o.Lk)("button",{class:"button manual-input-btn",onClick:t=>l.submitManualStopLoss(e.Symbol),disabled:0===Number(e.Quantity)||!n.manualStopLoss[e.Symbol]}," Set-SL ",8,Wi),(0,o.Lk)("button",{class:"button manual-input-btn",onClick:t=>l.submitTrailingStopLoss(e.Symbol),disabled:0===Number(e.Quantity)||!n.trailingStopLoss[e.Symbol]}," Trl-SL ",8,xi)])])):(0,o.Q3)("",!0)])],2)))),128))])])])}s(2577);var Oi={name:"PositionsPanel",props:{currentSymbol:{type:String,default:""}},data(){return{positions:[],isMounted:!0,timer:null,positionsWs:null,manualStopLoss:{},trailingStopLoss:{}}},computed:{sortedPositions(){return this.positions.slice().sort(((e,t)=>{if(e.Symbol===this.currentSymbol&&t.Symbol!==this.currentSymbol)return-1;if(e.Symbol!==this.currentSymbol&&t.Symbol===this.currentSymbol)return 1;const s=0===Number(e.Quantity),i=0===Number(t.Quantity);return s&&!i?1:!s&&i?-1:0}))},filteredPositions(){return this.currentSymbol?this.sortedPositions.filter((e=>e.Symbol===this.currentSymbol)):this.sortedPositions}},mounted(){this.isMounted=!0,this.connectWebSocket(),this.handleBeforeUnload=()=>{this.positionsWs&&this.positionsWs.readyState===WebSocket.OPEN&&this.positionsWs.close()},window.addEventListener("beforeunload",this.handleBeforeUnload)},beforeUnmount(){this.isMounted=!1,this.positionsWs&&this.positionsWs.close(),this.timer&&clearTimeout(this.timer),this.handleBeforeUnload&&window.removeEventListener("beforeunload",this.handleBeforeUnload)},methods:{connectWebSocket(){const e=`ws://${window.location.hostname}:8000/ws/positions`;this.positionsWs=new WebSocket(e),this.positionsWs.onopen=()=>{console.log("Positions websocket connected"),this.timer&&(clearTimeout(this.timer),this.timer=null)},this.positionsWs.onmessage=e=>{try{const t=JSON.parse(e.data);t.positions&&(this.positions=t.positions)}catch(t){console.error("Error processing positions message",e.data,t)}},this.positionsWs.onerror=e=>{console.error("Positions websocket error:",e)},this.positionsWs.onclose=()=>{console.log("Positions websocket closed"),this.isMounted&&(this.timer=setTimeout((()=>{console.log("Reconnecting positions websocket..."),this.connectWebSocket()}),5e3))}},formatPrice(e){return null!=e?Number(e).toFixed(2):"-"},closePosition(e,t){const s=this.positions.find((t=>t.Symbol===e));if(!s)return void console.warn(`No position found for ${e}`);const i=Number(s.Quantity),o=Math.abs(i),a=Math.floor(o*t);a<1?console.warn(`Nothing to flatten for ${e}`):(console.log(`Closing ${a} of ${i} (${100*t}%) shares of ${e}`),fetch(`http://${window.location.hostname}:8000/api/flattenPosition`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e,flatten_type:"panic",quantity:a})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("Flatten response:",e)})).catch((e=>{console.error("Error flattening position:",e)})))},splitStopLoss(e,t){console.log(`Splitting SL for ${e} into ${t} parts`),fetch(`http://${window.location.hostname}:8000/api/splitStopLoss`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e,tranches:t})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("Split SL response:",e)})).catch((e=>{console.error("Error splitting SL:",e)}))},setEmaTrail(e,t){console.log(`Setting EMA-based trailing stop for ${e}`),fetch(`http://${window.location.hostname}:8000/api/setStopLoss`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e,indicator:t})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("StopLoss set:",e)})).catch((e=>{console.error("Error setting EMA-based stoploss:",e)}))},submitManualStopLoss(e){const t=this.manualStopLoss[e];t&&!isNaN(t)?(console.log(`Setting manual stop loss for ${e} at ${t}`),fetch(`http://${window.location.hostname}:8000/api/setStopLoss`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e,stop_price:t,indicator:"manual"})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("Manual StopLoss set:",e)})).catch((e=>{console.error("Error setting manual stoploss:",e)}))):console.warn("Invalid stop loss price")},submitTrailingStopLoss(e){const t=this.trailingStopLoss[e];t&&!isNaN(t)?(console.log(`Setting trailing stop for ${e} with amount ${t}`),fetch(`http://${window.location.hostname}:8000/api/setStopLoss`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e,trail_amount:t,indicator:"trailing"})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("Trailing StopLoss set:",e)})).catch((e=>{console.error("Error setting trailing stoploss:",e)}))):console.warn("Invalid trailing stop value")},async saveProfit(e,t){const s=this.positions.find((t=>t.Symbol===e));if(!s)return console.warn(`No position for ${e}`);const i=Math.abs(Number(s.Quantity));if(0===i)return;const o=Number(s.AveragePrice),a=Number(s.MarketValue)/i,n=o+(a-o)*t;console.log(`Setting save-${100*t}% stop for ${e} at $${n.toFixed(2)}`);try{const t=await fetch(`http://${window.location.hostname}:8000/api/setStopLoss`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e,stop_price:Number(n.toFixed(2)),indicator:"manual"})});if(!t.ok)throw new Error(t.statusText);const s=await t.json();console.log("StopLoss set:",s)}catch(l){console.error("Error setting save-profit stop:",l)}}}};const Bi=(0,r.A)(Oi,[["render",Ni],["__scopeId","data-v-5b35239c"]]);var Vi=Bi;const Ui={class:"orders-panel"},Xi={class:"order-filters"},Hi={class:"price-column"},zi={class:"actions-cell"},Qi=["onClick"],qi={key:1,class:"orders-action-layout"},ji={class:"button-table"},Ki=["onClick"],Gi=["onClick"],Yi=["onClick"],Ji=["onClick"],Zi=["onClick"],eo=["onClick"],to={class:"input-row"},so=["onUpdate:modelValue","placeholder"],io=["onClick","disabled"],oo={class:"input-row"},ao=["onUpdate:modelValue","placeholder"],no=["onClick","disabled"],lo={style:{"padding-left":"2rem"}};function ro(e,t,s,a,n,l){return(0,o.uX)(),(0,o.CE)("div",Ui,[(0,o.Lk)("h3",null,[t[10]||(t[10]=(0,o.eW)(" Orders ")),(0,o.Lk)("span",Xi,[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedStatuses.All=e)},null,512),[[i.lH,n.selectedStatuses.All]]),t[5]||(t[5]=(0,o.eW)(" All "))]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedStatuses.Open=e)},null,512),[[i.lH,n.selectedStatuses.Open]]),t[6]||(t[6]=(0,o.eW)(" Open "))]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedStatuses.Closed=e)},null,512),[[i.lH,n.selectedStatuses.Closed]]),t[7]||(t[7]=(0,o.eW)(" Closed "))]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>n.selectedStatuses.Canceled=e)},null,512),[[i.lH,n.selectedStatuses.Canceled]]),t[8]||(t[8]=(0,o.eW)(" Canceled "))]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>n.selectedStatuses.Rejected=e)},null,512),[[i.lH,n.selectedStatuses.Rejected]]),t[9]||(t[9]=(0,o.eW)(" Rejected "))])])]),(0,o.Lk)("table",null,[t[16]||(t[16]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Symbol"),(0,o.Lk)("th",null,"Order ID"),(0,o.Lk)("th",null,"Side"),(0,o.Lk)("th",null,"Qty"),(0,o.Lk)("th",null,"Price"),(0,o.Lk)("th",null,"Status"),(0,o.Lk)("th",null,"Actions")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.filteredOrders,((e,a)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:e.order_id||a},[(0,o.Lk)("tr",null,[(0,o.Lk)("td",{class:(0,m.C4)({"current-symbol":e.symbol===s.currentSymbol})},(0,m.v_)(e.symbol),3),(0,o.Lk)("td",null,(0,m.v_)(e.order_id),1),(0,o.Lk)("td",null,(0,m.v_)(e.action),1),(0,o.Lk)("td",null,(0,m.v_)(e.quantity_ordered),1),(0,o.Lk)("td",Hi,[(0,o.Lk)("div",null,[(0,o.Lk)("strong",null,(0,m.v_)(e.display_price),1)]),t[11]||(t[11]=(0,o.Lk)("br",null,null,-1)),"Sell"===e.action||"BuyToCover"===e.action?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,m.C4)(["order-pl",{positive:e.pl>0,negative:e.pl<0,breakeven:0===e.pl}])},[(0,o.Lk)("div",null,(0,m.v_)(e.pl>0?"Min Profit":e.pl<0?"MaxL":"Breakeven"),1),(0,o.Lk)("div",{class:(0,m.C4)({"current-symbol":e.symbol===s.currentSymbol})},(0,m.v_)((e.pl>0?"+":e.pl<0?"-":"")+"$"+Math.abs(e.pl).toFixed(2)),3)],2)):(0,o.Q3)("",!0)]),(0,o.Lk)("td",null,(0,m.v_)(e.status),1),(0,o.Lk)("td",zi,[!l.isOpenOrder(e)||e.symbol===s.currentSymbol&&e.details&&(null!=e.details.TrailingStop||(e.details.MarketActivationRules?.length||0)>0)?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("button",{key:0,class:"button btn-cancel",onClick:t=>l.cancelOrder(e)}," Cancel ",8,Qi)),e.symbol===s.currentSymbol&&e.details&&(null!=e.details.TrailingStop||(e.details.MarketActivationRules?.length||0)>0)?((0,o.uX)(),(0,o.CE)("div",qi,[(0,o.Lk)("table",ji,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",null,[(0,o.Lk)("button",{class:"button btn-cancel",onClick:t=>l.cancelOrder(e)},"Cancel",8,Ki)]),(0,o.Lk)("td",null,[(0,o.Lk)("button",{class:"button btn-breakeven",onClick:t=>l.setEmaTrail(e,"breakeven")},"Breakeven",8,Gi)]),(0,o.Lk)("td",null,[(0,o.Lk)("button",{class:"button btn-flatten",onClick:t=>l.closeOrder(e,1)},"Flatten",8,Yi)])]),(0,o.Lk)("tr",null,[(0,o.Lk)("td",null,[(0,o.Lk)("button",{class:"button btn-stop-ema-6",onClick:t=>l.setEmaTrail(e,"ema6")},"SL: 6ema",8,Ji)]),(0,o.Lk)("td",null,[(0,o.Lk)("button",{class:"button btn-stop-ema-9",onClick:t=>l.setEmaTrail(e,"ema9")},"SL: 9ema",8,Zi)]),(0,o.Lk)("td",null,[(0,o.Lk)("button",{class:"button btn-stop-ema-21",onClick:t=>l.setEmaTrail(e,"ema21")},"SL: 21ema",8,eo)])])]),(0,o.Lk)("div",to,[(0,o.bo)((0,o.Lk)("input",{type:"number","onUpdate:modelValue":t=>n.manualStopLoss[e.order_id]=t,placeholder:`SL for ${e.symbol}`,class:"manual-input-field"},null,8,so),[[i.Jo,n.manualStopLoss[e.order_id],void 0,{number:!0}]]),(0,o.Lk)("button",{class:"button manual-input-btn",onClick:t=>l.submitManualStopLoss(e),disabled:0===Number(e.quantity_ordered)||!n.manualStopLoss[e.order_id]},"Set-SL",8,io)]),(0,o.Lk)("div",oo,[(0,o.bo)((0,o.Lk)("input",{type:"number","onUpdate:modelValue":t=>n.trailingStopLoss[e.order_id]=t,placeholder:`Trail $ for ${e.symbol}`,class:"manual-input-field"},null,8,ao),[[i.Jo,n.trailingStopLoss[e.order_id],void 0,{number:!0}]]),(0,o.Lk)("button",{class:"button manual-input-btn",onClick:t=>l.submitTrailingStopLoss(e),disabled:0===Number(e.quantity_ordered)||!n.trailingStopLoss[e.order_id]},"Trl-SL",8,no)])])):(0,o.Q3)("",!0)])]),"Bracket"===e.action?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:0},(0,o.pI)(e.legs,((s,i)=>((0,o.uX)(),(0,o.CE)("tr",{key:e.order_id+"-"+i},[(0,o.Lk)("td",lo,(0,m.v_)(s.Symbol),1),t[12]||(t[12]=(0,o.Lk)("td",null,null,-1)),(0,o.Lk)("td",null,(0,m.v_)(s.BuyOrSell),1),(0,o.Lk)("td",null,(0,m.v_)(s.QuantityOrdered),1),t[13]||(t[13]=(0,o.Lk)("td",null,null,-1)),(0,o.Lk)("td",null,(0,m.v_)(l.formatPrice(s.LimitPrice)),1),t[14]||(t[14]=(0,o.Lk)("td",null,null,-1)),t[15]||(t[15]=(0,o.Lk)("td",null,null,-1))])))),128)):(0,o.Q3)("",!0)],64)))),128))])])])}const co=new Set(["ACK","ASS","BRC","BRF","BRO","CHG","CND","COR","CSN","DIS","DOA","DON","ECN","EXE","FPR","LAT","OPN","OSO","OTHER","PLA","REC","RJC","RPD","RSN","STP","STT","SUS","UCN"]),uo=new Set(["CAN","EXP","OUT","RJR","SCN","TSC","UCH"]),mo=new Set(["REJ"]),ho=new Set(["FLL","FLP"]);var po={name:"OrdersPanel",props:{currentSymbol:{type:String,default:""}},data(){return{orders:[],ordersWs:null,isMounted:!0,timer:null,selectedStatuses:{All:!1,Open:!0,Closed:!1,Canceled:!1,Rejected:!1},manualStopLoss:{},trailingStopLoss:{}}},computed:{filteredOrders(){const e=this.selectedStatuses.All?this.orders.slice():this.orders.filter((e=>{const t=(e.status||"").toUpperCase(),s=new Set;return this.selectedStatuses.Open&&co.forEach((e=>s.add(e))),this.selectedStatuses.Closed&&ho.forEach((e=>s.add(e))),this.selectedStatuses.Canceled&&uo.forEach((e=>s.add(e))),this.selectedStatuses.Rejected&&mo.forEach((e=>s.add(e))),s.has(t)||""!==t?s.has(t):this.selectedStatuses.Open}));return e.sort(((e,t)=>e.symbol===this.currentSymbol&&t.symbol!==this.currentSymbol?-1:e.symbol!==this.currentSymbol&&t.symbol===this.currentSymbol?1:0))}},mounted(){this.connectWebSocket(),this.handleBeforeUnload=()=>{this.ordersWs&&this.ordersWs.readyState===WebSocket.OPEN&&this.ordersWs.close()},window.addEventListener("beforeunload",this.handleBeforeUnload)},beforeUnmount(){this.isMounted=!1,this.ordersWs&&this.ordersWs.close(),this.timer&&clearTimeout(this.timer),this.handleBeforeUnload&&window.removeEventListener("beforeunload",this.handleBeforeUnload)},methods:{connectWebSocket(){const e=`ws://${window.location.hostname}:8000/ws/orders_stream`;this.ordersWs=new WebSocket(e),this.ordersWs.onopen=()=>{this.timer&&clearTimeout(this.timer)},this.ordersWs.onmessage=({data:e})=>{try{const t=JSON.parse(e);t.orders&&(this.orders=t.orders)}catch(t){console.error("Orders parse error",t)}},this.ordersWs.onclose=()=>{this.isMounted&&(this.timer=setTimeout(this.connectWebSocket,5e3))}},formatPrice(e){return null!=e?Number(e).toFixed(2):"-"},isOpenOrder(e){const t=(e.status||"").toUpperCase();return co.has(t)||""===t},async cancelOrder(e){try{const t=await fetch(`http://${window.location.hostname}:8000/api/cancel_order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:e.order_id})}),s=await t.json();if(!t.ok)throw new Error(s.detail||"cancel failed");e.status="CAN"}catch(t){console.error("Cancel error",t)}},closeOrder(e,t){const s=e.quantity_ordered,i=Math.abs(s),o=Math.floor(i*t);o<1?console.warn(`Nothing to flatten for ${e.symbol}`):(console.log(`Closing ${o} of ${s} (${100*t}%) shares of ${e.symbol}`),fetch(`http://${window.location.hostname}:8000/api/flattenPosition`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e.symbol,order_id:e.order_id,flatten_type:"panic",quantity:o})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("Flatten response:",e)})).catch((e=>{console.error("Error flattening position:",e)})))},setEmaTrail(e,t){console.log(`Setting EMA-based trailing stop for ${e.symbol}`),fetch(`http://${window.location.hostname}:8000/api/setStopLoss`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e.symbol,order_id:e.order_id,indicator:t})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("StopLoss set:",e)})).catch((e=>{console.error("Error setting EMA-based stoploss:",e)}))},submitManualStopLoss(e){const t=this.manualStopLoss[e.order_id];t&&!isNaN(t)?(console.log(`Setting manual stop loss for ${e.symbol} at ${t}`),fetch(`http://${window.location.hostname}:8000/api/setStopLoss`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e.symbol,order_id:e.order_id,stop_price:t,indicator:"manual"})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("Manual StopLoss set:",e)})).catch((e=>{console.error("Error setting manual stoploss:",e)}))):console.warn("Invalid stop loss price")},submitTrailingStopLoss(e){const t=this.trailingStopLoss[e.order_id];t&&!isNaN(t)?(console.log(`Setting trailing stop for ${e.symbol} with amount ${t}`),fetch(`http://${window.location.hostname}:8000/api/setStopLoss`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:e.symbol,order_id:e.order_id,trail_amount:t,indicator:"trailing"})}).then((e=>{if(!e.ok)throw new Error(`API error: ${e.statusText}`);return e.json()})).then((e=>{console.log("Trailing StopLoss set:",e)})).catch((e=>{console.error("Error setting trailing stoploss:",e)}))):console.warn("Invalid trailing stop value")}}};const go=(0,r.A)(po,[["render",ro],["__scopeId","data-v-466f9dea"]]);var So=go;const ko={class:"layout-table"},bo={class:"main-content"},fo={class:"main-order-controls"},vo={class:"preset-buttons"},wo={class:"timeframe-selection"},yo=["onClick"],Lo=["title"],Co={class:"stoploss-presets"},To={key:0,class:"button-value"},Ao={class:"price-line"},Eo={class:"risk-line"},Mo={key:0,class:"button-value"},_o={class:"price-line"},$o={class:"risk-line"},Io={key:0,class:"button-value"},Fo={class:"price-line"},Po={class:"risk-line"},Ro={key:0,class:"button-value"},Do={class:"price-line"},Wo={class:"risk-line"},xo={key:0,class:"button-value"},No={class:"price-line"},Oo={class:"risk-line"},Bo={key:0,class:"button-value"},Vo={class:"price-line"},Uo={class:"risk-line"},Xo={class:"order-table"},Ho={class:"breakout-toggle"},zo=["disabled"],Qo={key:0,class:"breakout-controls-wrapper"},qo={class:"form-field"},jo={class:"breakout-hint"},Ko={class:"form-field breakout-controls"},Go=["disabled"],Yo=["disabled"];function Jo(e,t,s,a,n,l){return(0,o.uX)(),(0,o.CE)("div",{class:"order-entry-panel",style:(0,m.Tr)(l.panelStyle)},[(0,o.Lk)("table",ko,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",bo,[(0,o.Lk)("div",fo,[(0,o.Lk)("div",vo,[(0,o.Lk)("div",wo,[t[21]||(t[21]=(0,o.Lk)("span",null,"Timeframe:",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.timeframes,(e=>((0,o.uX)(),(0,o.CE)("button",{key:e,class:(0,m.C4)(["timeframe-button",{active:n.selectedTimeframe===e}]),onClick:t=>l.setTimeframe(e)},(0,m.v_)(e),11,yo)))),128)),(0,o.Lk)("div",{class:(0,m.C4)(["status-message-inline",n.statusMessageType||"placeholder"]),onClick:t[0]||(t[0]=(...e)=>l.showFullStatusMessage&&l.showFullStatusMessage(...e)),title:n.statusMessage||"Status messages will appear here"},(0,m.v_)(n.statusMessage||"Status messages will appear here"),11,Lo)]),(0,o.Lk)("div",Co,[(0,o.Lk)("button",{class:"side-arrow buy-arrow",onClick:t[1]||(t[1]=e=>l.setSide("Buy")),title:"Buy"},"⬆"),(0,o.Lk)("button",{class:"side-arrow sellshort-arrow",onClick:t[2]||(t[2]=e=>l.setSide("SellShort")),title:"Sell Short"},"⬇"),(0,o.Lk)("button",{class:"stoploss-button candle-based",onClick:t[3]||(t[3]=e=>l.loadStopLoss(5))},[t[22]||(t[22]=(0,o.Lk)("div",{class:"button-label"},"SL 5 ⬅",-1)),n.stopLossValues[5]?((0,o.uX)(),(0,o.CE)("div",To,[(0,o.Lk)("div",Ao,"$"+(0,m.v_)(l.formatPrice(n.stopLossValues[5][n.side])),1),(0,o.Lk)("div",Eo,"R: $"+(0,m.v_)(l.calculateRiskPerShare(n.stopLossValues[5][n.side])),1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("button",{class:"stoploss-button candle-based",onClick:t[4]||(t[4]=e=>l.loadStopLoss(10))},[t[23]||(t[23]=(0,o.Lk)("div",{class:"button-label"},"SL 10 ⬅",-1)),n.stopLossValues[10]?((0,o.uX)(),(0,o.CE)("div",Mo,[(0,o.Lk)("div",_o,"$"+(0,m.v_)(l.formatPrice(n.stopLossValues[10][n.side])),1),(0,o.Lk)("div",$o,"R: $"+(0,m.v_)(l.calculateRiskPerShare(n.stopLossValues[10][n.side])),1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("button",{class:"stoploss-button candle-based",onClick:t[5]||(t[5]=e=>l.loadStopLoss(15))},[t[24]||(t[24]=(0,o.Lk)("div",{class:"button-label"},"SL 15 ⬅",-1)),n.stopLossValues[15]?((0,o.uX)(),(0,o.CE)("div",Io,[(0,o.Lk)("div",Fo,"$"+(0,m.v_)(l.formatPrice(n.stopLossValues[15][n.side])),1),(0,o.Lk)("div",Po,"R: $"+(0,m.v_)(l.calculateRiskPerShare(n.stopLossValues[15][n.side])),1)])):(0,o.Q3)("",!0)]),t[28]||(t[28]=(0,o.Lk)("div",{class:"group-spacer"},null,-1)),(0,o.Lk)("button",{class:"stoploss-button atr-based",onClick:t[6]||(t[6]=e=>l.loadStopLossATR(1))},[t[25]||(t[25]=(0,o.Lk)("div",{class:"button-label"},"SL 1 ATR",-1)),n.atrStopLossValues[1]?((0,o.uX)(),(0,o.CE)("div",Ro,[(0,o.Lk)("div",Do,"$"+(0,m.v_)(l.formatPrice(n.atrStopLossValues[1][n.side])),1),(0,o.Lk)("div",Wo,"R: $"+(0,m.v_)(l.calculateRiskPerShare(n.atrStopLossValues[1][n.side])),1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("button",{class:"stoploss-button atr-based",onClick:t[7]||(t[7]=e=>l.loadStopLossATR(2))},[t[26]||(t[26]=(0,o.Lk)("div",{class:"button-label"},"SL 2 ATR",-1)),n.atrStopLossValues[2]?((0,o.uX)(),(0,o.CE)("div",xo,[(0,o.Lk)("div",No,"$"+(0,m.v_)(l.formatPrice(n.atrStopLossValues[2][n.side])),1),(0,o.Lk)("div",Oo,"R: $"+(0,m.v_)(l.calculateRiskPerShare(n.atrStopLossValues[2][n.side])),1)])):(0,o.Q3)("",!0)]),(0,o.Lk)("button",{class:"stoploss-button atr-based",onClick:t[8]||(t[8]=e=>l.loadStopLossATR(2.5))},[t[27]||(t[27]=(0,o.Lk)("div",{class:"button-label"},"SL 2.5 ATR",-1)),n.atrStopLossValues[2.5]?((0,o.uX)(),(0,o.CE)("div",Bo,[(0,o.Lk)("div",Vo,"$"+(0,m.v_)(l.formatPrice(n.atrStopLossValues[2.5][n.side])),1),(0,o.Lk)("div",Uo,"R: $"+(0,m.v_)(l.calculateRiskPerShare(n.atrStopLossValues[2.5][n.side])),1)])):(0,o.Q3)("",!0)])])]),(0,o.Lk)("table",Xo,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{class:"input_field","onUpdate:modelValue":t[9]||(t[9]=e=>l.symbol=e),disabled:"",size:"8"},null,512),[[i.Jo,l.symbol]])]),t[30]||(t[30]=(0,o.Lk)("td",null,[(0,o.Lk)("label",null,"Risk$:")],-1)),t[31]||(t[31]=(0,o.Lk)("td",null,[(0,o.Lk)("label",null,"Price:")],-1)),t[32]||(t[32]=(0,o.Lk)("td",null,[(0,o.Lk)("label",null,"Stop:")],-1)),(0,o.Lk)("td",null,[(0,o.Lk)("label",Ho,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>n.isBreakoutOrder=e)},null,512),[[i.lH,n.isBreakoutOrder]]),t[29]||(t[29]=(0,o.eW)(" Breakout Order "))])])]),(0,o.Lk)("tr",null,[(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("select",{class:"input_field","onUpdate:modelValue":t[11]||(t[11]=e=>n.side=e)},t[33]||(t[33]=[(0,o.Lk)("option",{value:"Buy"},"Long",-1),(0,o.Lk)("option",{value:"Sell"},"Sell",-1),(0,o.Lk)("option",{value:"SellShort"},"Short",-1),(0,o.Lk)("option",{value:"BuyToCover"},"BuyToCover",-1)]),512),[[i.u1,n.side]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{class:"input_field",type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>n.risk=e),size:"3"},null,512),[[i.Jo,n.risk,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{class:"input_field price-stop-field",type:"number",step:"0.01","onUpdate:modelValue":t[13]||(t[13]=e=>n.price=e),size:"10"},null,512),[[i.Jo,n.price,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.bo)((0,o.Lk)("input",{class:"input_field price-stop-field",type:"number",step:"0.01","onUpdate:modelValue":t[14]||(t[14]=e=>n.stopLoss=e),size:"10"},null,512),[[i.Jo,n.stopLoss,void 0,{number:!0}]])]),(0,o.Lk)("td",null,[(0,o.Lk)("button",{class:"input_field",onClick:t[15]||(t[15]=e=>l.placeOrder(!1))},(0,m.v_)(n.isBreakoutOrder?"Place Breakout":"Place Limit"),1),(0,o.Lk)("button",{class:"input_field",onClick:t[16]||(t[16]=(...e)=>l.placeFastOrder&&l.placeFastOrder(...e)),disabled:!l.isFreshDataAvailable||n.isBreakoutOrder,style:{"margin-left":"0.5rem"}},(0,m.v_)(n.isBreakoutOrder?"N/A":"Scalp"),9,zo)])])]),n.isBreakoutOrder?((0,o.uX)(),(0,o.CE)("div",Qo,[(0,o.Lk)("div",qo,[t[34]||(t[34]=(0,o.Lk)("label",null,"Trigger:",-1)),(0,o.bo)((0,o.Lk)("input",{class:"input_field",type:"number",step:"0.01","onUpdate:modelValue":t[17]||(t[17]=e=>n.triggerPrice=e),size:"8",placeholder:"Break price"},null,512),[[i.Jo,n.triggerPrice,void 0,{number:!0}]]),(0,o.Lk)("span",jo,(0,m.v_)(l.breakoutHint),1)]),(0,o.Lk)("div",Ko,[t[36]||(t[36]=(0,o.Lk)("label",null,"Lookback:",-1)),(0,o.bo)((0,o.Lk)("select",{class:"input_field lookback-select","onUpdate:modelValue":t[18]||(t[18]=e=>n.lookbackPeriod=e)},t[35]||(t[35]=[(0,o.Lk)("option",{value:"5"},"5 candles",-1),(0,o.Lk)("option",{value:"10"},"10 candles",-1),(0,o.Lk)("option",{value:"15"},"15 candles",-1),(0,o.Lk)("option",{value:"20"},"20 candles",-1)]),512),[[i.u1,n.lookbackPeriod,void 0,{number:!0}]]),(0,o.Lk)("button",{class:"local-level-btn",onClick:t[19]||(t[19]=(...e)=>l.useLocalHigh&&l.useLocalHigh(...e)),disabled:!l.canUseLocalLevels}," Use Local High ",8,Go),(0,o.Lk)("button",{class:"local-level-btn",onClick:t[20]||(t[20]=(...e)=>l.useLocalLow&&l.useLocalLow(...e)),disabled:!l.canUseLocalLevels}," Use Local Low ",8,Yo)])])):(0,o.Q3)("",!0)])])])])],4)}var Zo={name:"OrderEntryPanel",props:{currentSymbol:{type:String,default:""},selectedPrice:{type:Number,default:null},selectedSide:{type:String,default:"Buy"},currentQuote:{type:Object,default:()=>({bid:null,ask:null})},isQuoteLive:{type:Boolean,default:!1},level2Ref:{type:Object,default:null}},data(){return{side:"Buy",risk:100,price:null,stopLoss:null,isBreakoutOrder:!1,triggerPrice:null,lookbackPeriod:10,stopLossValues:{},atrStopLossValues:{},currentMinute:(new Date).getMinutes(),minuteTimer:null,statusMessage:null,statusMessageType:null,statusMessageTimer:null,showTestValues:!1,ohlcWs:null,currentATR:null,currentPrice:null,selectedTimeframe:"1m",timeframes:["1m","2m","3m","5m","15m"],historicalBars:[],currentTime:Date.now(),freshnessCheckTimer:null,atrByTimeframe:{"1m":null,"2m":null,"3m":null,"5m":null,"15m":null},historicalBarsByTimeframe:{"1m":[],"2m":[],"3m":[],"5m":[],"15m":[]},autoRefreshInterval:null}},computed:{symbol(){return this.currentSymbol},panelStyle(){return"Buy"===this.side?{backgroundColor:"#ccffcc"}:"SellShort"===this.side?{backgroundColor:"#ffcccc"}:{}},breakoutHint(){return this.isBreakoutOrder?"Buy"===this.side||"BuyToCover"===this.side?"Order executes when price breaks ABOVE trigger":"Order executes when price breaks BELOW trigger":""},canUseLocalLevels(){return this.historicalBars&&this.historicalBars.length>=Math.min(this.lookbackPeriod,5)},isFreshDataAvailable(){const e=this.currentTime,t=5e3;if(this.currentQuote?.bidPrice&&this.currentQuote?.askPrice&&this.currentQuote?.receivedTimestamp){const s=e-this.currentQuote.receivedTimestamp;if(s<t)return!0}if(this.level2Ref){const s=this.level2Ref,i=s.lastHeartbeat?e-s.lastHeartbeat:null;if(null!==i&&i<t){const e=s.groupedBids?.[0],t=s.groupedAsks?.[0];if(e?.Price&&t?.Price)return!0}}return!1}},watch:{selectedSide(e){e&&(this.side=e)},selectedPrice(e){null!==e&&(this.price=e)},currentSymbol(e){e&&this.ohlcWs&&this.ohlcWs.close()}},methods:{getFreshestBidAsk(){const e=this.currentTime,t=5e3;let s=null,i=null,o=null,a=null,n=null,l=null;if(this.currentQuote?.bidPrice&&this.currentQuote?.askPrice&&this.currentQuote?.receivedTimestamp&&(o=e-this.currentQuote.receivedTimestamp,o<t&&(s=this.currentQuote.bidPrice,i=this.currentQuote.askPrice)),this.level2Ref){const s=this.level2Ref;if(l=s.lastHeartbeat?e-s.lastHeartbeat:null,null!==l&&l<t){const e=s.groupedBids?.[0],t=s.groupedAsks?.[0];e?.Price&&t?.Price&&(a=parseFloat(e.Price),n=parseFloat(t.Price))}}let r=null,c=null,d=null,u=null;return null!==s&&null!==a?o<=l?(r=s,c=i,d="Quote",u=o):(r=a,c=n,d="Level2",u=l):null!==s?(r=s,c=i,d="Quote",u=o):null!==a&&(r=a,c=n,d="Level2",u=l),null!==r&&null!==c?(console.log(`✓ Using fresh ${d} data: bid=${r}, ask=${c}, age=${(u/1e3).toFixed(1)}s`),{bid:r,ask:c,source:d,age:u}):(console.warn("⚠️ No fresh bid/ask data available (< 5 seconds)"),null)},async placeOrder(e=!1){let t=this.price,s=this.stopLoss;if(null===s||""===s||s<=0)return void alert("A positive Stop price is required for all orders.");if(this.isBreakoutOrder){if(null===this.triggerPrice||""===this.triggerPrice||this.triggerPrice<=0)return void alert("A trigger price is required for breakout orders.");if(("Buy"===this.side||"BuyToCover"===this.side)&&this.triggerPrice<=(this.currentQuote?.bidPrice||this.currentPrice||0))return void alert("For long breakout orders, trigger price must be ABOVE current price.");if(("SellShort"===this.side||"Sell"===this.side)&&this.triggerPrice>=(this.currentQuote?.askPrice||this.currentPrice||999999))return void alert("For short breakout orders, trigger price must be BELOW current price.")}const i={symbol:this.symbol,trade_action:this.side.toUpperCase(),risk_value:this.risk,stop_price:s,limit_price:null,current_bid:null,current_ask:null,is_breakout_order:this.isBreakoutOrder,trigger_price:this.isBreakoutOrder?this.triggerPrice:null};if(e)if(null===t||""===t||0===t){const e=this.getFreshestBidAsk();if(!e)return void alert("Cannot place scalp order: No fresh price data available.\n\nBoth Quote and Level2 data are either unavailable or stale (>5 seconds old).\nPlease wait for fresh market data.");const t=(e.age/1e3).toFixed(1);console.log(`Using ${e.source} data (${t}s old) for scalp order`),i.limit_price=null,i.current_bid=e.bid,i.current_ask=e.ask}else i.limit_price=t;else{if(null===t||""===t||0===t)return void alert("Price is required for a regular limit order and cannot be zero.");i.limit_price=t}console.log("Placing order with payload:",i);try{const e=await fetch(`http://${window.location.hostname}:8000/api/placeOrderWithStopMarket`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),t=await e.json();if(!e.ok){const s=t.detail||t.message||`HTTP ${e.status}: ${e.statusText}`;return this.showStatusMessage(`Order failed: ${s}`,"error"),void console.error("Order placement failed:",t)}if(t.result&&t.result.Orders){const e=t.result.Orders,s=e.filter((e=>"FAILED"===e.Error));if(s.length>0){const e=s.map((e=>e.Message)).join(" ");return this.showStatusMessage(`Order failed: ${e}`,"error"),void console.error("Broker rejected order:",s)}}console.log("Place order result:",t),this.showStatusMessage("Order placed successfully!","success")}catch(o){console.error("Error placing order:",o),this.showStatusMessage(`Network error: ${o.message}`,"error")}},async placeFastOrder(){await this.placeOrder(!0)},setSide(e){console.log("Setting side to:",e),this.side=e;const t="SellShort"===e?"SHORT":"LONG";console.log("OrderEntryPanel emitting view-mode-changed:",t),this.$emit("view-mode-changed",t)},loadStopLoss(e){this.stopLossValues[e]&&this.stopLossValues[e][this.side]?(this.stopLoss=this.stopLossValues[e][this.side],console.log(`🎯 Set stop loss to: ${this.stopLoss} for ${e} candles, side: ${this.side}`)):console.warn(`⚠️ No stop loss value available for ${e} candles, side: ${this.side}`)},formatPrice(e){return null!=e?Number(e).toFixed(2):"-"},showStatusMessage(e,t,s=5e3){this.statusMessage=e,this.statusMessageType=t,this.statusMessageTimer&&clearTimeout(this.statusMessageTimer),this.statusMessageTimer=setTimeout((()=>{this.statusMessage=null,this.statusMessageType=null}),s)},showFullStatusMessage(){this.statusMessage&&"Status messages will appear here"!==this.statusMessage&&alert(this.statusMessage)},toggleValues(){this.showTestValues=!this.showTestValues,console.log("🔍 Debug State:"),console.log("Current timeframe:",this.selectedTimeframe),console.log("Current price:",this.currentPrice),console.log("Stop loss values:",JSON.stringify(this.stopLossValues)),console.log("Side:",this.side)},calculateRiskPerShare(e){if(!e)return"0.00";let t;t=this.currentQuote&&this.currentQuote.bidPrice&&this.currentQuote.askPrice?"Buy"===this.side||"BuyToCover"===this.side?this.currentQuote.askPrice:this.currentQuote.bidPrice:this.currentPrice||this.price||50;const s="Buy"===this.side||"BuyToCover"===this.side?t-e:e-t;return Math.abs(s).toFixed(2)},initOhlcWebSocket(){this.symbol&&(this.ohlcWs=new WebSocket(`ws://${window.location.hostname}:8000/ws/ohlc?symbol=${this.symbol}`),this.ohlcWs.onmessage=({data:e})=>{const t=JSON.parse(e);if(console.log("OHLC WebSocket message received:",t),"OHLC_UPDATE"===t.type){const{bar:e,indicator:s}=t,i=this.selectedTimeframe.replace("m","min");if(console.log("Bar timeframe:",e?.timeframe,"Expected:",i),e&&e.timeframe===i&&(console.log("Updating current price with:",e),this.currentPrice=e.close),e&&(console.log("Updating bars for timeframe:",e.timeframe),this.updateHistoricalBarsForTimeframe(e),e.timeframe===i&&this.autoUpdateStopLossValuesFromAPI()),s?.trendIndicators?.atr14){const t=e?.timeframe?.replace("min","m")||this.selectedTimeframe;console.log("Updating ATR for timeframe:",t,"value:",s.trendIndicators.atr14),this.atrByTimeframe[t]=parseFloat(s.trendIndicators.atr14),t===this.selectedTimeframe&&(this.currentATR=parseFloat(s.trendIndicators.atr14),this.autoUpdateATRStopLossValues())}}else{const{bar:e,indicator:s}=t;if(e){const t=this.selectedTimeframe.replace("m","min");console.log("Redis Bar timeframe:",e.timeframe,"Expected:",t),e.timeframe===t&&(console.log("Updating current price with Redis data:",e),this.currentPrice=e.close),console.log("Updating bars for timeframe (Redis):",e.timeframe),this.updateHistoricalBarsForTimeframe(e),e.timeframe===t&&this.autoUpdateStopLossValuesFromAPI()}if(s?.trendIndicators?.atr14){const t=e?.timeframe?.replace("min","m")||this.selectedTimeframe;console.log("Updating ATR for timeframe (Redis):",t,"value:",s.trendIndicators.atr14),this.atrByTimeframe[t]=parseFloat(s.trendIndicators.atr14),t===this.selectedTimeframe&&(this.currentATR=parseFloat(s.trendIndicators.atr14),this.autoUpdateATRStopLossValues())}}},this.ohlcWs.onopen=()=>{console.log("OHLC WebSocket connected for OrderEntryPanel")},this.ohlcWs.onerror=e=>{console.error("OHLC WebSocket error:",e)})},loadStopLossATR(e){this.atrStopLossValues[e]&&this.atrStopLossValues[e][this.side]?(this.stopLoss=this.atrStopLossValues[e][this.side],console.log(`🎯 Set ATR stop loss to: ${this.stopLoss} for ${e}x ATR, side: ${this.side}`)):console.warn(`⚠️ No ATR stop loss value available for ${e}x ATR, side: ${this.side}`)},async setTimeframe(e){this.selectedTimeframe=e,this.historicalBars=this.historicalBarsByTimeframe[e]||[],this.currentATR=this.atrByTimeframe[e],console.log("Timeframe changed to:",e),console.log("Historical bars for this timeframe:",this.historicalBars.length),console.log("ATR for this timeframe:",this.currentATR),this.currentATR||(this.atrStopLossValues={},console.log("Cleared ATR stop loss values - no ATR data for timeframe")),this.historicalBars.length<15&&await this.loadInitialCandles(),this.autoUpdateStopLossValuesFromAPI(),this.currentATR&&this.autoUpdateATRStopLossValues()},updateHistoricalBars(e){console.log("Adding bar to historical data:",e),this.historicalBars.push(e),this.historicalBars.length>20&&(this.historicalBars=this.historicalBars.slice(-20)),console.log("Total historical bars:",this.historicalBars.length)},async loadInitialCandles(){try{const e=this.selectedTimeframe.replace("m","min"),t=await fetch(`http://${window.location.hostname}:8000/api/indicators/ohlc/${this.symbol}?timeframe=${e}&limit=20`);if(!t.ok)return void console.warn("Failed to load initial candles:",t.statusText);const s=await t.json();console.log("Loaded initial candles:",s),s.success&&s.candles&&(this.historicalBarsByTimeframe[this.selectedTimeframe]=s.candles.map((e=>({open:e.open,high:e.high,low:e.low,close:e.close,volume:e.volume,timeframe:e.timeframe,startTimestamp:e.timestamp}))),this.historicalBars=this.historicalBarsByTimeframe[this.selectedTimeframe],s.candles.length>0&&(this.currentPrice=s.candles[s.candles.length-1].close),s.indicators?.trendIndicators?.atr14&&(this.atrByTimeframe[this.selectedTimeframe]=parseFloat(s.indicators.trendIndicators.atr14),this.currentATR=this.atrByTimeframe[this.selectedTimeframe]),console.log("Updated historical bars:",this.historicalBars.length),console.log("Updated ATR:",this.currentATR),this.autoUpdateStopLossValuesFromAPI(),this.currentATR&&this.autoUpdateATRStopLossValues())}catch(e){console.error("Error loading initial candles:",e)}},updateHistoricalBarsForTimeframe(e){const t=e.timeframe?.replace("min","m");t&&this.historicalBarsByTimeframe[t]&&(console.log("Adding bar to historical data for timeframe:",t,e),this.historicalBarsByTimeframe[t].push(e),this.historicalBarsByTimeframe[t].length>20&&(this.historicalBarsByTimeframe[t]=this.historicalBarsByTimeframe[t].slice(-20)),t===this.selectedTimeframe&&(this.historicalBars=this.historicalBarsByTimeframe[t]),console.log("Total historical bars for",t+":",this.historicalBarsByTimeframe[t].length))},async autoUpdateStopLossValuesFromAPI(){try{const e=this.selectedTimeframe.replace("m","min"),t=`http://${window.location.hostname}:8000/api/indicators/ohlc/${this.symbol}?timeframe=${e}&limit=15`,s=await fetch(t);if(!s.ok)return;const i=await s.json();if(i.success&&i.candles&&i.candles.length>=5){const e=i.candles,t=[5,10,15];t.forEach((t=>{if(e.length>=t){const s=e.slice(-t),i=Number((Math.min(...s.map((e=>e.low)))-.03).toFixed(2)),o=Number((Math.max(...s.map((e=>e.high)))+.03).toFixed(2));this.stopLossValues={...this.stopLossValues,[t]:{Buy:i,SellShort:o}}}}))}}catch(e){console.error("Error in autoUpdateStopLossValuesFromAPI:",e)}},autoUpdateStopLossValues(){console.log("autoUpdateStopLossValues called, bars:",this.historicalBars.length);const e=this.historicalBars||[],t=this.historicalBarsByTimeframe["1m"]||[];console.log(`Selected timeframe (${this.selectedTimeframe}) bars:`,e.length),console.log("Available 1-minute bars:",t.length);const s=[...e,...t];if(s.length<5)return void console.log("Not enough combined bars for stop loss calculation");const i=[5,10,15];i.forEach((e=>{if(s.length>=e){const t=s.slice(-e),i=Number((Math.min(...t.map((e=>e.low)))-.03).toFixed(2)),o=Number((Math.max(...t.map((e=>e.high)))+.03).toFixed(2));this.stopLossValues[e]={Buy:i,SellShort:o},console.log(`Updated stop loss ${e} using ${t.length} combined bars:`,this.stopLossValues[e])}}))},autoUpdateATRStopLossValues(){if(!this.currentATR||!this.currentPrice)return;const e=this.currentATR,t=this.currentPrice,s=[1,2,2.5];s.forEach((s=>{const i=Number((t-e*s).toFixed(2)),o=Number((t+e*s).toFixed(2));this.atrStopLossValues[s]||(this.atrStopLossValues[s]={}),this.atrStopLossValues[s].Buy=i,this.atrStopLossValues[s].SellShort=o}))},startAutoRefresh(){const e=()=>{const e=new Date,t=e.getSeconds(),s=e.getMilliseconds();let i;i=t<2?1e3*(2-t)-s:1e3*(62-t)-s,console.log(`⏰ Next refresh scheduled in ${Math.round(i/1e3)}s (at ${new Date(Date.now()+i).toLocaleTimeString()})`),this.autoRefreshInterval=setTimeout((()=>{const e=(new Date).toLocaleTimeString();console.log(`🕐 Auto-refresh triggered at ${e} (2s after minute)`),this.autoUpdateStopLossValuesFromAPI(),this.currentATR&&this.autoUpdateATRStopLossValues(),this.autoRefreshInterval=setInterval((()=>{const e=(new Date).toLocaleTimeString();console.log(`🕐 Auto-refresh triggered at ${e} (2s after minute)`),this.autoUpdateStopLossValuesFromAPI(),this.currentATR&&this.autoUpdateATRStopLossValues()}),6e4)}),i)};e(),console.log("✅ Started auto-refresh synchronized to 2 seconds after each minute")},stopAutoRefresh(){this.autoRefreshInterval&&(clearInterval(this.autoRefreshInterval),this.autoRefreshInterval=null,console.log("⏹️ Stopped auto-refresh"))},async useLocalHigh(){try{const e=this.selectedTimeframe.replace("m","min"),t=await fetch(`http://${window.location.hostname}:8000/api/indicators/ohlc/${this.symbol}?timeframe=${e}&limit=${Math.max(this.lookbackPeriod,15)}`);if(!t.ok)return void alert("Failed to fetch candle data for local high analysis");const s=await t.json();if(s.success&&s.candles&&s.candles.length>=this.lookbackPeriod){const e=s.candles.slice(-this.lookbackPeriod),t=Math.max(...e.map((e=>e.high)));this.triggerPrice=Number((t+.01).toFixed(2)),this.showStatusMessage(`Set trigger to local high: $${this.triggerPrice} (${this.lookbackPeriod} candles)`,"success")}else alert(`Insufficient candle data. Need at least ${this.lookbackPeriod} candles.`)}catch(e){console.error("Error finding local high:",e),alert("Error analyzing local high levels")}},async useLocalLow(){try{const e=this.selectedTimeframe.replace("m","min"),t=await fetch(`http://${window.location.hostname}:8000/api/indicators/ohlc/${this.symbol}?timeframe=${e}&limit=${Math.max(this.lookbackPeriod,15)}`);if(!t.ok)return void alert("Failed to fetch candle data for local low analysis");const s=await t.json();if(s.success&&s.candles&&s.candles.length>=this.lookbackPeriod){const e=s.candles.slice(-this.lookbackPeriod),t=Math.min(...e.map((e=>e.low)));this.triggerPrice=Number((t-.01).toFixed(2)),this.showStatusMessage(`Set trigger to local low: $${this.triggerPrice} (${this.lookbackPeriod} candles)`,"success")}else alert(`Insufficient candle data. Need at least ${this.lookbackPeriod} candles.`)}catch(e){console.error("Error finding local low:",e),alert("Error analyzing local low levels")}},loadSignal(e){console.log("Loading signal into order entry panel:",e),e.entry_price&&(this.price=Number(e.entry_price)),e.stop_loss&&(this.stopLoss=Number(e.stop_loss));const t=(e.direction||e.manipulation_direction||"").toUpperCase();"LONG"===t||"BUY"===t?this.side="Buy":"SHORT"!==t&&"SELL"!==t&&"SELLSHORT"!==t||(this.side="SellShort")}},async mounted(){this.initOhlcWebSocket(),await this.loadInitialCandles(),this.startAutoRefresh(),this.freshnessCheckTimer=setInterval((()=>{this.currentTime=Date.now()}),500),this.handleBeforeUnload=()=>{this.ohlcWs&&this.ohlcWs.readyState===WebSocket.OPEN&&(console.log("Closing OHLC WebSocket on page unload"),this.ohlcWs.close())},window.addEventListener("beforeunload",this.handleBeforeUnload)},beforeUnmount(){this.ohlcWs&&this.ohlcWs.close(),this.stopAutoRefresh(),this.freshnessCheckTimer&&(clearInterval(this.freshnessCheckTimer),this.freshnessCheckTimer=null),this.handleBeforeUnload&&window.removeEventListener("beforeunload",this.handleBeforeUnload)}};const ea=(0,r.A)(Zo,[["render",Jo],["__scopeId","data-v-1d8873f8"]]);var ta=ea;const sa={class:"indicators-panel"},ia=["innerHTML"],oa={class:"signals-row"},aa={class:"indicator-group"},na=["title"],la={class:"indicator-group"},ra=["title"],ca={class:"indicator-group"},da=["title"],ua={class:"indicator-group"},ma=["title"],ha={class:"indicator-group"},pa=["title"],ga={class:"indicator-group"},Sa=["title"],ka={class:"indicator-group"},ba=["title"],fa={class:"indicator-group"},va=["title"],wa={class:"indicator-group"},ya=["title"],La={class:"indicator-group"},Ca=["title"],Ta={class:"indicator-group"},Aa=["title"],Ea={class:"indicator-group"},Ma=["title"],_a={class:"indicator-group"},$a=["title"],Ia={class:"indicator-group"},Fa=["title"],Pa={class:"indicator-group"},Ra=["title"],Da={class:"indicator-group"},Wa=["title"],xa={class:"indicator-group"},Na=["title"],Oa={class:"indicator-group"},Ba=["title"],Va={class:"indicator-group"},Ua=["title"],Xa={class:"indicator-group"},Ha=["title"],za={class:"indicator-group"},Qa=["title"],qa={class:"indicator-group"},ja=["title"],Ka={class:"indicator-group"},Ga=["title"],Ya={class:"indicator-group"},Ja=["title"],Za={class:"indicator-group"},en=["title"],tn={class:"indicator-group"},sn=["title"],on={class:"indicator-group"},an=["title"],nn={class:"indicator-group"},ln=["title"],rn={class:"indicator-group"},cn=["title"],dn={class:"indicator-group"},un=["title"],mn={class:"indicator-group"},hn=["title"],pn={class:"indicator-group"},gn=["title"],Sn={class:"indicator-group"},kn=["title"],bn={class:"indicator-group"},fn=["title"],vn={class:"indicator-group"},wn=["title"];function yn(e,t,s,i,a,n){return(0,o.uX)(),(0,o.CE)("div",sa,[a.showingTooltip?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"custom-tooltip",style:(0,m.Tr)(n.tooltipStyle),onClick:t[0]||(t[0]=(...e)=>n.hideTooltip&&n.hideTooltip(...e))},[(0,o.Lk)("div",{class:"tooltip-content",innerHTML:a.showingTooltip.content},null,8,ia)],4)):(0,o.Q3)("",!0),(0,o.Lk)("div",oa,[(0,o.Lk)("span",{class:"timeframe-label",title:"All 1min Indicators",onClick:t[1]||(t[1]=e=>n.showAllIndicators(e,"1min"))},"1m:"),(0,o.Lk)("div",aa,[t[41]||(t[41]=(0,o.Lk)("div",{class:"indicator-letter",title:"CMF - Chaikin Money Flow"},"C",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getCMFSignal("1min"))]),title:`CMF 1min: ${n.getCMFValue("1min")} (${n.getCMFSignal("1min")})`,onClick:t[2]||(t[2]=e=>n.showTooltip(e,"CMF","1min"))},(0,m.v_)(n.getSignalIcon(n.getCMFSignal("1min"))),11,na)]),(0,o.Lk)("div",la,[t[42]||(t[42]=(0,o.Lk)("div",{class:"indicator-letter",title:"RSI - Relative Strength Index"},"R",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getRSISignal("1min"))]),title:`RSI 1min: ${n.getRSIValue("1min")} (${n.getRSISignal("1min")})`,onClick:t[3]||(t[3]=e=>n.showTooltip(e,"RSI","1min"))},(0,m.v_)(n.getSignalIcon(n.getRSISignal("1min"))),11,ra)]),(0,o.Lk)("div",ca,[t[43]||(t[43]=(0,o.Lk)("div",{class:"indicator-letter",title:"MACD - Moving Average Convergence Divergence"},"M",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getMACDSignal("1min"))]),title:`MACD 1min: ${n.getMACDValue("1min")} (${n.getMACDSignal("1min")})`,onClick:t[4]||(t[4]=e=>n.showTooltip(e,"MACD","1min"))},(0,m.v_)(n.getSignalIcon(n.getMACDSignal("1min"))),11,da)]),(0,o.Lk)("div",ua,[t[44]||(t[44]=(0,o.Lk)("div",{class:"indicator-letter",title:"Stochastics - Momentum Oscillator"},"S",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getStochSignal("1min"))]),title:`Stoch 1min: ${n.getStochValue("1min")} (${n.getStochSignal("1min")})`,onClick:t[5]||(t[5]=e=>n.showTooltip(e,"STOCH","1min"))},(0,m.v_)(n.getSignalIcon(n.getStochSignal("1min"))),11,ma)]),(0,o.Lk)("div",ha,[t[45]||(t[45]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 9/21 - Exponential Moving Average Crossover"},"9",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA921Signal("1min"))]),title:`EMA 9/21 1min: ${n.getEMA921Value("1min")} (${n.getEMA921Signal("1min")})`,onClick:t[6]||(t[6]=e=>n.showTooltip(e,"EMA921","1min"))},(0,m.v_)(n.getSignalIcon(n.getEMA921Signal("1min"))),11,pa)]),(0,o.Lk)("div",ga,[t[46]||(t[46]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 21/50 - Exponential Moving Average Crossover"},"2",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA2150Signal("1min"))]),title:`EMA 21/50 1min: ${n.getEMA2150Value("1min")} (${n.getEMA2150Signal("1min")})`,onClick:t[7]||(t[7]=e=>n.showTooltip(e,"EMA2150","1min"))},(0,m.v_)(n.getSignalIcon(n.getEMA2150Signal("1min"))),11,Sa)]),(0,o.Lk)("div",ka,[t[47]||(t[47]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 50/200 - Exponential Moving Average Crossover"},"5",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA50200Signal("1min"))]),title:`EMA 50/200 1min: ${n.getEMA50200Value("1min")} (${n.getEMA50200Signal("1min")})`,onClick:t[8]||(t[8]=e=>n.showTooltip(e,"EMA50200","1min"))},(0,m.v_)(n.getSignalIcon(n.getEMA50200Signal("1min"))),11,ba)]),(0,o.Lk)("span",{class:"timeframe-label",title:"All 2min Indicators",onClick:t[9]||(t[9]=e=>n.showAllIndicators(e,"2min"))},"2m:"),(0,o.Lk)("div",fa,[t[48]||(t[48]=(0,o.Lk)("div",{class:"indicator-letter",title:"CMF - Chaikin Money Flow"},"C",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getCMFSignal("2min"))]),title:`CMF 2min: ${n.getCMFValue("2min")} (${n.getCMFSignal("2min")})`,onClick:t[10]||(t[10]=e=>n.showTooltip(e,"CMF","2min"))},(0,m.v_)(n.getSignalIcon(n.getCMFSignal("2min"))),11,va)]),(0,o.Lk)("div",wa,[t[49]||(t[49]=(0,o.Lk)("div",{class:"indicator-letter",title:"RSI - Relative Strength Index"},"R",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getRSISignal("2min"))]),title:`RSI 2min: ${n.getRSIValue("2min")} (${n.getRSISignal("2min")})`,onClick:t[11]||(t[11]=e=>n.showTooltip(e,"RSI","2min"))},(0,m.v_)(n.getSignalIcon(n.getRSISignal("2min"))),11,ya)]),(0,o.Lk)("div",La,[t[50]||(t[50]=(0,o.Lk)("div",{class:"indicator-letter",title:"MACD - Moving Average Convergence Divergence"},"M",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getMACDSignal("2min"))]),title:`MACD 2min: ${n.getMACDValue("2min")} (${n.getMACDSignal("2min")})`,onClick:t[12]||(t[12]=e=>n.showTooltip(e,"MACD","2min"))},(0,m.v_)(n.getSignalIcon(n.getMACDSignal("2min"))),11,Ca)]),(0,o.Lk)("div",Ta,[t[51]||(t[51]=(0,o.Lk)("div",{class:"indicator-letter",title:"Stochastics - Momentum Oscillator"},"S",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getStochSignal("2min"))]),title:`Stoch 2min: ${n.getStochValue("2min")} (${n.getStochSignal("2min")})`,onClick:t[13]||(t[13]=e=>n.showTooltip(e,"STOCH","2min"))},(0,m.v_)(n.getSignalIcon(n.getStochSignal("2min"))),11,Aa)]),(0,o.Lk)("div",Ea,[t[52]||(t[52]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 9/21 - Exponential Moving Average Crossover"},"9",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA921Signal("2min"))]),title:`EMA 9/21 2min: ${n.getEMA921Value("2min")} (${n.getEMA921Signal("2min")})`,onClick:t[14]||(t[14]=e=>n.showTooltip(e,"EMA921","2min"))},(0,m.v_)(n.getSignalIcon(n.getEMA921Signal("2min"))),11,Ma)]),(0,o.Lk)("div",_a,[t[53]||(t[53]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 21/50 - Exponential Moving Average Crossover"},"2",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA2150Signal("2min"))]),title:`EMA 21/50 2min: ${n.getEMA2150Value("2min")} (${n.getEMA2150Signal("2min")})`,onClick:t[15]||(t[15]=e=>n.showTooltip(e,"EMA2150","2min"))},(0,m.v_)(n.getSignalIcon(n.getEMA2150Signal("2min"))),11,$a)]),(0,o.Lk)("div",Ia,[t[54]||(t[54]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 50/200 - Exponential Moving Average Crossover"},"5",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA50200Signal("2min"))]),title:`EMA 50/200 2min: ${n.getEMA50200Value("2min")} (${n.getEMA50200Signal("2min")})`,onClick:t[16]||(t[16]=e=>n.showTooltip(e,"EMA50200","2min"))},(0,m.v_)(n.getSignalIcon(n.getEMA50200Signal("2min"))),11,Fa)]),(0,o.Lk)("span",{class:"timeframe-label",title:"All 3min Indicators",onClick:t[17]||(t[17]=e=>n.showAllIndicators(e,"3min"))},"3m:"),(0,o.Lk)("div",Pa,[t[55]||(t[55]=(0,o.Lk)("div",{class:"indicator-letter",title:"CMF - Chaikin Money Flow"},"C",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getCMFSignal("3min"))]),title:`CMF 3min: ${n.getCMFValue("3min")} (${n.getCMFSignal("3min")})`,onClick:t[18]||(t[18]=e=>n.showTooltip(e,"CMF","3min"))},(0,m.v_)(n.getSignalIcon(n.getCMFSignal("3min"))),11,Ra)]),(0,o.Lk)("div",Da,[t[56]||(t[56]=(0,o.Lk)("div",{class:"indicator-letter",title:"RSI - Relative Strength Index"},"R",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getRSISignal("3min"))]),title:`RSI 3min: ${n.getRSIValue("3min")} (${n.getRSISignal("3min")})`,onClick:t[19]||(t[19]=e=>n.showTooltip(e,"RSI","3min"))},(0,m.v_)(n.getSignalIcon(n.getRSISignal("3min"))),11,Wa)]),(0,o.Lk)("div",xa,[t[57]||(t[57]=(0,o.Lk)("div",{class:"indicator-letter",title:"MACD - Moving Average Convergence Divergence"},"M",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getMACDSignal("3min"))]),title:`MACD 3min: ${n.getMACDValue("3min")} (${n.getMACDSignal("3min")})`,onClick:t[20]||(t[20]=e=>n.showTooltip(e,"MACD","3min"))},(0,m.v_)(n.getSignalIcon(n.getMACDSignal("3min"))),11,Na)]),(0,o.Lk)("div",Oa,[t[58]||(t[58]=(0,o.Lk)("div",{class:"indicator-letter",title:"Stochastics - Momentum Oscillator"},"S",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getStochSignal("3min"))]),title:`Stoch 3min: ${n.getStochValue("3min")} (${n.getStochSignal("3min")})`,onClick:t[21]||(t[21]=e=>n.showTooltip(e,"STOCH","3min"))},(0,m.v_)(n.getSignalIcon(n.getStochSignal("3min"))),11,Ba)]),(0,o.Lk)("div",Va,[t[59]||(t[59]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 9/21 - Exponential Moving Average Crossover"},"9",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA921Signal("3min"))]),title:`EMA 9/21 3min: ${n.getEMA921Value("3min")} (${n.getEMA921Signal("3min")})`,onClick:t[22]||(t[22]=e=>n.showTooltip(e,"EMA921","3min"))},(0,m.v_)(n.getSignalIcon(n.getEMA921Signal("3min"))),11,Ua)]),(0,o.Lk)("div",Xa,[t[60]||(t[60]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 21/50 - Exponential Moving Average Crossover"},"2",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA2150Signal("3min"))]),title:`EMA 21/50 3min: ${n.getEMA2150Value("3min")} (${n.getEMA2150Signal("3min")})`,onClick:t[23]||(t[23]=e=>n.showTooltip(e,"EMA2150","3min"))},(0,m.v_)(n.getSignalIcon(n.getEMA2150Signal("3min"))),11,Ha)]),(0,o.Lk)("div",za,[t[61]||(t[61]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 50/200 - Exponential Moving Average Crossover"},"5",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA50200Signal("3min"))]),title:`EMA 50/200 3min: ${n.getEMA50200Value("3min")} (${n.getEMA50200Signal("3min")})`,onClick:t[24]||(t[24]=e=>n.showTooltip(e,"EMA50200","3min"))},(0,m.v_)(n.getSignalIcon(n.getEMA50200Signal("3min"))),11,Qa)]),(0,o.Lk)("span",{class:"timeframe-label",title:"All 5min Indicators",onClick:t[25]||(t[25]=e=>n.showAllIndicators(e,"5min"))},"5m:"),(0,o.Lk)("div",qa,[t[62]||(t[62]=(0,o.Lk)("div",{class:"indicator-letter",title:"CMF - Chaikin Money Flow"},"C",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getCMFSignal("5min"))]),title:`CMF 5min: ${n.getCMFValue("5min")} (${n.getCMFSignal("5min")})`,onClick:t[26]||(t[26]=e=>n.showTooltip(e,"CMF","5min"))},(0,m.v_)(n.getSignalIcon(n.getCMFSignal("5min"))),11,ja)]),(0,o.Lk)("div",Ka,[t[63]||(t[63]=(0,o.Lk)("div",{class:"indicator-letter",title:"RSI - Relative Strength Index"},"R",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getRSISignal("5min"))]),title:`RSI 5min: ${n.getRSIValue("5min")} (${n.getRSISignal("5min")})`,onClick:t[27]||(t[27]=e=>n.showTooltip(e,"RSI","5min"))},(0,m.v_)(n.getSignalIcon(n.getRSISignal("5min"))),11,Ga)]),(0,o.Lk)("div",Ya,[t[64]||(t[64]=(0,o.Lk)("div",{class:"indicator-letter",title:"MACD - Moving Average Convergence Divergence"},"M",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getMACDSignal("5min"))]),title:`MACD 5min: ${n.getMACDValue("5min")} (${n.getMACDSignal("5min")})`,onClick:t[28]||(t[28]=e=>n.showTooltip(e,"MACD","5min"))},(0,m.v_)(n.getSignalIcon(n.getMACDSignal("5min"))),11,Ja)]),(0,o.Lk)("div",Za,[t[65]||(t[65]=(0,o.Lk)("div",{class:"indicator-letter",title:"Stochastics - Momentum Oscillator"},"S",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getStochSignal("5min"))]),title:`Stoch 5min: ${n.getStochValue("5min")} (${n.getStochSignal("5min")})`,onClick:t[29]||(t[29]=e=>n.showTooltip(e,"STOCH","5min"))},(0,m.v_)(n.getSignalIcon(n.getStochSignal("5min"))),11,en)]),(0,o.Lk)("div",tn,[t[66]||(t[66]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 9/21 - Exponential Moving Average Crossover"},"9",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA921Signal("5min"))]),title:`EMA 9/21 5min: ${n.getEMA921Value("5min")} (${n.getEMA921Signal("5min")})`,onClick:t[30]||(t[30]=e=>n.showTooltip(e,"EMA921","5min"))},(0,m.v_)(n.getSignalIcon(n.getEMA921Signal("5min"))),11,sn)]),(0,o.Lk)("div",on,[t[67]||(t[67]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 21/50 - Exponential Moving Average Crossover"},"2",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA2150Signal("5min"))]),title:`EMA 21/50 5min: ${n.getEMA2150Value("5min")} (${n.getEMA2150Signal("5min")})`,onClick:t[31]||(t[31]=e=>n.showTooltip(e,"EMA2150","5min"))},(0,m.v_)(n.getSignalIcon(n.getEMA2150Signal("5min"))),11,an)]),(0,o.Lk)("div",nn,[t[68]||(t[68]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 50/200 - Exponential Moving Average Crossover"},"5",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA50200Signal("5min"))]),title:`EMA 50/200 5min: ${n.getEMA50200Value("5min")} (${n.getEMA50200Signal("5min")})`,onClick:t[32]||(t[32]=e=>n.showTooltip(e,"EMA50200","5min"))},(0,m.v_)(n.getSignalIcon(n.getEMA50200Signal("5min"))),11,ln)]),(0,o.Lk)("span",{class:"timeframe-label",title:"All 15min Indicators",onClick:t[33]||(t[33]=e=>n.showAllIndicators(e,"15min"))},"15m:"),(0,o.Lk)("div",rn,[t[69]||(t[69]=(0,o.Lk)("div",{class:"indicator-letter",title:"CMF - Chaikin Money Flow"},"C",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getCMFSignal("15min"))]),title:`CMF 15min: ${n.getCMFValue("15min")} (${n.getCMFSignal("15min")})`,onClick:t[34]||(t[34]=e=>n.showTooltip(e,"CMF","15min"))},(0,m.v_)(n.getSignalIcon(n.getCMFSignal("15min"))),11,cn)]),(0,o.Lk)("div",dn,[t[70]||(t[70]=(0,o.Lk)("div",{class:"indicator-letter",title:"RSI - Relative Strength Index"},"R",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getRSISignal("15min"))]),title:`RSI 15min: ${n.getRSIValue("15min")} (${n.getRSISignal("15min")})`,onClick:t[35]||(t[35]=e=>n.showTooltip(e,"RSI","15min"))},(0,m.v_)(n.getSignalIcon(n.getRSISignal("15min"))),11,un)]),(0,o.Lk)("div",mn,[t[71]||(t[71]=(0,o.Lk)("div",{class:"indicator-letter",title:"MACD - Moving Average Convergence Divergence"},"M",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getMACDSignal("15min"))]),title:`MACD 15min: ${n.getMACDValue("15min")} (${n.getMACDSignal("15min")})`,onClick:t[36]||(t[36]=e=>n.showTooltip(e,"MACD","15min"))},(0,m.v_)(n.getSignalIcon(n.getMACDSignal("15min"))),11,hn)]),(0,o.Lk)("div",pn,[t[72]||(t[72]=(0,o.Lk)("div",{class:"indicator-letter",title:"Stochastics - Momentum Oscillator"},"S",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getStochSignal("15min"))]),title:`Stoch 15min: ${n.getStochValue("15min")} (${n.getStochSignal("15min")})`,onClick:t[37]||(t[37]=e=>n.showTooltip(e,"STOCH","15min"))},(0,m.v_)(n.getSignalIcon(n.getStochSignal("15min"))),11,gn)]),(0,o.Lk)("div",Sn,[t[73]||(t[73]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 9/21 - Exponential Moving Average Crossover"},"9",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA921Signal("15min"))]),title:`EMA 9/21 15min: ${n.getEMA921Value("15min")} (${n.getEMA921Signal("15min")})`,onClick:t[38]||(t[38]=e=>n.showTooltip(e,"EMA921","15min"))},(0,m.v_)(n.getSignalIcon(n.getEMA921Signal("15min"))),11,kn)]),(0,o.Lk)("div",bn,[t[74]||(t[74]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 21/50 - Exponential Moving Average Crossover"},"2",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA2150Signal("15min"))]),title:`EMA 21/50 15min: ${n.getEMA2150Value("15min")} (${n.getEMA2150Signal("15min")})`,onClick:t[39]||(t[39]=e=>n.showTooltip(e,"EMA2150","15min"))},(0,m.v_)(n.getSignalIcon(n.getEMA2150Signal("15min"))),11,fn)]),(0,o.Lk)("div",vn,[t[75]||(t[75]=(0,o.Lk)("div",{class:"indicator-letter",title:"EMA 50/200 - Exponential Moving Average Crossover"},"5",-1)),(0,o.Lk)("span",{class:(0,m.C4)(["indicator-signal",n.getSignalClass(n.getEMA50200Signal("15min"))]),title:`EMA 50/200 15min: ${n.getEMA50200Value("15min")} (${n.getEMA50200Signal("15min")})`,onClick:t[40]||(t[40]=e=>n.showTooltip(e,"EMA50200","15min"))},(0,m.v_)(n.getSignalIcon(n.getEMA50200Signal("15min"))),11,wn)])])])}var Ln={name:"IndicatorsPanel",props:{symbol:{type:String,required:!0},position:{type:String,default:"LONG",validator:e=>["LONG","SHORT","NEUTRAL"].includes(e)}},data(){return{ws:null,indicatorData:{},lastUpdate:null,periods:["1min","2min","3min","5min","15min"],isMounted:!1,showingTooltip:null,tooltipTimeout:null}},computed:{tooltipStyle(){if(!this.showingTooltip)return{};const e=window.innerWidth/2,t=Math.max(20,this.showingTooltip.y-20);return{left:`${e}px`,top:`${t}px`}}},watch:{position(e,t){console.log("IndicatorsPanel position changed from",t,"to",e)}},mounted(){this.isMounted=!0,console.log("IndicatorsPanel mounted with position:",this.position),this.fetchIndicators(),this.connectOHLCWebSocket(),this.handleBeforeUnload=()=>{this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close()},window.addEventListener("beforeunload",this.handleBeforeUnload),this.handleClickOutside=e=>{!this.showingTooltip||e.target.closest(".custom-tooltip")||e.target.closest(".indicator-signal")||e.target.closest(".timeframe-label")||this.hideTooltip()},document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){this.isMounted=!1,this.ws&&this.ws.close(),this.handleBeforeUnload&&window.removeEventListener("beforeunload",this.handleBeforeUnload),this.handleClickOutside&&document.removeEventListener("click",this.handleClickOutside),this.tooltipTimeout&&clearTimeout(this.tooltipTimeout)},methods:{async fetchIndicators(){try{const e=this.periods.map((async e=>{const t=await fetch(`http://${window.location.hostname}:8000/api/indicators/ohlc/${this.symbol}?timeframe=${e}&limit=1`);if(t.ok){const s=await t.json();return{period:e,data:s.indicators}}return{period:e,data:null}})),t=await Promise.all(e);this.indicatorData={},this.indicatorData[this.symbol]={periods:{}},t.forEach((({period:e,data:t})=>{this.indicatorData[this.symbol].periods[e]={indicators:t}})),this.lastUpdate=new Date,console.log("Fetched indicators for",this.symbol,"at",this.lastUpdate.toISOString()),console.log("Raw indicator data:",this.indicatorData),t.forEach((({period:e,data:t})=>{t&&console.log(`${this.symbol} ${e} indicators:`,{timestamp:t.timestamp,lastUpdated:t.last_updated,rsi:t.oscillators?.rsi14?.value,cmf:t.volumeIndicators?.cmf21,macd:t.oscillators?.macd12_26_9_calc,emas:t.emas})}))}catch(e){console.error("Error fetching indicators:",e)}},connectOHLCWebSocket(){const e=`ws://${window.location.hostname}:8000/ws/ohlc?symbol=${this.symbol}`;this.ws=new WebSocket(e),this.ws.onopen=()=>{console.log("OHLC WebSocket connected for indicators")},this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);if("OHLC_UPDATE"===t.type&&t.indicator){this.indicatorData[this.symbol]||(this.indicatorData[this.symbol]={periods:{}});const e=t.bar?.timeframe||"1min";this.indicatorData[this.symbol].periods[e]||(this.indicatorData[this.symbol].periods[e]={}),this.indicatorData[this.symbol].periods[e].indicators=t.indicator,this.lastUpdate=new Date}}catch(t){console.error("Error processing OHLC message:",t)}},this.ws.onerror=e=>{console.error("OHLC WebSocket error:",e)},this.ws.onclose=()=>{this.isMounted&&setTimeout((()=>this.connectOHLCWebSocket()),5e3)}},getCMFValue(e){const t=this.getIndicatorData(e);return t?.volumeIndicators?.cmf21?parseFloat(t.volumeIndicators.cmf21).toFixed(3):"--"},getCMFSignal(e){const t=this.getIndicatorData(e);if(!t?.volumeIndicators?.cmf21)return"MISSING";const s=parseFloat(t.volumeIndicators.cmf21);return s>.1?"STRONG BUY":s>.05?"BUY":s<-.1?"STRONG SELL":s<-.05?"SELL":"NEUTRAL"},getRSIValue(e){const t=this.getIndicatorData(e);return t?.oscillators?.rsi14?.value?parseFloat(t.oscillators.rsi14.value).toFixed(1):"--"},getRSISignal(e){const t=this.getIndicatorData(e);if(!t?.oscillators?.rsi14?.value)return"MISSING";const s=parseFloat(t.oscillators.rsi14.value);return s>80?"SELL":s>70?"WEAK SELL":s<20?"BUY":s<30?"WEAK BUY":"NEUTRAL"},getMACDValue(e){const t=this.getIndicatorData(e);if(!t?.oscillators?.macd12_26_9_calc?.macd||!t?.oscillators?.macd12_26_9_calc?.signal)return"--";const s=parseFloat(t.oscillators.macd12_26_9_calc.macd),i=parseFloat(t.oscillators.macd12_26_9_calc.signal),o=s-i;return o.toFixed(3)},getMACDSignal(e){const t=this.getIndicatorData(e);if(!t?.oscillators?.macd12_26_9_calc?.macd||!t?.oscillators?.macd12_26_9_calc?.signal)return"MISSING";const s=parseFloat(t.oscillators.macd12_26_9_calc.macd),i=parseFloat(t.oscillators.macd12_26_9_calc.signal),o=s-i;return s>i&&o>0?"BUY":s<i&&o<0?"SELL":"NEUTRAL"},getStochValue(e){const t=this.getIndicatorData(e);if(!t?.oscillators?.stochastic14_3?.k||!t?.oscillators?.stochastic14_3?.d)return"--";const s=parseFloat(t.oscillators.stochastic14_3.k),i=parseFloat(t.oscillators.stochastic14_3.d);return`${s.toFixed(1)}/${i.toFixed(1)}`},getStochSignal(e){const t=this.getIndicatorData(e);if(!t?.oscillators?.stochastic14_3?.k||!t?.oscillators?.stochastic14_3?.d)return"MISSING";const s=parseFloat(t.oscillators.stochastic14_3.k),i=parseFloat(t.oscillators.stochastic14_3.d);return s>80&&i>80?"SELL":s<20&&i<20?"BUY":s>i&&s<80?"WEAK BUY":s<i&&s>20?"WEAK SELL":"NEUTRAL"},getEMA921Value(e){const t=this.getIndicatorData(e);if(!t?.emas?.ema9||!t?.emas?.ema21)return"--";const s=parseFloat(t.emas.ema9),i=parseFloat(t.emas.ema21);return`${s.toFixed(2)}/${i.toFixed(2)}`},getEMA921Signal(e){const t=this.getIndicatorData(e);if(!t?.emas?.ema9||!t?.emas?.ema21)return"MISSING";const s=parseFloat(t.emas.ema9),i=parseFloat(t.emas.ema21);return s>i?"BUY":"SELL"},getEMA2150Value(e){const t=this.getIndicatorData(e);if(!t?.emas?.ema21||!t?.emas?.ema50)return"--";const s=parseFloat(t.emas.ema21),i=parseFloat(t.emas.ema50);return`${s.toFixed(2)}/${i.toFixed(2)}`},getEMA2150Signal(e){const t=this.getIndicatorData(e);if(!t?.emas?.ema21||!t?.emas?.ema50)return"MISSING";const s=parseFloat(t.emas.ema21),i=parseFloat(t.emas.ema50);return s>i?"BUY":"SELL"},getEMA50200Value(e){const t=this.getIndicatorData(e);if(!t?.emas?.ema50||!t?.emas?.ema200)return"--";const s=parseFloat(t.emas.ema50),i=parseFloat(t.emas.ema200);return`${s.toFixed(2)}/${i.toFixed(2)}`},getEMA50200Signal(e){const t=this.getIndicatorData(e);if(!t?.emas?.ema50||!t?.emas?.ema200)return"MISSING";const s=parseFloat(t.emas.ema50),i=parseFloat(t.emas.ema200);return s>i?"BUY":"SELL"},getIndicatorData(e){const t=this.indicatorData[this.symbol]?.periods?.[e]?.indicators;return t},getSignalClass(e){const t=this.getPositionAwareSignal(e);if("SHORT"===this.position)switch(t){case"STRONG BUY":return"short-entry";case"BUY":case"WEAK BUY":return"short-entry";case"STRONG SELL":return"short-exit";case"SELL":case"WEAK SELL":return"short-exit";case"NEUTRAL":return"neutral";case"MISSING":default:return"missing"}else switch(t){case"STRONG BUY":return"strong-buy";case"BUY":case"WEAK BUY":return"buy";case"STRONG SELL":return"strong-sell";case"SELL":case"WEAK SELL":return"sell";case"NEUTRAL":return"neutral";case"MISSING":default:return"missing"}},getSignalIcon(e){const t=this.getPositionAwareSignal(e);if("SHORT"===this.position)switch(t){case"STRONG BUY":case"BUY":case"WEAK BUY":return"⬇";case"STRONG SELL":case"SELL":case"WEAK SELL":return"✕";case"NEUTRAL":return"=";case"MISSING":default:return""}else switch(t){case"STRONG BUY":case"BUY":case"WEAK BUY":return"⬆";case"STRONG SELL":case"SELL":case"WEAK SELL":return"✕";case"NEUTRAL":return"=";case"MISSING":default:return""}},getOverallSignal(e){const t=[this.getCMFSignal(e),this.getRSISignal(e),this.getMACDSignal(e),this.getEMA921Signal(e),this.getEMA2150Signal(e)],s=t.filter((e=>e.includes("BUY"))).length,i=t.filter((e=>e.includes("SELL"))).length;return s>=4?"STRONG BUY":s>=3?"BUY":i>=4?"STRONG SELL":i>=3?"SELL":"NEUTRAL"},formatTime(e){return e?e.toLocaleTimeString():"--"},getPositionAwareSignal(e){if("SHORT"===this.position)switch(e){case"STRONG BUY":return"STRONG SELL";case"BUY":return"SELL";case"WEAK BUY":return"WEAK SELL";case"STRONG SELL":return"STRONG BUY";case"SELL":return"BUY";case"WEAK SELL":return"WEAK BUY";case"NEUTRAL":return"NEUTRAL";default:return e}return e},getColoredSignal(e){const t=this.getPositionAwareSignal(e),s="SHORT"===this.position?this.getShortDisplayText(t):t;switch(t){case"STRONG BUY":case"BUY":case"WEAK BUY":return`<span style="color: #28a745; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">✓ ${s}</span>`;case"STRONG SELL":case"SELL":case"WEAK SELL":return`<span style="color: #ff4757; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">✕ ${s}</span>`;case"NEUTRAL":return`<span style="color: #ffc107; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">= ${s}</span>`;case"MISSING":default:return'<span style="color: #6c757d; font-weight: bold;">⬜ NO DATA</span>'}},getShortDisplayText(e){switch(e){case"STRONG BUY":return"STRONG ENTRY";case"BUY":return"ENTRY";case"WEAK BUY":return"WEAK ENTRY";case"STRONG SELL":return"STRONG EXIT";case"SELL":return"EXIT";case"WEAK SELL":return"WEAK EXIT";default:return e}},showTooltip(e,t,s){let i;this.tooltipTimeout&&clearTimeout(this.tooltipTimeout);const o=this.getIndicatorData(s);switch(t){case"CMF":i=`<div style="text-align: center;"><strong style="color: #64b5f6; font-size: 1.3rem;">CMF-21 ${s} (${this.position}):</strong> <span style="color: #fff; font-weight: bold;">${this.getCMFValue(s)}</span> | ${this.getColoredSignal(this.getCMFSignal(s))} | Raw: <span style="color: #b0bec5;">${o?.volumeIndicators?.cmf21||"N/A"}</span></div>`;break;case"RSI":i=`<div style="text-align: center;"><strong style="color: #64b5f6; font-size: 1.3rem;">RSI-14 ${s} (${this.position}):</strong> <span style="color: #fff; font-weight: bold;">${this.getRSIValue(s)}</span> | ${this.getColoredSignal(this.getRSISignal(s))} | Raw: <span style="color: #b0bec5;">${o?.oscillators?.rsi14?.value||"N/A"}</span></div>`;break;case"MACD":{const e=o?.oscillators?.macd12_26_9_calc;i=`<div style="text-align: center;"><strong style="color: #64b5f6; font-size: 1.3rem;">MACD(12,26,9) ${s} (${this.position}):</strong> Line: <span style="color: #fff; font-weight: bold;">${e?.macd?parseFloat(e.macd).toFixed(3):"N/A"}</span> | Signal: <span style="color: #fff; font-weight: bold;">${e?.signal?parseFloat(e.signal).toFixed(3):"N/A"}</span> | Histogram: <span style="color: #fff; font-weight: bold;">${this.getMACDValue(s)}</span> | ${this.getColoredSignal(this.getMACDSignal(s))}</div>`;break}case"STOCH":{const e=o?.oscillators?.stochastic14_3;i=`<div style="text-align: center;"><strong style="color: #64b5f6; font-size: 1.3rem;">Stochastic(14,3) ${s} (${this.position}):</strong> %K: <span style="color: #fff; font-weight: bold;">${e?.k?parseFloat(e.k).toFixed(1):"N/A"}</span> | %D: <span style="color: #fff; font-weight: bold;">${e?.d?parseFloat(e.d).toFixed(1):"N/A"}</span> | ${this.getColoredSignal(this.getStochSignal(s))}</div>`;break}case"EMA921":{const e=o?.emas?.ema9?parseFloat(o.emas.ema9):null,t=o?.emas?.ema21?parseFloat(o.emas.ema21):null,a=e&&t?e>t?'<span style="color: #28a745; font-weight: bold;">✓ YES</span>':'<span style="color: #ff4757; font-weight: bold;">✕ NO</span>':'<span style="color: #6c757d;">N/A</span>';i=`<div style="text-align: center;"><strong style="color: #64b5f6; font-size: 1.3rem;">EMA 9/21 ${s} (${this.position}):</strong> EMA9: <span style="color: #fff; font-weight: bold;">${e?e.toFixed(2):"N/A"}</span> | EMA21: <span style="color: #fff; font-weight: bold;">${t?t.toFixed(2):"N/A"}</span> | 9>21: ${a} | ${this.getColoredSignal(this.getEMA921Signal(s))}</div>`;break}case"EMA2150":{const e=o?.emas?.ema21?parseFloat(o.emas.ema21):null,t=o?.emas?.ema50?parseFloat(o.emas.ema50):null,a=e&&t?e>t?'<span style="color: #28a745; font-weight: bold;">✓ YES</span>':'<span style="color: #ff4757; font-weight: bold;">✕ NO</span>':'<span style="color: #6c757d;">N/A</span>';i=`<div style="text-align: center;"><strong style="color: #64b5f6; font-size: 1.3rem;">EMA 21/50 ${s} (${this.position}):</strong> EMA21: <span style="color: #fff; font-weight: bold;">${e?e.toFixed(2):"N/A"}</span> | EMA50: <span style="color: #fff; font-weight: bold;">${t?t.toFixed(2):"N/A"}</span> | 21>50: ${a} | ${this.getColoredSignal(this.getEMA2150Signal(s))}</div>`;break}case"EMA50200":{const e=o?.emas?.ema50?parseFloat(o.emas.ema50):null,t=o?.emas?.ema200?parseFloat(o.emas.ema200):null,a=e&&t?e>t?'<span style="color: #28a745; font-weight: bold;">✓ YES</span>':'<span style="color: #ff4757; font-weight: bold;">✕ NO</span>':'<span style="color: #6c757d;">N/A</span>';i=`<div style="text-align: center;"><strong style="color: #64b5f6; font-size: 1.3rem;">EMA 50/200 ${s} (${this.position}):</strong> EMA50: <span style="color: #fff; font-weight: bold;">${e?e.toFixed(2):"N/A"}</span> | EMA200: <span style="color: #fff; font-weight: bold;">${t?t.toFixed(2):"N/A"}</span> | 50>200: ${a} | ${this.getColoredSignal(this.getEMA50200Signal(s))}</div>`;break}default:i="No data"}const a=e.target.getBoundingClientRect(),n=a.left+a.width/2,l=a.top-10;this.showingTooltip={content:i,x:n,y:l},this.tooltipTimeout=setTimeout((()=>{this.showingTooltip=null}),5e3)},showAllIndicators(e,t){const s=this.getIndicatorData(t),i=s?.oscillators?.macd12_26_9_calc,o=s?.oscillators?.stochastic14_3,a=s?.emas,n=`\n        <div class="comprehensive-tooltip">\n          <h4 style="color: #64b5f6; font-size: 1.4rem; text-align: center; margin-bottom: 20px;">${t.toUpperCase()} INDICATORS (${this.position})</h4>\n          \n          <div class="indicator-section">\n            <strong style="color: #64b5f6;">CMF-21:</strong> <span style="color: #fff; font-weight: bold;">${this.getCMFValue(t)}</span> | ${this.getColoredSignal(this.getCMFSignal(t))}\n          </div>\n          \n          <div class="indicator-section">\n            <strong style="color: #64b5f6;">RSI-14:</strong> <span style="color: #fff; font-weight: bold;">${this.getRSIValue(t)}</span> | ${this.getColoredSignal(this.getRSISignal(t))}\n          </div>\n          \n          <div class="indicator-section">\n            <strong style="color: #64b5f6;">MACD(12,26,9):</strong> Line: <span style="color: #fff; font-weight: bold;">${i?.macd?parseFloat(i.macd).toFixed(3):"N/A"}</span> | Signal: <span style="color: #fff; font-weight: bold;">${i?.signal?parseFloat(i.signal).toFixed(3):"N/A"}</span> | Histogram: <span style="color: #fff; font-weight: bold;">${this.getMACDValue(t)}</span> | ${this.getColoredSignal(this.getMACDSignal(t))}\n          </div>\n          \n          <div class="indicator-section">\n            <strong style="color: #64b5f6;">Stochastic(14,3):</strong> %K: <span style="color: #fff; font-weight: bold;">${o?.k?parseFloat(o.k).toFixed(1):"N/A"}</span> | %D: <span style="color: #fff; font-weight: bold;">${o?.d?parseFloat(o.d).toFixed(1):"N/A"}</span> | ${this.getColoredSignal(this.getStochSignal(t))}\n          </div>\n          \n          <div class="indicator-section">\n            <strong style="color: #64b5f6;">EMA 9/21:</strong> <span style="color: #fff; font-weight: bold;">${a?.ema9?parseFloat(a.ema9).toFixed(2):"N/A"}/${a?.ema21?parseFloat(a.ema21).toFixed(2):"N/A"}</span> | 9>21: ${a?.ema9&&a?.ema21?parseFloat(a.ema9)>parseFloat(a.ema21)?'<span style="color: #28a745;">✓ YES</span>':'<span style="color: #ff4757;">✕ NO</span>':'<span style="color: #6c757d;">N/A</span>'} | ${this.getColoredSignal(this.getEMA921Signal(t))}\n          </div>\n          \n          <div class="indicator-section">\n            <strong style="color: #64b5f6;">EMA 21/50:</strong> <span style="color: #fff; font-weight: bold;">${a?.ema21?parseFloat(a.ema21).toFixed(2):"N/A"}/${a?.ema50?parseFloat(a.ema50).toFixed(2):"N/A"}</span> | 21>50: ${a?.ema21&&a?.ema50?parseFloat(a.ema21)>parseFloat(a.ema50)?'<span style="color: #28a745;">✓ YES</span>':'<span style="color: #ff4757;">✕ NO</span>':'<span style="color: #6c757d;">N/A</span>'} | ${this.getColoredSignal(this.getEMA2150Signal(t))}\n          </div>\n          \n          <div class="indicator-section">\n            <strong style="color: #64b5f6;">EMA 50/200:</strong> <span style="color: #fff; font-weight: bold;">${a?.ema50?parseFloat(a.ema50).toFixed(2):"N/A"}/${a?.ema200?parseFloat(a.ema200).toFixed(2):"N/A"}</span> | 50>200: ${a?.ema50&&a?.ema200?parseFloat(a.ema50)>parseFloat(a.ema200)?'<span style="color: #28a745;">✓ YES</span>':'<span style="color: #ff4757;">✕ NO</span>':'<span style="color: #6c757d;">N/A</span>'} | ${this.getColoredSignal(this.getEMA50200Signal(t))}\n          </div>\n        </div>\n      `,l=e.target.getBoundingClientRect(),r=l.left+l.width/2,c=l.top-10;this.showingTooltip={content:n,x:r,y:c},this.tooltipTimeout=setTimeout((()=>{this.showingTooltip=null}),1e4)},hideTooltip(){this.showingTooltip=null,this.tooltipTimeout&&clearTimeout(this.tooltipTimeout)}}};const Cn=(0,r.A)(Ln,[["render",yn],["__scopeId","data-v-cb099ab2"]]);var Tn=Cn,An={name:"SingleTicker",components:{TickerInfo:ws,QuoteDisplay:Es,Tape:Bs,Level2:ii,NewsPanel:ui,PositionsPanel:Vi,OrdersPanel:So,OrderEntryPanel:ta,IndicatorsPanel:Tn},data(){return{tickerInfo:{},latestQuote:{},trades:[],isQuoteLive:!1,ws:null,maxTrades:40,symbol:this.$route.params.symbol,timeZone:"America/New_York",isMounted:!1,selectedPrice:null,selectedSide:"Buy",currentPosition:"LONG",timer:null,leftWidth:600,dragging:!1,containerLeft:0,showLeftPane:!1,persistentSignal:null,signalHidden:!1,signalTimeUpdateInterval:null,currentTimeForSignal:Date.now()}},mounted(){this.isMounted=!0,this.initWebSocket(),this.fetchTickerInfo(),this.$nextTick((()=>{const e=this.$refs.root.getBoundingClientRect();this.containerLeft=e.left})),window.addEventListener("mousemove",this.onDrag),window.addEventListener("mouseup",this.stopDrag),this.handleBeforeUnload=()=>{this.ws&&this.ws.readyState===WebSocket.OPEN&&(console.log("Closing trades_quotes WebSocket on page unload"),this.ws.close())},window.addEventListener("beforeunload",this.handleBeforeUnload),this.loadSignalForCurrentSymbol(),this.signalTimeUpdateInterval=setInterval((()=>{this.currentTimeForSignal=Date.now()}),6e4),window.loadSignal=e=>{console.log("window.loadSignal called with:",e);let t=e.timestamp||e.generated_at||e.event_time||e.signal_time||e.receivedAt;if(console.log("Original timestamp:",t,"Type:",typeof t),t){if(Array.isArray(t)){const[e,s,i,o,a]=t;t=new Date(e,s-1,i,o,a).getTime()}else"string"===typeof t&&t.includes("-")?t=new Date(t).getTime():("string"===typeof t&&(t=parseFloat(t)),t>1e16?t/=1e6:t>1e13?t/=1e3:t<1e10&&(t*=1e3));console.log("Converted timestamp:",t,"Date:",new Date(t))}const s=this.getSignalDate(t||Date.now()),i=new Date;if(i.setHours(0,0,0,0),s<i)return void console.log("Ignoring old signal from",s);const o={...e,receivedAt:t||Date.now()};this.persistentSignal=o;const a=new URLSearchParams(window.location.search).get("windowNumber")||"default",n=e.ticker?e.ticker.toUpperCase():this.symbol.toUpperCase(),l=`signal_w${a}_${n}`;localStorage.setItem(l,JSON.stringify(o)),console.log("Signal saved to localStorage:",l),this.$refs.orderEntryPanel?this.$refs.orderEntryPanel.loadSignal(e):(console.warn("OrderEntryPanel ref not available yet, retrying..."),setTimeout((()=>{this.$refs.orderEntryPanel&&this.$refs.orderEntryPanel.loadSignal(e)}),500))},this.$nextTick((()=>{setTimeout((()=>{const e=sessionStorage.getItem("pendingSignal");if(e)try{const t=JSON.parse(e);console.log("Found pending signal in sessionStorage:",t),sessionStorage.removeItem("pendingSignal"),this.$refs.orderEntryPanel&&this.$refs.orderEntryPanel.loadSignal(t)}catch(t){console.error("Error parsing pending signal:",t),sessionStorage.removeItem("pendingSignal")}}),500)}))},beforeUnmount(){if(this.isMounted=!1,this.ws)try{this.ws.close()}catch{}this.timer&&clearTimeout(this.timer),window.removeEventListener("mousemove",this.onDrag),window.removeEventListener("mouseup",this.stopDrag),this.handleBeforeUnload&&window.removeEventListener("beforeunload",this.handleBeforeUnload),this.signalTimeUpdateInterval&&(clearInterval(this.signalTimeUpdateInterval),this.signalTimeUpdateInterval=null)},watch:{latestQuote(e){e&&this.tickerInfo&&this.tickerInfo.float&&!this.tickerInfo.market_cap&&e.Last&&(this.tickerInfo={...this.tickerInfo,market_cap:Number(this.tickerInfo.float)*Number(e.Last)})},symbol(e){console.log("Symbol changed to:",e),this.signalHidden=!1,this.loadSignalForCurrentSymbol()}},methods:{startDrag(){this.dragging=!0},onDrag(e){if(!this.dragging)return;const t=200,s=window.innerWidth-200,i=e.clientX-this.containerLeft;this.leftWidth=Math.max(t,Math.min(i,s))},stopDrag(){this.dragging=!1},handleViewModeChanged(e){console.log("View mode changed to:",e),this.currentPosition=e},initWebSocket(){const e=`ws://${window.location.hostname}:8000/ws/trades_quotes?symbol=${this.symbol}`;this.ws=new WebSocket(e),this.ws.onopen=()=>console.log("WebSocket connected for trades_quotes:",this.symbol),this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);"Q"===t.rawEventType?(this.latestQuote={...t,receivedTimestamp:Date.now()},null!=this.latestQuote.bidPrice&&null!=this.latestQuote.askPrice&&(this.isQuoteLive=!0)):"T"===t.rawEventType&&(this.trades.push(t),this.trades.length>this.maxTrades&&(this.trades=this.trades.slice(-this.maxTrades)))}catch(t){console.error("Error processing message",e.data,t)}},this.ws.onerror=e=>console.error("WebSocket error:",e),this.ws.onclose=e=>{console.log("WebSocket closed:",e.code,e.reason),this.isMounted&&(this.timer=setTimeout((()=>this.initWebSocket()),5e3))}},async fetchTickerInfo(){const e="p78rx6L5WW0JQ37zj4Y8J2BypjbLdd0r",t=`https://api.polygon.io/v3/reference/tickers/${this.symbol}?apiKey=${e}`,s=`https://api.polygon.io/stocks/v1/short-interest?ticker=${this.symbol}&sort=settlement_date.desc&limit=10&apiKey=${e}`;let i={ticker:this.symbol,name:null,market_cap:null,float:null,shortInterest:null,daysToCover:null};try{const e=await Promise.allSettled([fetch(t),fetch(s)]),[o,a]=e;if("fulfilled"===o.status&&o.value.ok){const e=await o.value.json();e&&e.results?(i.name=e.results.name,e.results.market_cap&&(i.market_cap=Number(e.results.market_cap)),i.float=e.results.weighted_shares_outstanding):console.warn(`No results in overview data for ${this.symbol}`)}else"fulfilled"!==o.status||o.value.ok?"rejected"===o.status&&console.error(`Ticker overview fetch rejected for ${this.symbol}:`,o.reason):console.error(`Ticker overview fetch failed for ${this.symbol}: ${o.value.status} ${o.value.statusText}`);if("fulfilled"===a.status&&a.value.ok){const e=await a.value.json(),t=e.results||[];if(t.length>0){const e=t[0];console.log("Latest short interest record:",e),e?(i.shortInterest=e.short_interest,i.daysToCover=e.days_to_cover):console.warn(`No latest short interest record found for ${this.symbol} from results.`)}else console.warn(`No short interest results array for ${this.symbol}`)}else"fulfilled"!==a.status||a.value.ok?"rejected"===a.status&&console.error(`Short interest fetch rejected for ${this.symbol}:`,a.reason):console.warn(`Short interest fetch failed for ${this.symbol}: ${a.value.status} ${a.value.statusText}. Data will be unavailable.`);this.isMounted&&(this.tickerInfo=i)}catch(o){console.error("Generic error in fetchTickerInfo processing:",o),this.isMounted&&(this.tickerInfo=i)}},handlePriceSelected({price:e,side:t}){this.selectedPrice=e,this.selectedSide=t},loadSignalForCurrentSymbol(){const e=new URLSearchParams(window.location.search).get("windowNumber")||"default",t=this.symbol.toUpperCase(),s=`signal_w${e}_${t}`,i=localStorage.getItem(s);if(i)try{const e=JSON.parse(i),o=this.getSignalDate(e.receivedAt),a=new Date;a.setHours(0,0,0,0),o<a?(console.log("Removing old signal for",t,"from",o),localStorage.removeItem(s),this.persistentSignal=null):(this.persistentSignal=e,console.log("Loaded signal for",t,":",this.persistentSignal))}catch(o){console.error("Error parsing stored signal:",o),localStorage.removeItem(s)}else this.persistentSignal=null,console.log("No signal found for",t)},getSignalDate(e){if(!e)return new Date(0);let t=e;if(Array.isArray(t)){const[e,s,i]=t,o=new Date(e,s-1,i);return o.setHours(0,0,0,0),o}if("string"===typeof t&&t.includes("-")){const e=new Date(t);return e.setHours(0,0,0,0),e}{"string"===typeof t&&(t=parseFloat(t)),t>1e16?t/=1e6:t>1e13?t/=1e3:t<1e10&&(t*=1e3);const e=new Date(t);return e.setHours(0,0,0,0),e}},dismissSignal(){const e=new URLSearchParams(window.location.search).get("windowNumber")||"default",t=this.symbol.toUpperCase(),s=`signal_w${e}_${t}`;localStorage.removeItem(s),this.persistentSignal=null,this.signalHidden=!1,console.log("Dismissed signal for",t)},hideSignal(){this.signalHidden=!0,console.log("Signal hidden")},showSignal(){this.signalHidden=!1,console.log("Signal shown")},fillOrderEntry(){this.persistentSignal&&this.$refs.orderEntryPanel?(this.$refs.orderEntryPanel.loadSignal(this.persistentSignal),console.log("Filled order entry with signal:",this.persistentSignal)):console.warn("Cannot fill order entry - signal or panel not available")},getDirectionColor(e){const t=(e||"").toUpperCase();return"LONG"===t||"BUY"===t?"#28a745":"#dc3545"},getSignalBoxClass(e){const t=(e||"").toUpperCase();return"LONG"===t||"BUY"===t?"signal-long":"signal-short"},formatPrice(e){return null===e||void 0===e?"-":parseFloat(e).toFixed(2)},formatVolume(e){return e?`${(e/1e3).toFixed(1)}K`:"-"},formatSignalTime(e){if(!e)return"-";let t=e;if(console.log("[formatSignalTime] Input timestamp:",e,"Type:",typeof e),Array.isArray(t)){const[e,s,i,o,a]=t;t=new Date(e,s-1,i,o,a).getTime(),console.log("[formatSignalTime] Array format converted to:",t,new Date(t).toLocaleString())}else if("string"===typeof t&&t.includes("-"))t=new Date(t).getTime(),console.log("[formatSignalTime] ISO string converted to:",t,new Date(t).toLocaleString());else{"string"===typeof t&&(t=parseFloat(t));const e=t;t>1e16?(t/=1e6,console.log("[formatSignalTime] Nanoseconds converted:",e,"->",t)):t>1e13?(t/=1e3,console.log("[formatSignalTime] Microseconds converted:",e,"->",t)):t<1e10&&(t*=1e3,console.log("[formatSignalTime] Seconds converted:",e,"->",t)),console.log("[formatSignalTime] Numeric timestamp:",t,new Date(t).toLocaleString())}const s=new Date(t),i=String(s.getHours()).padStart(2,"0"),o=String(s.getMinutes()).padStart(2,"0"),a=String(s.getSeconds()).padStart(2,"0");return console.log("[formatSignalTime] Formatted result:",`${i}:${o}:${a}`,"from date:",s.toLocaleString()),`${i}:${o}:${a}`},getMinutesElapsed(e){if(!e)return 0;let t=e;if(console.log("[getMinutesElapsed] Input timestamp:",e,"Type:",typeof e),Array.isArray(t)){const[e,s,i,o,a]=t;t=new Date(e,s-1,i,o,a).getTime(),console.log("[getMinutesElapsed] Array format converted to:",t,new Date(t).toLocaleString())}else if("string"===typeof t&&t.includes("-"))t=new Date(t).getTime(),console.log("[getMinutesElapsed] ISO string converted to:",t,new Date(t).toLocaleString());else{"string"===typeof t&&(t=parseFloat(t));const e=t;t>1e16?(t/=1e6,console.log("[getMinutesElapsed] Nanoseconds converted:",e,"->",t)):t>1e13?(t/=1e3,console.log("[getMinutesElapsed] Microseconds converted:",e,"->",t)):t<1e10&&(t*=1e3,console.log("[getMinutesElapsed] Seconds converted:",e,"->",t)),console.log("[getMinutesElapsed] Numeric timestamp:",t,new Date(t).toLocaleString())}console.log("[getMinutesElapsed] Current time:",this.currentTimeForSignal,new Date(this.currentTimeForSignal).toLocaleString()),console.log("[getMinutesElapsed] Signal time:",t,new Date(t).toLocaleString());const s=this.currentTimeForSignal-t,i=Math.floor(s/6e4);return console.log("[getMinutesElapsed] Elapsed ms:",s,"-> Minutes:",i),i},getTimeBackgroundColor(e){const t=this.getMinutesElapsed(e);return t<=5?"#90EE90":t<=10?"#FFFF99":"#FFB6C6"}}};const En=(0,r.A)(An,[["render",ds],["__scopeId","data-v-a56dd61a"]]);var Mn=En;const _n={class:"signals-panel"},$n={class:"header-container"},In={class:"alert-sound-toggle"},Fn={class:"windows-display"},Pn={class:"window-pair"},Rn={class:"window-pair"},Dn={class:"window-pair"},Wn={class:"nav-links"},xn={class:"date-selector"},Nn={key:0,class:"error"},On={key:1,class:"no-data"},Bn={key:2,class:"table-container"},Vn={class:"strategy"},Un={class:"ticker"},Xn={class:"time"},Hn={class:"direction"},zn={class:"price"},Qn={class:"volume"},qn=["innerHTML"],jn={class:"retraced"},Kn={class:"window-buttons"},Gn={class:"button-pair"},Yn=["onClick"],Jn=["onClick"],Zn={class:"button-pair"},el=["onClick"],tl=["onClick"],sl={class:"button-pair"},il=["onClick"],ol=["onClick"],al={class:"connection-status"};function nl(e,t,s,a,n,l){const r=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",_n,[(0,o.Lk)("div",$n,[t[19]||(t[19]=(0,o.Lk)("h1",null,"Trading Signals",-1)),(0,o.Lk)("div",In,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox",id:"alert-sound","onUpdate:modelValue":t[0]||(t[0]=e=>n.alertSoundEnabled=e),onChange:t[1]||(t[1]=(...e)=>l.saveAlertSoundPreference&&l.saveAlertSoundPreference(...e))},null,544),[[i.lH,n.alertSoundEnabled]]),t[16]||(t[16]=(0,o.Lk)("label",{for:"alert-sound"},"Alert sound",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedChime=e),onChange:t[3]||(t[3]=(...e)=>l.saveChimePreference&&l.saveChimePreference(...e)),class:"chime-select"},t[15]||(t[15]=[(0,o.Fv)('<option value="beep" data-v-b2338f5e>Beep</option><option value="ding" data-v-b2338f5e>Ding</option><option value="chime" data-v-b2338f5e>Chime</option><option value="bell" data-v-b2338f5e>Bell</option><option value="notification" data-v-b2338f5e>Notification</option><option value="sonar" data-v-b2338f5e>Sonar</option><option value="ascending" data-v-b2338f5e>Ascending</option><option value="descending" data-v-b2338f5e>Descending</option><option value="double-beep" data-v-b2338f5e>Double Beep</option><option value="triple-tone" data-v-b2338f5e>Triple Tone</option><option value="urgent" data-v-b2338f5e>Urgent</option><option value="subtle" data-v-b2338f5e>Subtle</option>',12)]),544),[[i.u1,n.selectedChime]]),(0,o.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>l.playAlertSound&&l.playAlertSound(...e)),class:"test-sound-btn",title:"Test alert sound"},"🔊")]),(0,o.Lk)("div",Fn,[(0,o.Lk)("div",Pn,[(0,o.Lk)("div",{class:"window-box",onClick:t[5]||(t[5]=e=>l.focusWindow(1))},(0,m.v_)(n.windowTickers[1]||"-"),1),(0,o.Lk)("div",{class:"window-box",onClick:t[6]||(t[6]=e=>l.focusWindow(2))},(0,m.v_)(n.windowTickers[2]||"-"),1)]),(0,o.Lk)("div",Rn,[(0,o.Lk)("div",{class:"window-box",onClick:t[7]||(t[7]=e=>l.focusWindow(3))},(0,m.v_)(n.windowTickers[3]||"-"),1),(0,o.Lk)("div",{class:"window-box",onClick:t[8]||(t[8]=e=>l.focusWindow(4))},(0,m.v_)(n.windowTickers[4]||"-"),1)]),(0,o.Lk)("div",Dn,[(0,o.Lk)("div",{class:"window-box",onClick:t[9]||(t[9]=e=>l.focusWindow(5))},(0,m.v_)(n.windowTickers[5]||"-"),1),(0,o.Lk)("div",{class:"window-box",onClick:t[10]||(t[10]=e=>l.focusWindow(6))},(0,m.v_)(n.windowTickers[6]||"-"),1)])]),(0,o.Lk)("button",{type:"button",onClick:t[11]||(t[11]=(...e)=>l.bringAllWindowsForward&&l.bringAllWindowsForward(...e)),class:"bring-forward-btn",title:"Bring all windows to front"}," 🪟 Bring All Forward "),(0,o.Lk)("div",Wn,[(0,o.bF)(r,{to:"/",class:"nav-link"},{default:(0,o.k6)((()=>t[17]||(t[17]=[(0,o.eW)("← WatchList")]))),_:1})]),(0,o.Lk)("div",xn,[t[18]||(t[18]=(0,o.Lk)("label",{for:"signal-date"},"Date:",-1)),(0,o.bo)((0,o.Lk)("input",{type:"date",id:"signal-date","onUpdate:modelValue":t[12]||(t[12]=e=>n.selectedDate=e),onChange:t[13]||(t[13]=(...e)=>l.fetchSignals&&l.fetchSignals(...e)),class:"date-input"},null,544),[[i.Jo,n.selectedDate]]),(0,o.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>l.refreshSignals&&l.refreshSignals(...e)),class:"refresh-btn",title:"Refresh signals"}," 🔄 ")])]),n.error?((0,o.uX)(),(0,o.CE)("div",Nn,(0,m.v_)(n.error),1)):0===n.signals.length?((0,o.uX)(),(0,o.CE)("div",On," No signals found for "+(0,m.v_)(n.selectedDate),1)):((0,o.uX)(),(0,o.CE)("div",Bn,[(0,o.Lk)("table",null,[t[20]||(t[20]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Strategy"),(0,o.Lk)("th",null,"Ticker"),(0,o.Lk)("th",null,"Time"),(0,o.Lk)("th",null,"Dir"),(0,o.Lk)("th",{class:"price-header"},"Entry"),(0,o.Lk)("th",{class:"volume-header"},"Volume"),(0,o.Lk)("th",null,"Opening Range"),(0,o.Lk)("th",{class:"retraced-header"},"Retraced"),(0,o.Lk)("th",{class:"send-to-header"},"Send To")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.signals,((e,t)=>((0,o.uX)(),(0,o.CE)("tr",{key:t,class:(0,m.C4)(l.getRowClass(e))},[(0,o.Lk)("td",Vn,[(0,o.Lk)("span",{class:(0,m.C4)(l.getStrategyClass(e))},(0,m.v_)(l.formatStrategy(e)),3)]),(0,o.Lk)("td",Un,(0,m.v_)(e.ticker||"-"),1),(0,o.Lk)("td",Xn,(0,m.v_)(l.formatTime(e)),1),(0,o.Lk)("td",Hn,(0,m.v_)(l.formatDirection(e)),1),(0,o.Lk)("td",zn,(0,m.v_)(l.formatPrice(e.entry_price)),1),(0,o.Lk)("td",Qn,(0,m.v_)(l.formatVolume(e)),1),(0,o.Lk)("td",{class:"range",innerHTML:l.formatRange(e)},null,8,qn),(0,o.Lk)("td",jn,(0,m.v_)(l.formatRetraced(e)),1),(0,o.Lk)("td",Kn,[(0,o.Lk)("span",Gn,[(0,o.Lk)("button",{onClick:s=>l.sendToWindow(1,e,t),class:(0,m.C4)(["window-btn",{active:l.isSignalInWindow(t,1)}]),title:"Send to Window 1"},"1",10,Yn),(0,o.Lk)("button",{onClick:s=>l.sendToWindow(2,e,t),class:(0,m.C4)(["window-btn",{active:l.isSignalInWindow(t,2)}]),title:"Send to Window 2"},"2",10,Jn)]),(0,o.Lk)("span",Zn,[(0,o.Lk)("button",{onClick:s=>l.sendToWindow(3,e,t),class:(0,m.C4)(["window-btn",{active:l.isSignalInWindow(t,3)}]),title:"Send to Window 3"},"3",10,el),(0,o.Lk)("button",{onClick:s=>l.sendToWindow(4,e,t),class:(0,m.C4)(["window-btn",{active:l.isSignalInWindow(t,4)}]),title:"Send to Window 4"},"4",10,tl)]),(0,o.Lk)("span",sl,[(0,o.Lk)("button",{onClick:s=>l.sendToWindow(5,e,t),class:(0,m.C4)(["window-btn",{active:l.isSignalInWindow(t,5)}]),title:"Send to Window 5"},"5",10,il),(0,o.Lk)("button",{onClick:s=>l.sendToWindow(6,e,t),class:(0,m.C4)(["window-btn",{active:l.isSignalInWindow(t,6)}]),title:"Send to Window 6"},"6",10,ol)])])],2)))),128))])])])),(0,o.Lk)("div",al,[(0,o.Lk)("span",{class:(0,m.C4)(l.connectionStatusClass)},(0,m.v_)(n.connectionStatus),3)])])}var ll={name:"SignalsView",data(){return{signals:[],selectedDate:"",loading:!1,error:null,connectionStatus:"Ready",autoRefreshInterval:null,windowStatusInterval:null,windowSignalMap:{},windowTickers:{},alertSoundEnabled:!0,lastSignalCount:0,selectedChime:"beep",audioContext:null,isInitialLoad:!0,audioKeepAliveInterval:null}},computed:{connectionStatusClass(){return{"status-ready":"Ready"===this.connectionStatus,"status-loading":"Loading..."===this.connectionStatus,"status-error":this.connectionStatus.includes("Error")}}},mounted(){this.selectedDate=this.getTodaysDate();const e=localStorage.getItem("alertSoundEnabled");null!==e&&(this.alertSoundEnabled="true"===e);const t=localStorage.getItem("selectedChime");t&&(this.selectedChime=t),this.fetchSignals(),this.setupAutoRefresh(),this.windowStatusInterval=setInterval((()=>{this.syncWindowHighlights()}),2e3),this.audioKeepAliveInterval=setInterval((()=>{this.keepAudioContextAlive()}),3e4)},beforeUnmount(){this.autoRefreshInterval&&clearInterval(this.autoRefreshInterval),this.windowStatusInterval&&clearInterval(this.windowStatusInterval),this.audioKeepAliveInterval&&clearInterval(this.audioKeepAliveInterval)},methods:{getTodaysDate(){const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${i}`},setupAutoRefresh(){const e=new Date,t=e.getSeconds(),s=e.getMilliseconds(),i=[3,8,13,18,23,28,33,38,43,48,53,58];let o=i.find((e=>e>t));o||(o=63);const a=1e3*(o-t)-s;setTimeout((()=>{this.selectedDate===this.getTodaysDate()&&this.fetchSignals({background:!0}),this.autoRefreshInterval=setInterval((()=>{this.selectedDate===this.getTodaysDate()&&this.fetchSignals({background:!0})}),5e3)}),a)},async fetchSignals(e={}){const t=e.silent??!0===e;this.error=null;try{const e=await fetch(`http://${window.location.hostname}:8000/api/signals?date=${this.selectedDate}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();!t&&!this.isInitialLoad&&this.alertSoundEnabled&&s.length>this.lastSignalCount&&(console.log("🔊 New signal detected - playing alert sound"),this.playAlertSound()),this.signals=s,this.lastSignalCount=this.signals.length,this.isInitialLoad=!1,await this.syncWindowHighlights(),this.connectionStatus="Ready"}catch(s){console.error("Error fetching signals:",s),this.error=`Failed to load signals: ${s.message}`,this.connectionStatus=`Error: ${s.message}`}},async syncWindowHighlights(){const e=[];for(let a=1;a<=6;a++){const t=1e4+a,s=new Promise(((e,t)=>setTimeout((()=>t(new Error("Timeout"))),1e3))),i=fetch(`http://localhost:${t}/status`,{method:"GET"}).then((e=>{if(e.ok)return e.json();throw new Error("Not OK")})).then((e=>({windowNumber:a,symbol:e.symbol,success:!0})));e.push(Promise.race([i,s]).catch((()=>({windowNumber:a,symbol:null,success:!1}))))}const t=await Promise.all(e),s={},i={};t.forEach((({windowNumber:e,symbol:t,success:o})=>{if(o&&t){i[e]=t;const o=this.signals.findIndex((e=>e.ticker&&e.ticker.toUpperCase()===t.toUpperCase()));-1!==o&&(s[e]=o)}else o||(void 0!==this.windowSignalMap[e]&&(s[e]=this.windowSignalMap[e]),this.windowTickers[e]&&(i[e]=this.windowTickers[e]))}));const o=t.filter((e=>e.success)).length;o>0&&(this.windowSignalMap=s,this.windowTickers=i)},refreshSignals(){this.fetchSignals()},formatTime(e){if(e.timestamp&&"string"===typeof e.timestamp&&e.timestamp.includes(":")){const t=e.timestamp.split(":");if(t.length>=2)return`${t[0]}:${t[1]}`}const t=e.raw_details?.event_timestamp;if(t&&Array.isArray(t)){const[,,,e,s]=t;if(void 0!==e&&void 0!==s){const t=String(e).padStart(2,"0"),i=String(s).padStart(2,"0");return`${t}:${i}`}}return"-"},formatPrice(e){return null===e||void 0===e?"-":parseFloat(e).toFixed(2)},formatStrategy(e){return e.strategy||"Unknown"},formatDirection(e){return e.direction||e.manipulation_direction||"-"},formatVolume(e){const t=e.raw_details?.reversal_volume_per_min||e.reversal_volume_per_min,s=e.raw_details?.session_volume||e.session_volume;if(!t||!s){const t=e.raw_details?.volume||e.volume;if(null===t||void 0===t)return"-";const s=(t/1e3).toFixed(1);return`${s}K`}const i=e=>`${(e/1e3).toFixed(0)}K`;return`${i(t)} / ${i(s)}`},formatRange(e){const t=e.opening_range_high,s=e.opening_range_low,i=e.opening_range_high-e.opening_range_low;return t&&s?`<strong>${i.toFixed(2)}</strong> (${parseFloat(s).toFixed(2)} - ${parseFloat(t).toFixed(2)})`:"-"},formatRetraced(e){const t=e.range_coverage_percent,s=e.timeframe_interval||e.raw_details?.timeframe_interval;if(!t)return"-";let i=t;if(s){const e=this.formatInterval(s);i+=`, ${e}`}return i},formatInterval(e){if("string"===typeof e){if(e.includes("SECOND_10"))return"10s";if(e.includes("MINUTE_1"))return"1m";if(e.includes("MINUTE_2"))return"2m";if(e.includes("MINUTE_3"))return"3m";if(e.includes("MINUTE_5"))return"5m";if(e.includes("MINUTE_15"))return"15m"}return e||""},getRowClass(e){const t=e.signal_type,s=(e.direction||"").toUpperCase();return"LONG"===s?"row-long":"SHORT"===s?"row-short":"MANIPULATION_REVERSAL_WATCH"===t?"row-watch":""},getStrategyClass(e){const t=e.strategy;return"ManipulationReversal"===t?"strategy-manipulation":"Back$ide"===t?"strategy-backside":"Hitchhiker"===t?"strategy-hitchhiker":"Rubberband"===t?"strategy-rubberband":"Second Chance"===t?"strategy-secondchance":"Fashionably Late"===t?"strategy-fashionablylate":""},async sendToWindow(e,t,s){const i=1e4+e;try{const a=await fetch(`http://localhost:${i}/signal`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=await a.json();console.log(`Signal sent to window ${e}:`,n),this.windowSignalMap[e]=s;try{await fetch(`http://localhost:${i}/focus`,{method:"POST"})}catch(o){console.warn(`Could not focus window ${e}:`,o)}}catch(a){console.error(`Failed to send signal to window ${e}:`,a),alert(`Failed to send signal to window ${e}: ${a.message}`)}},isSignalInWindow(e,t){return this.windowSignalMap[t]===e},async focusWindow(e){const t=1e4+e;try{await fetch(`http://localhost:${t}/focus`,{method:"POST"}),console.log(`Focused window ${e}`)}catch(s){console.warn(`Could not focus window ${e}:`,s)}},async bringAllWindowsForward(){const e=[];for(let t=1;t<=6;t++){const s=1e4+t,i=fetch(`http://localhost:${s}/focus`,{method:"POST"}).catch((e=>{console.error(`Failed to focus window ${t}:`,e)}));e.push(i)}await Promise.all(e),console.log("Brought all windows to front")},async playAlertSound(){try{if(this.audioContext||this.initAudioContext(),!this.audioContext)return void console.log("AudioContext not initialized - waiting for user interaction");switch("suspended"===this.audioContext.state&&(console.log("Resuming suspended AudioContext..."),await this.audioContext.resume(),console.log("AudioContext resumed, state:",this.audioContext.state)),this.selectedChime){case"beep":this.playBeep(this.audioContext);break;case"ding":this.playDing(this.audioContext);break;case"chime":this.playChime(this.audioContext);break;case"bell":this.playBell(this.audioContext);break;case"notification":this.playNotification(this.audioContext);break;case"sonar":this.playSonar(this.audioContext);break;case"ascending":this.playAscending(this.audioContext);break;case"descending":this.playDescending(this.audioContext);break;case"double-beep":this.playDoubleBeep(this.audioContext);break;case"triple-tone":this.playTripleTone(this.audioContext);break;case"urgent":this.playUrgent(this.audioContext);break;case"subtle":this.playSubtle(this.audioContext);break}console.log("Alert sound played:",this.selectedChime)}catch(e){console.error("Error playing alert sound:",e)}},playBeep(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=800,t.type="sine",s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.3,e.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2),t.start(e.currentTime),t.stop(e.currentTime+.2)},playDing(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=1200,t.type="sine",s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.4,e.currentTime+.005),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)},playChime(e){[1e3,800].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.15*s;i.frequency.value=t,i.type="sine",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.3,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+.25),i.start(a),i.stop(a+.25)}))},playBell(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=1500,t.type="sine",s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.5,e.currentTime+.002),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),t.start(e.currentTime),t.stop(e.currentTime+.5)},playNotification(e){[0,.15,.3].forEach((t=>{const s=e.createOscillator(),i=e.createGain();s.connect(i),i.connect(e.destination);const o=e.currentTime+t;s.frequency.value=900,s.type="sine",i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.25,o+.01),i.gain.exponentialRampToValueAtTime(.01,o+.1),s.start(o),s.stop(o+.1)}))},playSonar(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=600,t.type="sine",t.frequency.setValueAtTime(600,e.currentTime),t.frequency.exponentialRampToValueAtTime(300,e.currentTime+.3),s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.4,e.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)},playAscending(e){[600,800,1e3].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.1*s;i.frequency.value=t,i.type="sine",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.25,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+.12),i.start(a),i.stop(a+.12)}))},playDescending(e){[1200,900,700].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.1*s;i.frequency.value=t,i.type="sine",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.25,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+.12),i.start(a),i.stop(a+.12)}))},playDoubleBeep(e){[0,.2].forEach((t=>{const s=e.createOscillator(),i=e.createGain();s.connect(i),i.connect(e.destination);const o=e.currentTime+t;s.frequency.value=850,s.type="sine",i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.3,o+.01),i.gain.exponentialRampToValueAtTime(.01,o+.15),s.start(o),s.stop(o+.15)}))},playTripleTone(e){[523,659,784].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.15*s;i.frequency.value=t,i.type="sine",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.25,a+.01),o.gain.exponentialRampToValueAtTime(.01,a+.2),i.start(a),i.stop(a+.2)}))},playUrgent(e){[1400,1600,1400,1600].forEach(((t,s)=>{const i=e.createOscillator(),o=e.createGain();i.connect(o),o.connect(e.destination);const a=e.currentTime+.08*s;i.frequency.value=t,i.type="square",o.gain.setValueAtTime(0,a),o.gain.linearRampToValueAtTime(.2,a+.005),o.gain.exponentialRampToValueAtTime(.01,a+.07),i.start(a),i.stop(a+.07)}))},playSubtle(e){const t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=700,t.type="sine",s.gain.setValueAtTime(0,e.currentTime),s.gain.linearRampToValueAtTime(.15,e.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.15),t.start(e.currentTime),t.stop(e.currentTime+.15)},initAudioContext(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("AudioContext initialized on user interaction"))},keepAudioContextAlive(){if(this.audioContext&&"closed"!==this.audioContext.state){"suspended"===this.audioContext.state&&this.audioContext.resume().catch((e=>{console.warn("Failed to resume AudioContext in keep-alive:",e)}));try{const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.value=2e4,t.gain.value=.001,e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.001)}catch(e){console.warn("Failed to play keep-alive tone:",e)}}},saveAlertSoundPreference(){this.initAudioContext(),localStorage.setItem("alertSoundEnabled",this.alertSoundEnabled.toString()),console.log("Alert sound preference saved:",this.alertSoundEnabled)},saveChimePreference(){this.initAudioContext(),localStorage.setItem("selectedChime",this.selectedChime),console.log("Chime preference saved:",this.selectedChime)}}};const rl=(0,r.A)(ll,[["render",nl],["__scopeId","data-v-b2338f5e"]]);var cl=rl;const dl=[{path:"/",name:"WatchList",component:Re},{path:"/watchlist",name:"WatchListOld",component:Vt},{path:"/ticker/:symbol",name:"SingleTicker",component:Mn},{path:"/signals",name:"Signals",component:cl}],ul=(0,u.aE)({history:(0,u.LA)(),routes:dl});var ml=ul;if(window.ResizeObserver){const e=window.ResizeObserver;window.ResizeObserver=class extends e{constructor(e){super(((t,s)=>{try{e(t,s)}catch(i){if(!/ResizeObserver loop/.test(i.message))throw i}}))}}}(0,i.Ef)(d).use(ml).mount("#app")},477:function(){}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,i,o,a){if(!i){var n=1/0;for(d=0;d<e.length;d++){i=e[d][0],o=e[d][1],a=e[d][2];for(var l=!0,r=0;r<i.length;r++)(!1&a||n>=a)&&Object.keys(s.O).every((function(e){return s.O[e](i[r])}))?i.splice(r--,1):(l=!1,a<n&&(n=a));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[i,o,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,a,n=i[0],l=i[1],r=i[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(o in l)s.o(l,o)&&(s.m[o]=l[o]);if(r)var d=r(s)}for(t&&t(i);c<n.length;c++)a=n[c],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(d)},i=self["webpackChunktrading_frontend_vue"]=self["webpackChunktrading_frontend_vue"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],(function(){return s(4469)}));i=s.O(i)})();
//# sourceMappingURL=app.9836103d.js.map